var allSurveyResults=[];function getSurvey(e,s){$.post("/Home/GetSurvey",{fromuser:e,selectedContact:s},function(e){e&&(e.surveys&&LoadSurvey(e.surveys),e.surveyResults)&&LoadsurveyResults(e.surveyResults,e.surveys)})}function LoadsurveyResults(e,s){if(e||0!=e.length)if(0<allSurveyResults.length){for(var n=0;n<e.length;n++)surveyResult=e[n],allSurveyResults.push(surveyResult);for(n=0;n<s.length;n++)survey=s[n],(r=allSurveyResults.filter(e=>e.surveyId==survey.id))&&0<r.length?r[0].showResultToUser=survey.showResultToUser:allSurveyResults.push({firstRes:0,secondRes:0,thirdRes:0,fourthRes:0,fifthRes:0,sixthRes:0,surveyId:survey.id,countAll:0,answerIndex:survey.answerIndex,showResultToUser:survey.showResultToUser})}else{for(n=0;n<e.length;n++)surveyResult=e[n],allSurveyResults.push(surveyResult);for(var r,n=0;n<s.length;n++)survey=s[n],(r=allSurveyResults.filter(e=>e.surveyId==survey.id))&&0<r.length?r[0].showResultToUser=survey.showResultToUser:allSurveyResults.push({firstRes:0,secondRes:0,thirdRes:0,fourthRes:0,fifthRes:0,sixthRes:0,surveyId:survey.id,countAll:0,answerIndex:survey.answerIndex,showResultToUser:survey.showResultToUser})}}function LoadSurvey(e){if(e||0!=e.length)if(0==$(".chat-pm ul li").length)setTimeout(function(){LoadSurvey(e)},300);else{for(var s="",n=0;n<e.length;n++)s+='<li class="from-other survey" data-id="q_'+(r=e[n]).id+`">
        <label>
	<label class="w-100">
		`+r.question+(r.showResultToUser?" [Open to show result to others]":"[Do not show result to others]")+`
	</label>
	<label class="w-100" for="answer`+r.id+`_1">
		`+r.answer1+`
		<input type="radio" name="answer`+r.id+'" id="answer'+r.id+`_1" />
	</label>`,1<r.countOfAnswer&&(s+='<label class="w-100" for="answer'+r.id+`_2">
		        `+r.answer2+`
		        <input type="radio" name="answer`+r.id+'" id="answer'+r.id+`_2" />
	        </label>`),2<r.countOfAnswer&&(s+='<label class="w-100" for="answer'+r.id+`_3">
		        `+r.answer3+`
		        <input type="radio" name="answer`+r.id+'" id="answer'+r.id+`_3" />
	        </label>`),3<r.countOfAnswer&&(s+='<label class="w-100" for="answer'+r.id+`_4">
		        `+r.answer4+`
		        <input type="radio" name="answer`+r.id+'" id="answer'+r.id+`_4" />
	        </label>`),4<r.countOfAnswer&&(s+='<label class="w-100" for="answer'+r.id+`_5">
		        `+r.answer5+`
		        <input type="radio" name="answer`+r.id+'" id="answer'+r.id+`_5" />
	        </label>`),5<r.countOfAnswer&&(s+='<label class="w-100" for="answer'+r.id+`_6">
		        `+r.answer6+`
		        <input type="radio" name="answer`+r.id+'" id="answer'+r.id+`_6" />
	        </label>`),s+="</label></li>";s&&0<s.length&&$("#lastchat").before(s),setTimeout(function(){$(".chat-pm ul").scrollTop($(".chat-pm ul").get(0).scrollHeight)},300);for(var r,n=0;n<e.length;n++)0==(r=e[n]).isDone?$('[name="answer'+r.id+'"]').on("click",function(){ProcessDoneSurvey($(this),!1)}):($('[data-id="q_'+r.id+'"] input').attr("disabled",""),ProcessDoneSurvey($('[name="answer'+r.id+'"]'),!0,r.answerIndex))}}function ProcessDoneSurvey(e,s,n){var r,t=0,a=e.eq(0).attr("name").replace("answer",""),e=($('[data-id="q_'+a+'"] input').attr("disabled",""),s||(t=e.attr("id").replace("answer"+a+"_",""),$.post("/Home/SetSurveyResult",{surveyId:a,choiceIndex:t},function(){})),n&&$("#answer"+a+"_"+n).prop("checked",!0),allSurveyResults.filter(e=>e.surveyId==a)[0]);e.showResultToUser&&(n=e.countAll+(s?0:1),s=0==(s=e.countAll+(s?0:1))?1:s,r=e.firstRes+(1==t?1:0),$('[for="answer'+a+'_1"]').append('<sp class="red">['+r+" of "+n+" ("+Math.round(r/s*1e4)/100+"%) ]</sp>"),r=e.secondRes+(2==t?1:0),0<$('[for="answer'+a+'_2"]').length&&$('[for="answer'+a+'_2"]').append('<sp class="red">['+r+" of "+n+" ("+Math.round(r/s*1e4)/100+"%) ]</sp>"),r=e.thirdRes+(3==t?1:0),0<$('[for="answer'+a+'_3"]').length&&$('[for="answer'+a+'_3"]').append('<sp class="red">['+r+" of "+n+" ("+Math.round(r/s*100)/100+"%) ]</sp>"),r=e.fourthRes+(4==t?1:0),0<$('[for="answer'+a+'_4"]').length&&$('[for="answer'+a+'_4"]').append('<sp class="red">['+r+" of "+n+" ("+Math.round(r/s*1e4)/100+"%) ]</sp>"),r=e.fifthRes+(5==t?1:0),0<$('[for="answer'+a+'_5"]').length&&$('[for="answer'+a+'_5"]').append('<sp class="red">['+r+" of "+n+" ("+Math.round(r/s*1e4)/100+"%) ]</sp>"),r=e.sixthRes+(6==t?1:0),0<$('[for="answer'+a+'_6"]').length&&$('[for="answer'+a+'_6"]').append('<sp class="red">['+r+" of "+n+" ("+Math.round(r/s*1e4)/100+"%) ]</sp>"),loadForSurveySelectLi())}function loadForSurveySelectLi(){var n=0;$(".chat-pm li.survey").unbind("mousedown"),$(".chat-pm li.survey").unbind("mouseup"),$(".chat-pm li.survey").unbind("mouseleave"),$(".chat-pm li.survey").unbind("mouseleave"),$(".chat-pm li.survey").unbind("touchstart"),$(".chat-pm li.survey").unbind("touchend"),$(".chat-pm li.survey").on("mousedown touchstart",function(e){var s=$(this);SelectLi&&"mousedown"==e.type&&survey_must_be_selected(s),n=setTimeout(function(){survey_must_be_selected(s)},1e3)}).on("mouseup mouseleave touchend",function(){clearTimeout(n)})}function survey_must_be_selected(e){e.addClass("selected");var s=(s=e.attr("data-id")).replace("q_","");$(".context-menu .origin").addClass("d-none"),$(".context-menu").removeClass("d-none"),$(".context-menu > div.survey-btn").removeClass("d-none"),$(".context-menu > .survey-btn").unbind("click"),$(".context-menu > .survey-btn").on("click",function(){$.post("/Home/SurveyUserReslt",{surveyId:s},function(e){$(this).addClass("d-none");for(var s="<div class='survey-result'><div class='w-100'><div class='answer ans1'>First</div>"+(1<e.survey.countOfAnswer?"<div class='answer ans2'>Second</div>":"")+(2<e.survey.countOfAnswer?"<div class='answer ans3'>Third</div>":"")+(3<e.survey.countOfAnswer?"<div class='answer ans4'>Fourth</div>":"")+(4<e.survey.countOfAnswer?"<div class='answer ans5'>Fifth</div>":"")+(5<e.survey.countOfAnswer?"<div class='answer ans6'>Sixth</div>":"")+"<div class='answer all selected'>All</div><div class='answer close-survey'>&times;</div></div>",n=0;n<e.surveyResults.length;n++)s+="<div class='w-100 person ans"+e.surveyResults[n].answerIndex+"'>"+e.surveyResults[n].fullName+"</div>";s+="<div class='w-100 person d-none anyone'>[No one Choose this Item]</div>",$(".context-menu").append(s),$(".context-menu .survey-result .answer").on("click",function(){var e=$(this).attr("class").replace("answer ","");$(".context-menu .survey-result .answer").removeClass("selected"),$(this).addClass("selected"),"all"!=e&&"close-survey"!=e?($(".context-menu .person").hide(),$(".context-menu .person.anyone").addClass("d-none"),$(".context-menu .person."+e).show(),0==$(".context-menu .person."+e).length&&($(".context-menu .person.anyone").removeClass("d-none"),$(".context-menu .person.anyone").show())):"all"==e?($(".context-menu .person").show(),$(".context-menu .person.anyone").hide()):($(".context-menu .survey-result").remove(),$(".context-menu .origin").removeClass("d-none"),$(".context-menu").addClass("d-none"),$(".chat-pm li.survey").removeClass("selected"),$(".context-menu > .survey-btn").addClass("d-none"))})})})}