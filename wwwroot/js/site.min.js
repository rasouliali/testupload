var faTrashClicked=!1,SelectLi=!1,minId="0",lmore=!1;try{JSBridge.setUserId(myUserId)}catch{}var dt1,visible=!0;function showStatus(){$("#status-options").css("opacity","1"),$("#status-options").css("visibility","visible")}function searchContact(){var e=$("#search input").val();e?($(".new-search-mess").hide(),$(".new-search-mess").removeClass("new-search-mess").addClass("search-mess"),$(".new-search-mess").html(""),$.post("/Home/GetAccounts",{searchKey:e},function(e){if($(".def-mess").hide(),0==e.length)s=`<li class="contact new-search-mess">
                        <div class="wrap">
                            <div class="meta">
                                <p class="name">Not Found</p>
                                <p class="preview">nothing!</p>
                            </div>
                        </div>
                    </li>`,$("#contacts ul").append(s);else for(var t=0;t<e.length;t++){var a=1==e[t].status?"away":2==e[t].status?"busy":3==e[t].status?"offline":"online",s='<li class="contact new-search-mess"  data-id="'+e[t].userId.toLowerCase()+`">
                        <div class="wrap">
                            <span class="contact-status `+a+'"></span>'+(data.id==myUserId?"<img src='/img/cloud-folder-b.svg' class='mydrive' />":e[t].profilePic?'<img src="/ProfilePics/thumbnails/'+e[t].profilePic+'" alt="" />':'<img src="/user-profile.png" alt="" />')+`<div class="meta">
                                <p class="name">`+(data.id==myUserId?NaN:e[t].userName)+`<span></span></p>
                                <p class="preview"></p>
                            </div>
                        </div>
                    </li>`;$("#contacts ul").append(s),$(".new-search-mess").on("click",function(){fromNewChat=!1,$(".contact").removeClass("active"),$(".new-search-mess").removeClass("active"),$(this).addClass("active");var t=$(this).data("id");$(this).data("id");$.post("/Home/GetContactMessage",{minId:"0",contactId:t},function(e){$(".loading").hide(),null==e||0==e.length?SetEmptyMessage():SetResultOfMessage(e),mySignalRListener.SeenMessege("all",t)})})}})):($(".new-search-mess").hide(),$(".def-mess").show())}function SetEmptyMessage(e){var t="",a="",e=(a=($(".contact.active").hasClass("grp")?(t=30<(e=e||$(".contact.active .group-name").html()).length?e.substring(0,29)+"...":e,$(".contact.active .chat-bio")):(t=30<(e=e||$(".contact.active .name").html()).length?e.substring(0,29)+"...":e,$(".contact.active .company").text(),$(".contact.active .role"))).text(),$(".contact.active img").attr("src")),e=`
		<div class="row">
			<div class="chat px-3">
			
			  <div class="mb-auto row">
				<div class="text-start display-block">
				  <div class="text-start float-start btn w-100">

					<div class="d-inline">
						<div class="float-start mt--5">
							<a class="active text-light close mx-2" aria-current="page" href="#" ><i class="fas fa-arrow-left"></i></a>
							<img src="`+e+`" class="img-pro-pm-chat" />
						</div>
						<div class="float-start mx-2 mt--11">
							<div class="pro-small">
								<label class="name">`+t+`</label>
								<label class="role">`+a+`</label>
								<label class="lastseen"></label>
							</div>
						</div>

						<div class="float-end text-end">
						  <div class="text-start float-end btn px-0">
							<a class="active text-light pr-2 d-none" aria-current="page" href="#" title="Deselect"><i class="fa fa-remove"></i></a>
							<a class="active text-light pr-2 d-none" aria-current="page" href="#" title="Copy"><i class="fa-solid fa-copy"></i></a>
							<a class="active text-light pr-2 d-none" aria-current="page" href="#" title="Forward"><i class="fa-solid fa-share"></i></a>
							<a class="active text-light pr-2 d-none" aria-current="page" href="#" title="Reply"><i class="fa-solid fa-reply"></i></a>
							<a class="active text-light pr-2 d-none" aria-current="page" href="#" title="Edit"><i class="fa fa-edit"></i></a>
							<a class="active text-light d-none" aria-current="page" href="#" title="Remove"><i class="fa-solid fa-trash"></i></a>
							`+($(".contact.active").hasClass("grp")?'<a class="active text-light d-none" aria-current="page" href="#"><i class="fa fa-info-circle"></i></a>':`
							    <a class="active text-light pr-2" aria-current="page" href="#"><i class="fas fa-phone"></i></a>
							    <a class="active text-light" aria-current="page" href="#"><i class="fas fa-video"></i></a>`)+`
						  </div>
						</div>
					</div>
				  </div>
				</div>
			  </div>
			  <div class="row tab-div">
				<div class="chat-pm">
        `+`<div class="chat-pm-empty ">
						<label class="text-larg">
							No message here yet!
						</label>
						<label>
							Send a message or send file or voice.
						</label>
					</div>
            <ul><li id='lastchat'></li></ul>`+`
        
                <a href="#" class="back-to-top z-3 d-flex align-items-center justify-content-center"><i class="fa fa-arrow-down"></i></a>
					<div id="drop-area" class="chat-pm-input ">
						
						<textarea rows="1" class="w-100 form-control" ></textarea>
						<div class="send-btn">
                            <div class="input-group-append" id="microphone_btn">
                                <span class="input-group-text microphone_btn"><i class="fa fa-microphone"></i></span>
                            </div>
                            <div class="input-group-append" id="stopButton">
                                <span class="input-group-text stopButton"><i class="fa fa-stop-circle"></i></span>
                            </div>
							<img class="attach" src="/img/attach_file.png" />
							<img class="send" src="/img/send-icon.svg" />
						</div>
					</div>
                </div>
            </div>`;$("#ChatPmModal .modal-body").html(e),ul&&ul.find(e=>e.userId.toLowerCase()==$(".contact.active").data("id").toLowerCase())?$(".pro-small .lastseen").html("Online"):$.post("/Home/UserLastSeen",{contactId:$(".contact.active").data("id")},function(e){e.lastSeen&&($(".pro-small .lastseen").html(getNiceDateTimeFormat(e.lastSeen)),delevCalc(activeUserId,e.lastSeen))}),backToTop(),handleDropFileArea(),$("#ChatPmModal").modal("show"),$(".pro-small").on("click",function(){$(".loading").show(),window.location.href="/Home/Profile?uid="+$(".contact.active").data("id")+"&IsGroup="+$(".contact.active").hasClass("grp")}),$("#ChatPmModal .close").on("click",function(){fromNewChat?window.location.href="/":$("#ChatPmModal").modal("hide")}),$(".fa-video").on("click",function(){VideoCallProcess()}),$(".fa-phone:not(.red)").on("click",function(){VoiceCallProcess()}),$(".lmore").on("click",function(){lmore=!0;var e=$(".contact.active").data("id");$.post("/Home/GetContactMessage",{minId:minId,contactId:e},function(e){$(".loading").hide(),null==e||0==e.length?SetEmptyMessage():(SetResultOfMessage(e),$(".contact.active .text-bg-success").html("(0)"))})}),setTimeout(function(){$(".chat-pm ul").scrollTop($(".chat-pm ul").get(0).scrollHeight)},500),setSomeFeatureForSendingMess(),loadRecData(),$("li .card .card-header").on("click",function(){var e,t,a=$(this).data("senderid");a?($("#ChatPmModal").modal("hide"),$(".contact.active").removeClass("active"),$('.contact[data-id="'+a.toLowerCase()+'"]').addClass("active"),setTimeout(function(){$('.contact[data-id="'+a.toLowerCase()+'"]').trigger("click")},400)):(e=$(this).parent().data("id"),t=0<(t=$('[data-id="'+e+'"]').get(0).offsetTop-150)?t:0,$(".chat-pm ul").scrollTop(t),$('[data-id="'+e+'"]').eq(0).css("background","black"),setTimeout(function(){$('[data-id="'+e+'"]').eq(0).css("background","transparent")},500),setTimeout(function(){$('[data-id="'+e+'"]').eq(0).css("background","black")},1e3),setTimeout(function(){$('[data-id="'+e+'"]').eq(0).css("background","transparent")},1500))})}function handleDropFileArea(){let t=document.getElementById("drop-area");function a(e){e.preventDefault(),e.stopPropagation()}function s(e){t.classList.add("highlight")}function i(e){t.classList.remove("highlight")}["dragenter","dragover","dragleave","drop"].forEach(e=>{t.addEventListener(e,a,!1)}),["dragenter","dragover"].forEach(e=>{t.addEventListener(e,s,!1)}),["dragleave","drop"].forEach(e=>{t.addEventListener(e,i,!1)}),t.addEventListener("drop",function(e){e=e.dataTransfer,e=e.files[0];var t=new FormData,e=(t.append("file1",e),$(".contact.active").data("id"));t.append("contactId",e),t.append("replyId",replyid);$("#lastchat").before(`<li class="from-me" id="tempProgressBar" >
              <div class="progress">
                <div class="progress-bar" id="my-progress-bar" role="progressbar" style="width: 25%" aria-valuenow="25" aria-valuemin="0" aria-valuemax="100">25%</div>
              </div>
            </li>`),$(".chat-pm ul").scrollTop($(".chat-pm ul").get(0).scrollHeight),setTimeout(function(){$(".chat-pm ul").scrollTop($(".chat-pm ul").get(0).scrollHeight)},500),uploadFile(t)},!1)}function VideoCallProcess(){if($(".two-img").addClass("hideinmobile"),"idle"!==$("body").attr("data-mode"))alertify.error("Sorry, you are already in a call.  Conferencing is not yet implemented.",5);else{var e=$(".def-mess.active").attr("data-id");if(e!=myUserId){$("body").removeAttr("data-before-call");try{if(console.log("IsCameraPermission:"+IsCameraPermission),0==IsCameraPermission)return IsCameraPermission=JSBridge.getVideoPermission(),void console.log("IsCameraPermission:"+IsCameraPermission)}catch{}"Connected"!=mySignalRListener.wsconn.connectionState&&"Connected"!=mySignalRListener.wsconn.M?SendNotConnectAlert("you are not connect to signalr. For video call you must refresh page. For refresh page touch on ok button."):(beepring.play(),beepring.volume=.3,$("#call-status-lbl").html("video calling to user..."),isVideoCall=!0,console.log("calling user... "),$("#VideoCallModalLabel").html("Video Call"),$(".partner")[0].style.display="none",localVideo.style.display="",remoteVideo.style.display="",$("#CallingModal .video").addClass("active"),$("#CallingModal .video video").show(),$(".call-buttons img").removeClass("active"),$.post("/Home/CallLogUpdate",{IsVideo:!0,Status:1,ToUser:e},function(){}),initializeUserMediaVideo(),mySignalRListener.callUser(e,!0),dt1=new Date,videoaudiotimer=setTimeout(timerDisplayFun,1e3),$("body").attr("data-mode","calling"),$("#CallingModal").modal("show"),$("#CallingModal .page1").hide(),$("#CallingModal .page3").hide(),$("#CallingModal .page4").hide(),$("#CallingModal .page2").show(),$("#CallingModal img.me").attr("src",myprofilepic),$("#CallingModal .row.blur-img").css("background-image","url('"+$(".def-mess.active img").attr("src")+"')"),$("#CallingModal img.other").attr("src",$(".def-mess.active img").attr("src")),$("#CallingModal h3.other").html($(".def-mess.active label.name").text()),$("#callstatus").text("Calling..."))}else alertify.error("Ah, nope.  Can't call yourself.",5)}}function VoiceCallProcess(){if($(".two-img").removeClass("hideinmobile"),"idle"!==$("body").attr("data-mode"))alertify.error("Sorry, you are already in a call.  Conferencing is not yet implemented.",5);else{var e=$(".def-mess.active").attr("data-id");if(e!=myUserId){$("body").removeAttr("data-before-call");try{if(console.log("IsMicrophonePermission:"+IsMicrophonePermission),0==IsMicrophonePermission)return IsMicrophonePermission=JSBridge.getAudioPermission(),void console.log("IsMicrophonePermission:"+IsCameraPermission)}catch{}"Connected"!=mySignalRListener.wsconn.connectionState&&"Connected"!=mySignalRListener.wsconn.M?SendNotConnectAlert("you are not connect to signalr. For voice call you must refresh page. For refresh page touch on ok button."):($("#call-status-lbl").html("voice calling to user..."),isVideoCall=!1,localVideo.style.display="none",remoteVideo.style.display="none",$("#VideoCallModalLabel").html("Voice Call"),console.log("calling user... "),$("#CallingModal .video").removeClass("active"),$("#CallingModal .video video").hide(),$(".call-buttons img").removeClass("active"),$.post("/Home/CallLogUpdate",{IsVideo:!1,Status:1,ToUser:e},function(){}),initializeUserMediaVoice(),mySignalRListener.callUser(e,!1),beepring.volume=.3,beepring.play(),dt1=new Date,videoaudiotimer=setTimeout(timerDisplayFun,1e3),$("body").attr("data-mode","calling"),$("#ChatPmModal").modal("hide"),$("#CallingModal").modal("show"),$("#CallingModal .page1").hide(),$("#CallingModal .page3").hide(),$("#CallingModal .page4").hide(),$("#CallingModal .page2").show(),$("#CallingModal img.me").attr("src",myprofilepic),$("#CallingModal .row.blur-img").css("background-image","url('"+$(".def-mess.active img").attr("src")+"')"),$("#CallingModal img.other").attr("src",$(".def-mess.active img").attr("src")),$("#CallingModal h3.other").html($(".def-mess.active label.name").text()),$("#callstatus").text("Calling..."))}else alertify.error("Ah, nope.  Can't call yourself.",5)}}function timerDisplayFun(){var e=new Date-dt1,t=Math.floor(e/1e3%60),e=Math.floor(e/1e3/60);$("#CallingModal .txt-timer").html((e<10?"0":"")+e.toString()+":"+(t<10?"0":"")+t.toString()),videoaudiotimer=setTimeout(timerDisplayFun,1e3)}function SetResultOfMessage(e,t,a,s){var i="";0==lmore&&(i+="<ul>"),(minId=0<e.length?e[e.length-1].id:minId)>parseInt($(".contact.active").attr("minid"))&&(i+="<li class='lmore'><button class='btn btn-info'>load more</button></li>");for(var o,l,n=e.length-1;0<=n;n--){var c=e[n].profilePic?"/ProfilePics/thumbnails/"+e[n].profilePic:"/img/person-icon.png",r=!1,d=0;if(e[n].body&&e[n].body.startsWith("@@@announcementData:")&&(r=!0,e[n].body=e[n].body.substring("@@@announcementData:".length),e[n].isFile=!1,d=parseInt(e[n].body.substring(0,e[n].body.indexOf(":"))),e[n].body=e[n].body.substring(e[n].body.indexOf(":")+1)),0==e[n].isFile)i+='<li class="'+(e[n].isReciver?"from-me":"from-other")+(r?" announcement":"")+'" data-id="'+e[n].id+'" >'+(e[n].grpContactName?"<div class='"+(e[n].isReciver?"float-end":"float-start")+"'><img src='"+c+"' class='img-pro' /></div><div class='"+(e[n].isReciver?"float-end":"float-start")+" name'>"+e[n].grpContactName+"</div>":"")+(0<=e[n].body.indexOf(",;,")?'<div class="card" data-id="'+(e[n].replyId||"")+`" >
                      <div class="card-header" `+ForwardSenderId(e[n].body)+">"+e[n].body.split(",;,")[0].split(",@,")[0]+`
                      </div><label`+checkRtlOfText(e[n].body.split(",;,")[1])+">"+textToWrite(e[n].body.split(",;,")[1])+"</label></div>":"<label"+checkRtlOfText(e[n].body)+">"+textToWrite(e[n].body)+"</label>")+(e[n].isReciver?'<span class="'+IsSeen(e[n])+'">✓</span>':"")+'</li><li class="'+(e[n].isReciver?"from-me":"from-other")+(r?" announcement":"")+`" >
                    <div class="date">`+getNiceDateTimeFormat(e[n].createdDate)+`</div>
                </li>`,0<d&&removeLiAfterSecond(e[n].id,1e3*(d+1));else{var m=[],p=(m.push(e[n].body),"");0<=e[n].body.indexOf("^")&&(m=e[n].body.split("^"),p="");for(var u=0;u<m.length;u++){var h=m[u];0<m[u].indexOf(",;,")&&(h=m[u].split(",;,")[1],p=m[u].split(",;,")[0],m[u]=m[u].replace(",;,"," ")),i=(i+='<li class="'+(e[n].isReciver?"from-me":"from-other")+'" data-id="'+e[n].id+'" >')+(e[n].grpContactName?"<div class='"+(e[n].isReciver?"float-end":"float-start")+"'><img src='"+c+"' class='img-pro' /></div><div class='"+(e[n].isReciver?"float-end":"float-start")+" name'>"+e[n].grpContactName+"</div>":""),p&&(i+='<div class="card" data-id="'+(replyid||"")+`" >
                      <div class="card-header " `+ForwardSenderId(p)+">"+p.split(",@,")[0]+"</div>"),IsImage(h)?i+='<label ><a href="/Home/GetFile?fileName='+h+'&fileType=up" class="js-smartPhoto img-tag"><div><img  class="fupload" src="/Home/GetFile?fileName='+h+'&fileType=up&th=true" /></div><div>'+SimpleFileName(h)+"</div></a></label>":IsAudio(h)?i+='<label><div><audio controls src="/Home/GetFile?fileName='+h+'&fileType=up" ></audio></div><div> '+SimpleFileName(h)+"</div></label>":IsVideo(h)?i+='<label><div><video controls  ><source src="/Home/GetFile?fileName='+h+'&fileType=up" ></video></div><div> '+SimpleFileName(h)+"</div></label>":IsPdfOrDoc(h)?i+='<label><a href="/Home/GetFile?fileName='+h+'&fileType=up" target="_blank" ><div><img class="docpdfimg" src="/Home/GetFile?fileName='+h.substring(0,h.lastIndexOf("."))+'.jpg&fileType=up&th=true" /></div><div>'+SimpleFileName(h)+"</div></a></label>":i+='<label><a href="/Home/GetFile?fileName='+h+'&fileType=up" target="_blank" ><div><img src="/img/file-icon.png"  /></div><div>'+SimpleFileName(h)+"</div></a></label>",p&&(i+="</div>"),i=(i+=(e[n].isReciver?'<span class="'+IsSeen(e[n])+'">✓</span>':"")+"</li>")+('<li class="'+(e[n].isReciver?"from-me":"from-other")+"\" ><div class='date'>"+getNiceDateTimeFormat(e[n].createdDate)+"</div></li>")}}}lmore?($(".lmore").before(i),(1<$(".lmore").length?$($(".lmore")[1]):$(".lmore")).remove(),lmore=!1,$(".lmore").on("click",function(){lmore=!0;var e=$(".contact.active").data("id");$.post("/Home/GetContactMessage",{minId:minId,contactId:e},function(e){$(".loading").hide(),null==e||0==e.length?SetEmptyMessage():(SetResultOfMessage(e),$(".contact.active .text-bg-success").html("0"))})})):(i+="<li id='lastchat'></li></ul>",l=o="",l=($(".contact.active").hasClass("grp")?(o=30<(a=a||$(".contact.active .group-name").html()).length?a.substring(0,29)+"...":a,$(".contact.active .chat-bio")):(o=30<(a=a||$(".contact.active .name").html()).length?a.substring(0,29)+"...":a,$(".contact.active .company").text(),$(".contact.active .role"))).text(),a=`
		<div class="row">
			<div class="chat px-3">
			
			  <div class="mb-auto row">
				<div class="text-start display-block">
				  <div class="text-start float-start btn w-100">

					<div class="d-inline">
						<div class="float-start mt--5">
							<a class="active text-light close mx-2" aria-current="page" href="#" ><i class="fas fa-arrow-left"></i></a>
							<img src="`+$(".contact.active img").attr("src")+`" class="img-pro-pm-chat" />
						</div>
						<div class="float-start mx-2 mt--11">
							<div class="pro-small" >
								<label class="name">`+o+`</label>
								<label class="role">`+l+`</label>
								<label class="lastseen"></label>
							</div>
						</div>

						<div class="float-end text-end">
						  <div class="text-start float-end btn px-0">
							<a class="active text-light pr-2 d-none" aria-current="page" href="#" title="Deselect"><i class="fa fa-remove"></i></a>
							<a class="active text-light pr-2 d-none" aria-current="page" href="#" title="Copy"><i class="fa-solid fa-copy"></i></a>
							<a class="active text-light pr-2 d-none" aria-current="page" href="#" title="Forward"><i class="fa-solid fa-share"></i></a>
							<a class="active text-light pr-2 d-none" aria-current="page" href="#" title="Reply"><i class="fa-solid fa-reply"></i></a>
							<a class="active text-light pr-2 d-none" aria-current="page" href="#" title="Edit"><i class="fa fa-edit"></i></a>
							<a class="active text-light pr-2 d-none" aria-current="page" href="#" title="Remove"><i class="fa-solid fa-trash"></i></a>
							`+($(".contact.active").hasClass("grp")?'<a class="active text-light d-none" aria-current="page" href="#"><i class="fa fa-info-circle"></i></a>':`
							    <a class="active text-light pr-2" aria-current="page" href="#"><i class="fas fa-phone"></i></a>
							    <a class="active text-light" aria-current="page" href="#"><i class="fas fa-video"></i></a>`)+`
						  </div>
						</div>
					</div>
				  </div>
				</div>
			  </div>
			  <div class="row tab-div">
				<div class="chat-pm">
        `+i+`
                <a href="#" class="back-to-top z-3 d-flex align-items-center justify-content-center"><i class="fa fa-arrow-down"></i></a>
					<div id="drop-area" class="chat-pm-input ">
						<textarea rows="1" class="w-100 form-control" ></textarea>
						<div class="send-btn">
                            <div class="input-group-append" id="microphone_btn">
                                <span class="input-group-text microphone_btn"><i class="fa fa-microphone"></i></span>
                            </div>
                            <div class="input-group-append" id="stopButton">
                                <span class="input-group-text stopButton"><i class="fa fa-stop-circle"></i></span>
                            </div>
							<img class="attach" src="/img/attach_file.png" />
							<img class="send" src="/img/send-icon.svg" />
						</div>
					</div>
                </div>
            </div>`,$("#ChatPmModal .modal-body").html(a),o=$(".contact.active").data("id"),s?($(".pro-small .lastseen").html(getNiceDateTimeFormat(s)),delevCalc(o,s)):delevCalc(o,(l=$(".pro-small .lastseen").html()).split(" ")[0]+" "+l.split(" ")[1]),backToTop(),handleDropFileArea(),0<$(".js-smartPhoto:not(.proc)").length&&(new SmartPhoto(".js-smartPhoto:not(.proc)"),$(".js-smartPhoto:not(.proc)").addClass("proc")),$("#close-img-modal").on("click",function(){$("#imgViewerModal").modal("hide")}),$("#ChatPmModal").modal("show"),$(".pro-small").on("click",function(){$(".loading").show(),window.location.href="/Home/Profile?uid="+$(".contact.active").data("id")+"&IsGroup="+$(".contact.active").hasClass("grp")}),$("#ChatPmModal .close").on("click",function(){fromNewChat?($(".loading").show(),window.location.href="/"):($(".contact").removeClass("active"),$("#ChatPmModal").modal("hide"))}),$(".chat-pm-input textarea").on("keyup",function(){hasPersian($(this).val())?$(this).addClass("rtl"):$(this).removeClass("rtl")}),$(".fa-video").on("click",function(){VideoCallProcess()}),$(".fa-phone:not(.red)").on("click",function(){VoiceCallProcess()}),$(".lmore").on("click",function(){lmore=!0;var e=$(".contact.active").data("id");$.post("/Home/GetContactMessage",{minId:minId,contactId:e},function(e){$(".loading").hide(),null==e||0==e.length?SetEmptyMessage():(SetResultOfMessage(e),$(".contact.active .text-bg-success").html("0"))})}),setTimeout(function(){t?($(".chat-pm ul").scrollTop($('[data-id="'+t+'"]').offset().top),$('[data-id="'+t+'"]').removeClass("showinchat"),setTimeout(function(){$('[data-id="'+t+'"]').addClass("showinchat"),$("#showinchatStyle").html("")},500),setTimeout(function(){$('[data-id="'+t+'"]').removeClass("showinchat")},1e3),setTimeout(function(){$('[data-id="'+t+'"]').addClass("showinchat")},1500),setTimeout(function(){$('[data-id="'+t+'"]').removeClass("showinchat")},2e3)):$(".chat-pm ul").scrollTop($(".chat-pm ul").get(0).scrollHeight)},500),setSomeFeatureForSendingMess(),loadRecData(),$("img:not(.proc),video source:not(.proc),audio:not(.proc)").on("error",function(){reloadFile($(this))}),$("img:not(.proc),video source:not(.proc),audio:not(.proc)").addClass("proc"),$("li .card .card-header").on("click",function(){var e,t=$(this).data("senderid");t?($("#ChatPmModal").modal("hide"),$(".contact.active").removeClass("active"),$('.contact[data-id="'+t.toLowerCase()+'"]').addClass("active"),setTimeout(function(){$('.contact[data-id="'+t.toLowerCase()+'"]').trigger("click")},400)):(e=$(this).parent().data("id"),$(".chat-pm ul").scrollTop($('[data-id="'+e+'"]').get(0).offsetTop-200),$('[data-id="'+e+'"]').eq(0).css("background","black"),setTimeout(function(){$('[data-id="'+e+'"]').eq(0).css("background","transparent")},500),setTimeout(function(){$('[data-id="'+e+'"]').eq(0).css("background","black")},1e3),setTimeout(function(){$('[data-id="'+e+'"]').eq(0).css("background","transparent")},1500))}))}function removeLiAfterSecond(e,t){setTimeout(function(){$('li[data-id="'+e+'"]').next("li.announcement").remove(),$('li[data-id="'+e+'"].announcement').remove()},t)}$(".expand-button , #profile-img").on("click",showStatus),$($("#profile p")[0]).on("click",showStatus),$(document).on("click",function(){(visible=!visible)&&($("#status-options").css("opacity","0"),$("#status-options").css("visibility","hidden"))}),$("#status-options li").on("click",function(){var e=$(this).attr("id").split("-")[1];$("#profile-img").removeAttr("class"),$("#profile-img").addClass(e),$.post("/Home/SetStatus",{status:e},function(){})}),$("#search input").on("keydown",function(e){13==e.keyCode&&searchContact()});var listFileError=[];function delevCalc(e,t){if(e==$(".contact.active").data("id"))for(var a,s=$("#ChatPmModal .modal-body li span:not(.seen):not(.delev)").length,i=$("#ChatPmModal .modal-body li.from-me"),o=($("#ChatPmModal .modal-body li.from-me").find("div.date"),ul&&ul.find(e=>e.userId.toLowerCase()==$(".contact.active").data("id").toLowerCase())),l=0;l<s;l+=2)i.eq(l).find("span:not(.seen):not(.delev)")&&(a=(a=i.eq(l+1).find("div.date").html()).split(" ")[0]+" "+a.split(" ")[1],o||new Date(a)<new Date(t))&&i.eq(l).addClass("delev")}function reloadFile(e){var t=e.attr("src");listFileError.push(t),console.log("reloadFile","src:"+t+", len:"+listFileError.filter(e=>e==t).length),listFileError.filter(e=>e==t).length<3&&(e.removeAttr("src"),setTimeout(function(){console.log("reloadFile-setTimeout","src:"+t+", len:"+listFileError.filter(e=>e==t).length),e.attr("src",t)},1500))}function SimpleFileName(e){return e?25<e.length?e.substring(0,12)+"..."+e.substring(e.length-10):e:""}function ForwardSenderId(e){return e&&0<e.indexOf(",@,")?' data-senderid="'+e.split(",@,")[1].split(">>")[0]+'" ':""}function IsSeen(e){return e.isSeen||null==e.isSeen?"seen":""}function loadImageModal(e){$("#img").attr("src",e),$("#download-img").attr("href",e),start(),$("#img").removeClass("d-none"),$("#imgViewerModal").modal("show"),$("#img").on("load",function(){var e,t,a,s=this.width,i=this.height,o=$(window).width()-10,l=$(window).height()-160;s<=o&&i<=l?($("#canvas").attr("height",s),$("#canvas").attr("width",i),$("#img").addClass("d-none")):(a=t=0,a=(l=((e=i<=l?l:i)-(i<=l?i:l))/e)<(o=((e=s<=o?o:s)-(s<=o?s:o))/e)?(t=s*(1-o),i*(1-o)):(t=s*(1-l),i*(1-l)),$("#canvas").attr("height",a),$("#canvas").attr("width",t),$("#img").addClass("d-none"),console.log("newH-newW",a+","+t)),initDraw(),$(".loading").hide()}),$(".loading").show()}function contact_must_be_selected(e){e&&e.hasClass("selected")?e.removeClass("selected"):e&&e.addClass("selected"),0==$(".chat-pm li.selected").length?(SelectLi=!1,$(".fa-video").parent().bsShow(),$(".fa-phone:not(.red)").parent().bsShow(),$(".pro-small").parent().bsShow(),$(".fa-share").parent().bsHide(),$(".fa-reply").parent().bsHide(),$(".fa-copy").parent().bsHide(),$(".fa-edit").parent().bsHide(),$(".fa-info-circle").parent().bsHide(),$(".modal-body .fa-trash").parent().bsHide(),$(".fa-remove").parent().bsHide()):(1==$(".chat-pm li.selected").length?(SelectLi=!0,$(".fa-video").parent().bsHide(),$(".fa-phone:not(.red)").parent().bsHide(),$(".pro-small").parent().bsHide(),$(".fa-share").parent().bsShow(),$(".fa-reply").parent().bsShow(),$(".chat-pm li.selected").hasClass("from-me")?$(".fa-info-circle").parent().bsShow():$(".fa-info-circle").parent().bsHide(),$(".chat-pm li.selected").hasClass("from-me")?$(".fa-edit").parent().bsShow():$(".fa-edit").parent().bsHide(),$(".chat-pm li.selected").hasClass("from-me")?$(".modal-body .fa-trash").parent().bsShow():$(".modal-body .fa-trash").parent().bsHide()):(SelectLi=!0,$(".fa-phone:not(.red)").parent().bsHide(),$(".fa-video").parent().bsHide(),$(".pro-small").parent().bsHide(),$(".fa-share").parent().bsShow(),$(".fa-reply").parent().bsHide(),$(".fa-copy").parent().bsHide(),$(".fa-info-circle").parent().bsHide(),$(".fa-edit").parent().bsHide(),canRemove()?$(".modal-body .fa-trash").parent().bsShow():$(".modal-body .fa-trash").parent().bsHide()),$(".fa-remove").parent().bsShow())}function canRemove(){var a=!0;return $(".chat-pm li.selected").each(function(e,t){if(!$(t).hasClass("from-me"))return a=!1}),a}function image_must_be_selected(e){e&&e.hasClass("selected")?e.removeClass("selected"):e&&e.addClass("selected"),0==$(".img-tag.selected").length?$("#selectedItembtn").bsHide():($(".img-tag.selected").length,$("#selectedItembtn").bsShow())}function file_must_be_selected(e){e&&e.hasClass("selected")?e.removeClass("selected"):e&&e.addClass("selected"),0==$(".file-tag.selected").length?$("#selectedItembtn").bsHide():($(".file-tag.selected").length,$("#selectedItembtn").bsShow())}function voice_must_be_selected(e){e&&e.hasClass("selected")?e.removeClass("selected"):e&&e.addClass("selected"),0==$(".voice-tag.selected").length?$("#selectedItembtn").bsHide():($(".voice-tag.selected").length,$("#selectedItembtn").bsShow())}$("#showInChatBtn").on("click",function(){var e;"#images-tab"==$(".nav-link.active").attr("data-bs-target")?(e=$(".img-tag.selected").data("id"),window.location.href="/?showInChat="+e):"#files-tab"==$(".nav-link.active").attr("data-bs-target")?(e=$(".file-tag.selected").data("id"),window.location.href="/?showInChat="+e):"#voices-tab"==$(".nav-link.active").attr("data-bs-target")&&(e=$(".voice-tag.selected").data("id"),window.location.href="/?showInChat="+e)});var innerHtmlReply="",replyid="",editid="",beforeReplytext="",forwardid="",deleteid="";function setSomeFeatureForSendingMess(){sendMessagebtn(),loadForSelectLi(),allDropDownButtonProcess()}function loadForSelectLi(){var a=0;$(".chat-pm li").unbind("mousedown"),$(".chat-pm li").unbind("mouseup"),$(".chat-pm li").unbind("mouseleave"),$(".chat-pm li").unbind("mouseleave"),$(".chat-pm li").unbind("touchstart"),$(".chat-pm li").unbind("touchend"),$(".chat-pm li").on("mousedown touchstart",function(e){var t=$(this);SelectLi&&"mousedown"==e.type&&contact_must_be_selected(t),a=setTimeout(function(){contact_must_be_selected(t)},1e3)}).on("mouseup mouseleave touchend",function(){clearTimeout(a)})}var selectedImage=!1;function loadForSelectImage(){var t=0;$(".img-tag").unbind("mousedown"),$(".img-tag").unbind("mouseup"),$(".img-tag").unbind("mouseleave"),$(".img-tag").unbind("mouseleave"),$(".img-tag").unbind("touchstart"),$(".img-tag").unbind("touchend"),$(".img-tag").on("mousedown touchstart",function(){var e=$(this);selectedImage=!1,t=setTimeout(function(){image_must_be_selected(e),selectedImage=!0},1e3)}).on("mouseup mouseleave touchend",function(e){clearTimeout(t)})}var selectedFile=!1;function loadForSelectFile(){var t=0;$(".file-tag").unbind("mousedown"),$(".file-tag").unbind("mouseup"),$(".file-tag").unbind("mouseleave"),$(".file-tag").unbind("mouseleave"),$(".file-tag").unbind("touchstart"),$(".file-tag").unbind("touchend"),$(".file-tag").on("mousedown touchstart",function(){var e=$(this);selectedFile=!1,t=setTimeout(function(){file_must_be_selected(e),selectedFile=!0},1e3)}).on("mouseup mouseleave touchend",function(e){selectedFile&&e.preventDefault(),clearTimeout(t)}),$(".filea").on("click",function(e){selectedFile&&e.preventDefault()})}var selectDefMessTimeoutId,selectedVoice=!1;function loadForSelectVoice(){var t=0;$(".voice-tag").unbind("mousedown"),$(".voice-tag").unbind("mouseup"),$(".voice-tag").unbind("mouseleave"),$(".voice-tag").unbind("mouseleave"),$(".voice-tag").unbind("touchstart"),$(".voice-tag").unbind("touchend"),$(".voice-tag").on("mousedown touchstart",function(){var e=$(this);selectedVoice=!1,t=setTimeout(function(){voice_must_be_selected(e),selectedVoice=!0},1e3)}).on("mouseup mouseleave touchend",function(e){clearTimeout(t)})}function sendMessagebtn(){$(".send-btn .send").on("click",function(e){SendMessageProcess(!1)}),$(".send-btn .attach").on("click",SendFileProcess),$(".chat-pm-input textarea").on("keydown",function(e){if(13==e.keyCode&&e.shiftKey)return SendMessageProcess(!1),!1})}function allDropDownButtonProcess(){deselectBtnProcess(),copyBtnProcess(),replyBtnProcess(),seenListBtnProcess(),editBtnProcess(),forwardBtnProcess(),deleteBtnProcess()}function deleteBtnProcess(){$(".modal-body .fa-trash").on("click",function(){$("#deleteModal").modal("show")}),$(".del_").removeClass("del_").addClass("del")}function forwardBtnProcess(){$(".fa-share").on("click",function(){forwardid="",$(".chat-pm li.selected").each((e,t)=>{forwardid+=$(t).data("id")+","}),forwardid=forwardid.substring(0,forwardid.length-1);var e="";e+=$(".contacts").clone().html(),$("#forward-body").html(e),$("#forward-body").find(".chat-mess-new").eq(0).remove(),$("#forward-body .mess").on("click",function(){$("#forward-body .mess").removeClass("active"),$(this).addClass("active")}),$("#forwardModal").modal("show")}),$(".for_").removeClass("for_").addClass("for")}function deselectBtnProcess(){$(".fa-remove").on("click",function(){$(".chat-pm li.selected").removeClass("selected"),contact_must_be_selected()})}function copyBtnProcess(){$(".fa-copy").on("click",function(){var e=HTMLEncode($(".chat-pm li.selected label").eq(0).text()),e=($("#mycopytextarea").bsShow(),$("#mycopytextarea").html(e),document.getElementById("mycopytextarea"));e.select(),e.setSelectionRange(0,99999),$("#mycopytextarea").focus(),navigator.clipboard.writeText(e.value);try{JSBridge.copyToClipboard(e.value)}catch{}$(".chat-pm li.selected").removeClass("selected"),contact_must_be_selected(),$("#mycopytextarea").bsHide()})}function HTMLEncode(e){var t={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&apos;"},a=e;for(const s in t)0<=a.indexOf(s)&&(a=a.replaceAll(s,t[s]));return a}function replyBtnProcess(){$(".fa-reply").on("click",function(){$(".chat-pm-input .card-header a").trigger("click"),forwardid="",innerHtmlReply=$(".chat-pm-input").eq(0).html(),beforeReplytext=$(".chat-pm-input textarea").eq(0).val();var e=$(".chat-pm li.selected").eq(0);e&&(replyid=(replyid=e.data("id"))||e.parent().data("id"),e=HTMLEncode(20<e.get(0).innerText.length?e.get(0).innerText.substring(0,20):e.get(0).innerText),$(".chat-pm-input").html(`<div class="card" >
                  <div class="card-header reply" data-id="`+replyid+'">'+e+'<a class="float-end px-3">X</span></a></div>'+innerHtmlReply+"</div>"),$(".chat-pm-input textarea").val(beforeReplytext),$(".chat-pm-input textarea").focus(),$(".chat-pm-input .card-header a").on("click",function(){beforeReplytext=$(".chat-pm-input textarea").val(),$(".chat-pm-input").html(innerHtmlReply),replyid="",$(".chat-pm textarea").val(beforeReplytext),loadRecData(),sendMessagebtn()}),sendMessagebtn(),$(".chat-pm li.selected").removeClass("selected"),contact_must_be_selected())}),$(".rep_").removeClass("rep_").addClass("rep")}function seenListBtnProcess(){$(".fa-info-circle").on("click",function(){$(".loading").show();var e=$(".chat-pm li.selected").eq(0).data("id");$.post("/Home/GetSeenListMess",{messId:e},function(e){$(".loading").hide();for(var t="",t=0==e.length?"<div>No one seen this messege.</div>":1==e.length?"<div>1 person seen this messege:</div>":"<div>"+e.length.toString()+" people seen this messege:</div>",a=0;a<e.length;a++)t+="<div>"+e[a].name+" - "+getNiceDateTimeFormat(e[a].createdDate)+"</div>";alertify.alert(t).set({title:"ZN Vostok"})})})}function editBtnProcess(){$(".fa-edit").on("click",function(){$(".chat-pm-input .card-header a").trigger("click"),forwardid="",innerHtmlReply=$(".chat-pm-input").eq(0).html(),beforeCopytext=$(".chat-pm-input textarea").eq(0).val();var e,t=$(".chat-pm li.selected").eq(0);t&&(editid=(editid=t.data("id"))||t.parent().data("id"),e=HTMLEncode(20<t.get(0).innerText.length?t.get(0).innerText.substring(0,20):t.get(0).innerText),$(".chat-pm-input").html(`<div class="card" >
                  <div class="card-header reply" data-id="`+replyid+'">'+e+'<a class="float-end px-3">X</span></a></div>'+innerHtmlReply+"</div>"),$(".chat-pm-input textarea").val(t.find("label").text()),$(".chat-pm-input textarea").focus(),$(".chat-pm-input .card-header a").on("click",function(){beforeReplytext=$(".chat-pm-input textarea").val(),$(".chat-pm-input").html(innerHtmlReply),editId=editid="",$(".chat-pm textarea").val(beforeReplytext),loadRecData(),sendMessagebtn()}),sendMessagebtn(),$(".chat-pm li.selected").removeClass("selected"),contact_must_be_selected())}),$(".rep_").removeClass("rep_").addClass("rep")}function SendFileProcess(){$("#fileinput").unbind("change"),$("#fileinput").on("change",function(){var e,t=document.getElementById("fileinput");0<t.files.length&&(e=$(".contact.active").data("id"),$("#lastchat").before(`<li class="from-me" id="tempProgressBar" >
              <div class="progress">
                <div class="progress-bar" id="my-progress-bar" role="progressbar" style="width: 25%" aria-valuenow="25" aria-valuemin="0" aria-valuemax="100">25%</div>
              </div>
            </li>`),setTimeout(function(){$(".chat-pm ul").scrollTop($(".chat-pm ul").get(0).scrollHeight)},500),fileUploader(t,e))}),$("#fileinput").trigger("click")}function SendMessageProcess(l){l=l||!1;var n,e="",c="";$(".chat-pm-empty").hide(),c=(0==l?(e=$(".chat-pm-input textarea").val(),$(".contact.active")):$("#forward-body .mess.active")).data("id"),(e||l)&&($(".loading").show(),0==l&&$(".chat-pm-input textarea").val(""),n=c,$.post("/Home/sendMess",{mess:e,contactId:c,replyId:l?"":replyid,forwardId:l?forwardid:"",editId:editid},function(e){if($(".loading").hide(),0==l||$("#forward-body .mess.active").data("id")==$(".contact.active").data("id")){for(var t="",a="",s=0;s<e.length;s++){var i=e[s].profilePic?"/ProfilePics/thumbnails/"+e[s].profilePic:"/img/person-icon.png",a=0<=e[s].body.indexOf(",;,")?textToWrite(e[s].body.split(",;,")[1]):textToWrite(e[s].body);t+='<li class ="from-me" data-id="'+e[s].id+'" data-time="'+e[s].createdDate+'">'+(e[s].grpContactName?"<div class='float-end'><img src='"+i+"' class='img-pro' /></div><div class='float-end name'>"+e[s].grpContactName+"</div>":"")+(0<=e[s].body.indexOf(",;,")?'<div class="newcard" data-id="'+(e[s].replyId||"")+`" >
                              <div class="card-header">
                              `+e[s].body.split(",;,")[0]+`
                              </div><label`+checkRtlOfText(e[s].body.split(",;,")[1])+">"+textToWrite(e[s].body.split(",;,")[1])+"</label><span >✓</span></div>":"<label "+checkRtlOfText(e[s].body)+">"+textToWrite(e[s].body)+"</label><span >✓</span>")+'</li><li class ="from-me" ><div class="date" data-id="'+(e[s].replyId||"")+'" >'+getNiceDateTimeFormat(e[s].createdDate)+"</div></li>"}editid?$('li[data-id="'+editid+'"] label').html(a):$("#lastchat").before(t),$("li .newcard:not(.card) .card-header").on("click",function(){var e=$(this).parent().data("id");$(".chat-pm ul").scrollTop($('[data-id="'+e+'"]').get(0).offsetTop-200),$('[data-id="'+e+'"]').eq(0).css("background","black"),setTimeout(function(){$('[data-id="'+e+'"]').eq(0).css("background","transparent")},500),setTimeout(function(){$('[data-id="'+e+'"]').eq(0).css("background","black")},1e3),setTimeout(function(){$('[data-id="'+e+'"]').eq(0).css("background","transparent")},1500)}),$("li .newcard:not(.card)").addClass("card"),$(".chat-pm ul").scrollTop($(".chat-pm ul").get(0).scrollHeight),0==l?($(".chat-pm-input textarea").val(""),(replyid||editid)&&($(".chat-pm-input .card-header a").trigger("click"),editid=replyid="")):$(".chat-pm li").removeClass("selected"),loadForSelectLi()}var o;$("img:not(.proc),video source:not(.proc),audio:not(.proc)").on("error",function(){reloadFile($(this))}),$("img:not(.proc),video source:not(.proc),audio:not(.proc)").addClass("proc"),l&&$(".chat-pm li").removeClass("selected"),contact_must_be_selected(),n!=myUserId?$(".contact.active").hasClass("grp")?mySignalRListener.sendBySignalRToGroup(c,e[0].createdDate+";;;"+userid+";;;"+e[0].body+";;;"+e[0].id+";;;"+(l?"":replyid)+(l?forwardid:"")):mySignalRListener.sendBySignalR(c,e[0].createdDate+";;;"+userid+";;;"+e[0].body+";;;"+e[0].id+";;;"+(l?"":replyid)+(l?forwardid:"")):$("li span:not(.seen):not(.delev)").addClass("seen"),$(".chat-pm-input textarea").focus(),0<$("li span:not(.seen):not(.delev)").length&&(ul&&ul.find(e=>e.userId.toLowerCase()==n.toLowerCase())?delevCalc(n,e.lastSeen):(o=$(".pro-small .lastseen").html(),delevCalc(n,o.split(" ")[0]+" "+o.split(" ")[1])))}))}$("#btn-submit-delete").on("click",function(){var a="";$(".chat-pm li.selected").each((e,t)=>{a+=$(t).data("id")+","}),a=a.substring(0,a.length-1),$.post("/Home/DelMess",{messid:a},function(e){0<e.length&&0<e[0].id?(e=$(".contact.active").data("id"),mySignalRListener.sendBySignalRForDel(e,a+";;;"+userid),$.each(a.split(","),function(e,t){$(".chat-pm li[data-id="+t+"]").next(".chat-pm li").remove(),$(".chat-pm li[data-id="+t+"]").remove()})):alert("an error has occured!"),$("#deleteModal").modal("hide"),contact_must_be_selected(),deleteid=""})}),$("#btn-cancel-forward").on("click",function(){forwardid="",$("#forwardModal").modal("hide")}),$("#btn-submit-forward").on("click",function(){0<$("#forward-body .mess.active").length&&SendMessageProcess(!0),forwardid="",$("#forwardModal").modal("hide"),$(".chat-pm li.selected").removeClass("selected"),contact_must_be_selected()}),$("#forwardModal").on("hidden.bs.modal",function(){forwardid=""});var fromNewChat,selectDefMessForDel=!1;function showHideDelBtn(e){0==e.find(".btn-danger").length?alertify.error("This is group. Group does not has any option.",5):e.hasClass("selectfordel")?($(".def-mess").removeClass("selectfordel"),$("#delchat-trash").bsHide()):($(".def-mess").removeClass("selectfordel"),e.addClass("selectfordel"),$("#delchat-trash").bsShow())}function searchonmobile(){$("#search input").val($("#searchContact").val()),searchContact(),$("#searchContactModal").modal("hide")}function saveToDb(e,t,a){$.post("/Home/SaveAddress",{Latitude:e,Longitude:t,Address:a},function(e){console.log("logSaveAddress"+e)})}function IsImage(e){e=e.toLowerCase().substring(e.lastIndexOf("."));return!![".jpg",".jpeg",".bmp",".png",".gif",".tiff"].includes(e)}function IsAudio(e){e=e.toLowerCase().substring(e.lastIndexOf("."));return!![".wav",".mp3"].includes(e)}function IsVideo(e){e=e.toLowerCase().substring(e.lastIndexOf("."));return!![".mp4",".webm",".m4p",".mkv",".mpg",".3gp",".avi",".mov",".mp2",".ogg",".3gp",".qt",".3gp"].includes(e)}function IsPdfOrDoc(e){e=e.toLowerCase().substring(e.lastIndexOf("."));return!![".doc",".docx",".pdf"].includes(e)}function searchContact(a){a?$(".selectContact .new-ch").each(function(e,t){0<=$(t).find(".pro").text().toLowerCase().indexOf(a.toLowerCase())?$(t).show():$(t).hide()}):$(".selectContact .new-ch").show()}function hasPersian(e){return!(!e||null!==(m=e.match(/[آ-ی]|([a-zA-Z])/))&&m[1])}function checkRtlOfText(e){return hasPersian(e)?" class='direction-rtl'":""}function textToWrite(e){return e.split("\n").join("<br />\n")}function backToTop(){let e=$(".back-to-top").get(0);e&&$(".chat-pm ul").get(0).addEventListener("scroll",function(){$(".chat-pm ul").get(0).scrollHeight-$(".chat-pm ul").scrollTop()>1.5*$(window).height()?e.classList.add("active"):e.classList.remove("active")}),$(".back-to-top,.fa-arrow-down").on("click",function(){$(".chat-pm ul").scrollTop($(".chat-pm ul").get(0).scrollHeight)})}function searchContent(){var e=$("#SearchModal input").val();e?($("#search-contents").html(""),$.post("/Home/GetSearchContent",{searchKey:e},function(e){if(0==e.length)t=`<ul><li class="content new-search-content">
                        <div class="wrap">
                            <div class="meta">
                                <p class="name">Not Found</p>
                                <p class="preview">nothing!</p>
                            </div>
                        </div>
                    </li></ul>`,$("#search-contents").append(t);else{for(var t="",a=0;a<e.length;a++)t+='<div class="new-ch content col-12 m-2 " data-id="'+e[a].id+`">
                            <div class="row">
                                <div class="col-12 mx-3">
                                    <div class="float-start mx-3 ">`+(e[a].profilePic?'<img src="/ProfilePics/thumbnails/'+e[a].profilePic+'" class="img-pro" />':'<img src="/user-profile.png" class="img-pro" />')+`</div>
                                    <div class="float-start text-start d-contents px-2">
                                        <div class="pro">
                                            <label class="name">`+e[a].contactName+`</label>
                                            <label class="role">`+(30<e[a].body.length?e[a].body.substring(0,30):e[a].body)+`</label>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>`;$("#search-contents").append(t),$(".content").on("click",function(){var e=$(this).data("id");$(".loading").show(),window.location.href="/?showInChat="+e})}})):($(".new-search-mess").hide(),$(".def-mess").show())}function getDuraton(e){var e=Math.round(e),t="";return 60<e&&(t=Math.floor(e/60)<10?"0"+Math.floor(e/60):Math.floor(e/60)),t+=(t?":":"00:")+(Math.floor(e%60)<10?"0"+Math.floor(e%60):Math.floor(e%60))}$(".def-mess").on("mousedown touchstart",function(e){var t=$(this);selectDefMessTimeoutId=setTimeout(function(){selectDefMessForDel=!0,showHideDelBtn(t)},1e3)}).on("mouseup mouseleave touchend",function(){clearTimeout(selectDefMessTimeoutId),setTimeout(function(){selectDefMessForDel=!1},100)}),$("#delchat-trash").on("click",function(){var t=$(".def-mess.selectfordel").attr("data-id"),a=(faTrashClicked=!0,$(".def-mess.selectfordel"));alertify.confirm("Are you share to delete this chat?",function(e){e&&$.post("/Home/DeleteUserChat",{contactId:t},function(e){e.ok&&a.remove()}),sendNotConnectMess=!1}).set({title:"ZN Vostok"}).set("closable",!1).set("labels",{ok:"Delete",cancel:"Cancel"})}),$(".def-mess").on("click",function(){var t,a;selectDefMessForDel||(faTrashClicked?faTrashClicked=!1:(t=$(this).hasClass("grp"),fromNewChat=!1,$(".loading").show(),$(".contact").removeClass("active"),$(this).addClass("active"),a=$(this).data("id"),$(this).data("id"),$.post("/Home/GetContactMessageWithLastSeen",{minId:"0",contactId:a,isGroup:t},function(e){$(".loading").hide(),null==e||0==e.length?SetEmptyMessage():(SetResultOfMessage(e.res,null,null,e.userLastSeen),$(".contact.active .text-bg-success").html("0")),t?mySignalRListener.SeenMessegeForGroup("all","all",a):mySignalRListener.SeenMessege("all",a)})))}),$("#logout").on("click",function(){$("#logoutForm").submit()}),$("#search-btn").on("click",function(){$("#searchContactModal").modal("show")}),$("#searchContact").on("keydown",function(e){13==e.keyCode&&searchonmobile()}),$(".search-contact").on("click",function(){searchonmobile()}),$(".search-contact-reset").on("click",function(){$("#searchContact").val("")}),$(".logout").on("click",function(){$("#logoutForm").submit()}),$(".setting").on("click",function(){window.location.href="/Identity/Account/Manage/Index"}),$(".chatpage").on("click",function(){window.location.href="/"}),$(".chat-mess-new").on("click",function(){$.post("/Home/AllContact",{},function(e){for(var t="",a=0;a<e.length;a++){var s=e[a];t+='<div class="new-ch contact col-12'+(ul&&ul.find(e=>e.userId.toLowerCase()==s.id.toLowerCase())?" online":"")+(s.isGroup?" grp":"")+'" data-id="'+s.id+`">
                            <div class="row">
                                <div class="col-12 mx-3 b-online">
                                    <div class="float-start mx-3 ">
                                        <img src="`+(s.id==myUserId?"/img/cloud-folder-b.svg":s.profilePic)+'" class="'+(s.id==myUserId?"mydrive":"img-pro")+`" />
                                    </div>
                                    <div class="float-start text-start d-contents px-2">
                                        <div class="pro">`+(s.isGroup?`
                                            <label class="group-name">`+(s.id==myUserId?"My Drive":(s.name||s.username)+"")+`</label>
                                            <label class="chat-bio">`+(s.id==myUserId?"Saved Message":s.companyName)+"</label>":`
                                            <label class="name">`+(s.id==myUserId?"My Drive":s.name||s.username)+`</label>
                                            <label class="company">`+(s.id==myUserId?"Saved Message":s.companyName)+`</label>
                                            <label class="role`+(s.id==myUserId?"":(s.position&&20<s.position.length?" ft-9":"")+'">'+s.position)+"</label>")+`
                                        </div>
                                    </div>
                                    <div class="on-bor" ></div>
                                </div>
                            </div>
                        </div>`}$(".selectContact").html(t),$("#selectContactModal").modal("show"),$(".new-ch").on("click",function(){fromNewChat=!0,$("#selectContactModal").modal("hide"),$(".contact").removeClass("active"),$(this).addClass("active");var t=$(this).data("id");$(this).data("id");$.post("/Home/GetContactMessage",{minId:"0",contactId:t},function(e){$(".loading").hide(),null==e||0==e.length?SetEmptyMessage():(SetResultOfMessage(e),$(".contact.active .text-bg-success").html("0")),mySignalRListener.SeenMessege("all",t)})})})}),$(".sos").on("click",function(){fromNewChat=!0,$(".contact").removeClass("active"),$(this).addClass("active");var t=$(this).data("id");$(this).data("id");$.post("/Home/GetContactMessage",{minId:"0",contactId:t},function(e){$(".loading").hide(),null==e||0==e.length?SetEmptyMessage():(SetResultOfMessage(e),$(".contact.active .text-bg-success").html("0")),mySignalRListener.SeenMessege("all",t)})}),$.fn.bsShow=function(){$(this).removeClass("d-none")},$.fn.bsHide=function(){$(this).addClass("d-none")},$("#forwardModal .close").on("click",function(){$("#forwardModal").modal("hide")}),$("#deleteModal .close , #btn-cancel-delete").on("click",function(){$("#deleteModal").modal("hide")}),$("#selectContactModal .close").on("click",function(){$("#selectContactModal").modal("hide")}),$("#search-contact").on("keypress",function(e){e=$(this).val()+e.key;searchContact(e)}),$("#search-contact").on("keyup",function(e){var t;13==e.keyCode&&(t=$("#search-contact").val(),searchContact(t)),8!=e.keyCode&&46!=e.keyCode||setTimeout(function(){var e=$("#search-contact").val();searchContact(e)},100)}),$("#refresh-page-btn").on("click",function(){window.location.reload()}),$("#localVideo , #remoteVideo").on("click",function(){0==$("#videoRemoteStyle").html().length?$("#videoRemoteStyle").html(`
            video#remoteVideo {
	            position: fixed;
	            top: 60vh;
	            left: 75vw;
	            width: 23vw;
	            height: 38vh;
                z-index:1;
            }
            video#localVideo {
	            position: fixed;
	            top: 0;
	            left: 0;
	            width: 100vw;
	            height: 100vh;
                z-index:0;
            }`):$("#videoRemoteStyle").html("")}),$(".contact .fa-trash").on("click",function(){faTrashClicked=!0;var t=$(this).parent().parent().parent(),a=t.data("id");alertify.confirm("Are you share to delete this chat?",function(e){e&&$.post("/Home/DeleteUserChat",{contactId:a},function(){t.remove()}),sendNotConnectMess=!1}).set({title:"ZN Vostok"}).set("closable",!1).set("labels",{ok:"Delete",cancel:"Cancel"})}),$(".del-chat").on("click",function(){$(".contacts .fa-trash").each(function(e,t){$(t).parent().hasClass("d-none")?$(t).parent().removeClass("d-none"):$(t).parent().addClass("d-none")})}),$(".fa-search").on("click",function(){$("#SearchModal input").val(""),$("#SearchModal").modal("show")}),$("#search-data").on("keydown",function(e){13==e.keyCode&&searchContent()}),$("#SearchModal .fa-arrow-left").on("click",function(){$("#SearchModal").modal("hide")}),$("#CreateGroupModal .fa-arrow-left").on("click",function(){$("#CreateGroupModal").modal("hide")}),$("#calllog-tab").on("click",function(){$(".calls").html(""),$.post("/home/getcall",null,function(e){for(var t="",a=0;a<e.length;a++)t+=`<div class="new-ch content col-12 m-2">
                            <div class="row">
                                <div class="col-12 mx-3">
                                    <div class="float-start mx-3 ">`+(e[a].incall?'<i class="fas fa-arrow-down-long"></i>':e[a].outcall?'<i class="fas fa-arrow-up-long"></i>':'<i class="fas fa-arrow-down-long missed" style="color:red"></i>')+(e[a].profilePic?'<img src="/ProfilePics/thumbnails/'+e[a].profilePic+'" class="img-pro" />':'<img src="/user-profile.png" class="img-pro" />')+`</div>
                                    <div class="float-start text-start px-2">
                                        <div class="pro">
                                            <label class="name">`+e[a].contactName+`</label>
                                            <label class="role">`+(e[a].isVideo?"video call":"voice call")+"  Duration:"+getDuraton(e[a].duration)+`</label>
                                            <label class="role">`+getNiceDateTimeFormat(e[a].createdDate)+`</label>
                                        </div>
                                    </div>
                                    <i class='float-end pt-3 pr-2 fa`+(e[a].isVideo?" fa-call-video":" fa-call-phone")+`' data-id="`+(e[a].userId==myUserId?e[a].toUserId:e[a].userId)+`"></i>
                                </div>
                            </div>
                        </div>`;$(".calls").html(t),$(".fa-call-video").on("click",function(){var e=$(this).attr("data-id");$(this).prev(".float-start").addClass("def-mess").addClass("active").attr("data-id",e),VideoCallProcess()}),$(".fa-call-phone").on("click",function(){var e=$(this).attr("data-id");$(this).prev(".float-start").addClass("def-mess").addClass("active").attr("data-id",e),VoiceCallProcess()})})}),$(".newgroupCreate").on("click",function(){$.post("/Home/AllContact",{},function(e){for(var t,a="",s=0;s<e.length;s++){var i=e[s];a+='<option value="'+i.id+'">'+(i.name||i.username)+"</option>"}t=`<div class="content row">
                        <div class="col-lg-3 col-md-4 col-sm-6 px-3">
                            <label for="Title">Title</label>
                            <input id="Title" name="Title" class="form-control" />
                            <span asp-validation-for="Title" class="text-danger"></span>
                        </div>
                        <div class="col-lg-3 col-md-4 col-sm-6 px-3">
                            <label asp-for="GroupBIO">GroupBIO</label>
                            <input id="GroupBIO" name="GroupBIO" class="form-control" />
                            <span asp-validation-for="GroupBIO" class="text-danger"></span>
                        </div>
                        <div class="col-12 px-3">
                            <label asp-for="GroupUserIds">Users</label>
                            <select id="GroupUserIds" name="GroupUserIds" class="form-control select-search" multiple="">
                            `+a+`
                            </select>
                            <span asp-validation-for="GroupUserIds" class="text-danger"></span>
                        </div>
                        <div class="col-12 px-3">
                            <label >&nbsp;</label>
                            <button class="btn btn-primary" id="save-group">Save Group</button>
                        </div>
                    </div>
            <link href="/css/select2.min.css" rel="stylesheet" />
            <script src="/js/select2.min.js"></script>
            <script src="/JavaScript/SimpleJs?indexOfJs=select2">
            </script>`,$("#group-contents").html(t),$("#CreateGroupModal").modal("show"),$("#save-group").on("click",function(){var e=!1;$("#Title").val()||($('[asp-validation-for="Title"]').html("Title is required."),e=!0),$("#GroupBIO").val()||($('[asp-validation-for="GroupBIO"]').html("GroupBIO is required."),e=!0),$("#GroupUserIds").val()||($('[asp-validation-for="GroupUserIds"]').html("GroupUserIds is required."),e=!0),e||$.post("/Home/CreateGroup",{Title:$("#Title").val(),GroupBIO:$("#GroupBIO").val(),GroupUserIds:$("#GroupUserIds").val()},function(e){$(".loading").show(),window.location.reload()})})})});