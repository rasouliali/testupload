var lastUserIngroup="",thisContactEmj=($(".btn-savedmessage").on("click",function(){$(".loading").show(),$(".contact").removeClass("active"),$(".mycontact").attr("data-id",myUserId),$(".mycontact").addClass("active"),$.post("/Home/GetContactMessage",{minId:"0",contactId:myUserId},function(e){lastUserIngroup="",$(".loading").hide(),null==e||0==e.length?SetEmptyMessage():(SetResultOfMessage(e),$(".contact.active .text-bg-success").html(""))})}),[]),faTrashClicked=!1,SelectLi=!1,minId="0",lmore=!1;try{JSBridge.setUserId(myUserId)}catch{}var dt1,visible=!0;function showStatus(){$("#status-options").css("opacity","1"),$("#status-options").css("visibility","visible")}function searchContact(){var e=$("#search input").val();e?($(".new-search-mess").hide(),$(".new-search-mess").removeClass("new-search-mess").addClass("search-mess"),$(".new-search-mess").html(""),$.post("/Home/GetAccounts",{searchKey:e},function(e){if($(".def-mess").hide(),0==e.length)i=`<li class="contact new-search-mess">
                        <div class="wrap">
                            <div class="meta">
                                <p class="name">Not Found</p>
                                <p class="preview">nothing!</p>
                            </div>
                        </div>
                    </li>`,$("#contacts ul").append(i);else{for(var t=0;t<e.length;t++){var a=1==e[t].status?"away":2==e[t].status?"busy":3==e[t].status?"offline":"online",i='<li class="contact new-search-mess"  data-id="'+e[t].userId.toLowerCase()+`">
                        <div class="wrap">
                            <span class="contact-status `+a+'"></span>'+(data.id==myUserId?"<img src='/img/cloud-folder-b.svg' class='mydrive' />":e[t].profilePic?'<img src="/ProfilePics/thumbnails/'+e[t].profilePic+'" alt="" />':'<img src="/user-profile.png" alt="" />')+`<div class="meta">
                                <p class="name">`+(data.id==myUserId?NaN:e[t].userName)+`<span></span></p>
                                <p class="preview"></p>
                            </div>
                        </div>
                    </li>`;$("#contacts ul").append(i)}$(".new-search-mess").on("click",function(){fromNewChat=!1,$(".contact").removeClass("active"),$(".new-search-mess").removeClass("active"),$(this).addClass("active");var t=$(this).data("id");$(this).data("id");$.post("/Home/GetContactMessage",{minId:"0",contactId:t},function(e){lastUserIngroup="",$(".loading").hide(),null==e||0==e.length?SetEmptyMessage():SetResultOfMessage(e),mySignalRListener.SeenMessege("all",t)}),getSurvey(myUserId,t),$.post("/Home/GetEmoji",{originalUserId:myUserId,selectedUserId:t},function(e){applyEmoji(e)})})}})):($(".new-search-mess").hide(),$(".def-mess").show())}function applyEmoji(e){e&&0<e.res.length?0==$("#ChatPmModal .chat-pm li").length?setTimeout(function(){applyEmoji(e)},300):(thisContactEmj=e.res,$.each(e.res,function(e,t){var a='<img class="emj-16 '+t.emoji+'" src="/emj/'+t.emoji+'.svg" />';addedEmjInChat(t.messageAccessId,a,t.emoji,t.userId,!0)}),applyReactRepBtn()):thisContactEmj=[]}function SetEmptyMessage(e){var t="",a="",e=(a=($(".contact.active").hasClass("grp")?(t=30<(e=e||$(".contact.active .group-name").html()).length?e.substring(0,29)+"...":e,$(".contact.active .chat-bio")):(t=30<(e=e||$(".contact.active .name").html()).length?e.substring(0,29)+"...":e,$(".contact.active .company").text(),$(".contact.active .role"))).text(),$(".contact.active img").attr("src")),e=`
		<div class="row">
			<div class="chat px-3">
			
			  <div class="mb-auto row">
				<div class="text-start display-block">
				  <div class="text-start float-start btn w-100">

					<div class="d-inline">
						<div class="float-start mt--5">
							<a class="active text-light close mx-2" aria-current="page" href="#" ><i class="fas fa-arrow-left"></i></a>
							<img src="`+e+`" class="img-pro-pm-chat" />
						</div>
						<div class="float-start mx-2 mt--11">
							<div class="pro-small">
								<label class="name">`+t+`</label>
								<label class="role">`+a+`</label>
								<label class="lastseen"></label>
							</div>
						</div>

						<div class="float-end text-end">
						  <div class="text-start float-end btn px-0">
							<a class="active text-light pr-2 d-none" aria-current="page" href="#" title="Deselect"><i class="fa fa-remove"></i></a>
							<a class="active text-light pr-2 d-none" aria-current="page" href="#" title="Copy"><i class="fa-solid fa-copy"></i></a>
							<a class="active text-light pr-2 d-none" aria-current="page" href="#" title="Forward"><i class="fa-solid fa-share"></i></a>
							<a class="active text-light pr-2 d-none" aria-current="page" href="#" title="Reply"><i class="fa-solid fa-reply"></i></a>
							<a class="active text-light pr-2 d-none" aria-current="page" href="#" title="Edit"><i class="fa fa-edit"></i></a>
							<a class="active text-light pr-2 d-none" aria-current="page" href="#" title="Remove"><i class="fa-solid fa-trash"></i></a>
							<a class="active text-light d-none emjbtn" aria-current="page" href="#" title="Emoji"><img width="20" src="/emojiicon.svg" /></a>
							`+($(".contact.active").hasClass("grp")?'<a class="active text-light d-none" aria-current="page" href="#"><i class="fa fa-info-circle"></i></a>':$(".contact.active").attr("data-id")!=myUserId?`
							    <a class="active text-light pr-2" aria-current="page" href="#"><i class="fas fa-phone"></i></a>
							    <a class="active text-light" aria-current="page" href="#"><i class="fas fa-video"></i></a>`:"")+`
						  </div>
						</div>
					</div>
				  </div>
				</div>
			  </div>
			  <div class="row tab-div">
				<div class="chat-pm">
        `+`<div class="chat-pm-empty ">
						<label class="text-larg">
							No message here yet!
						</label>
						<label>
							Send a message or send file or voice.
						</label>
					</div>
            <ul><li id='lastchat'></li></ul>`+`
                    <!--<div class="darkForContextMenu"></div>-->
                <a href="#" class="back-to-top z-3 d-flex align-items-center justify-content-center"><i class="fa fa-arrow-down"></i></a>
					<div id="drop-area" class="chat-pm-input ">

                        <div class="context-menu d-none">
                            <div class="origin"><div class="emj"><div><img src="/emj/Thumbs-up.svg" /></div></div><div class="emj"><div><img src="/emj/Red-heart.svg" /></div></div><div class="emj"><div><img src="/emj/Hug-face.svg" /></div></div><div class="emj"><div><img src="/emj/Joy.svg" /></div></div><div class="emj"><div><img src="/emj/Thinking-face.svg" /></div></div><div class="emj"><div><img src="/emj/Cry.svg" /></div></div><div class="emj emj-modal"><div><img src="/emj/emoji-plus.svg"/></div></div></div>
                            <div class="item reply-btn origin">Reply</div>
                            <div class="item forward-btn origin">Forward</div>
                            <div class="item copy-btn origin">Copy</div>
                            <div class="item delete-btn origin">Delete</div>
                            <div class="item reac-rep-btn origin">Reaction Report</div>
                            <div class="item survey-btn d-none">Survey Report</div>
                            <div class="item close-context" title="Close context menu">&times;</div>
                        </div>
						<textarea rows="1" class="w-100 form-control" ></textarea>
						<div class="send-btn">`+($(".contact.active").hasClass("grp")?`<div class="input-group-append" id="survey_btn">
                                <span class="input-group-text survey_btn"><img src="/img/survay.svg" /></span>
                            </div>`:"")+`<div class="input-group-append" id="microphone_btn">
                                <span class="input-group-text microphone_btn"><i class="fa fa-microphone"></i></span>
                            </div>
                            <div class="input-group-append" id="stopButton">
                                <span class="input-group-text stopButton"><i class="fa fa-stop-circle"></i></span>
                            </div>
							<img class="attach" src="/img/attach_file.png" />
							<img class="send" src="/img/send-icon.svg" />
						</div>
					</div>
                </div>
            </div>`;$("#ChatPmModal .modal-body").html(e),ul&&ul.find(e=>e.userId.toLowerCase()==$(".contact.active").data("id").toLowerCase())?$(".pro-small .lastseen").html("Online"):$.post("/Home/UserLastSeen",{contactId:$(".contact.active").data("id")},function(e){e.lastSeen&&($(".pro-small .lastseen").html(getNiceDateTimeFormat(e.lastSeen)),delevCalc(activeUserId,e.lastSeen))}),backToTop(),handleDropFileArea(),$("#ChatPmModal").modal("show"),$(".pro-small").on("click",function(){"idle"===$("body").attr("data-mode")&&($(".loading").show(),window.location.href="/Home/Profile?uid="+$(".contact.active").data("id")+"&IsGroup="+$(".contact.active").hasClass("grp"))}),$("#ChatPmModal .close").on("click",function(){fromNewChat?window.location.href="/":$("#ChatPmModal").modal("hide")}),$(".fa-video").on("click",function(){VideoCallProcess()}),$(".fa-phone:not(.red)").on("click",function(){VoiceCallProcess()}),$(".lmore").on("click",function(){lmore=!0;var e=$(".contact.active").data("id");$.post("/Home/GetContactMessage",{minId:minId,contactId:e},function(e){$(".loading").hide(),null!=e&&0<e.length&&(SetResultOfMessage(e),$(".contact.active .text-bg-success").html(""))})}),setTimeout(function(){$(".chat-pm ul").scrollTop($(".chat-pm ul").get(0).scrollHeight)},500),setSomeFeatureForSendingMess(),loadRecData(),$("li .card .card-header").on("click",function(){var e,t,a=$(this).data("senderid");a?($("#ChatPmModal").modal("hide"),$(".contact.active").removeClass("active"),$('.contact[data-id="'+a.toLowerCase()+'"]').addClass("active"),setTimeout(function(){$('.contact[data-id="'+a.toLowerCase()+'"]').trigger("click")},400)):(e=$(this).parent().data("id"),t=0<(t=$('[data-id="'+e+'"]').get(0).offsetTop-150)?t:0,$(".chat-pm ul").scrollTop(t),$('[data-id="'+e+'"]').eq(0).css("background","black"),setTimeout(function(){$('[data-id="'+e+'"]').eq(0).css("background","transparent")},500),setTimeout(function(){$('[data-id="'+e+'"]').eq(0).css("background","black")},1e3),setTimeout(function(){$('[data-id="'+e+'"]').eq(0).css("background","transparent")},1500))}),surveyCreator()}function handleDropFileArea(){let t=document.getElementById("drop-area");function a(e){e.preventDefault(),e.stopPropagation()}function i(e){t.classList.add("highlight")}function s(e){t.classList.remove("highlight")}["dragenter","dragover","dragleave","drop"].forEach(e=>{t.addEventListener(e,a,!1)}),["dragenter","dragover"].forEach(e=>{t.addEventListener(e,i,!1)}),["dragleave","drop"].forEach(e=>{t.addEventListener(e,s,!1)}),t.addEventListener("drop",function(e){e=e.dataTransfer,e=e.files[0];var t=new FormData,e=(t.append("file1",e),$(".contact.active").data("id"));t.append("contactId",e),t.append("replyId",replyid);$("#lastchat").before(`<li class="from-me" id="tempProgressBar" >
              <div class="progress">
                <div class="progress-bar" id="my-progress-bar" role="progressbar" style="width: 25%" aria-valuenow="25" aria-valuemin="0" aria-valuemax="100">25%</div>
              </div>
            </li>`),$(".chat-pm ul").scrollTop($(".chat-pm ul").get(0).scrollHeight),setTimeout(function(){$(".chat-pm ul").scrollTop($(".chat-pm ul").get(0).scrollHeight)},500),uploadFile(t)},!1)}function VideoCallProcess(){var e;$(".two-img").addClass("hideinmobile"),"idle"!==$("body").attr("data-mode")?alertify.error("Sorry, you are already in a call.  Conferencing is not yet implemented.",5):(e=$(".def-mess.active").attr("data-id"))!=myUserId?($("body").removeAttr("data-json"),resetVideoAudioCall(),"Connected"!=mySignalRListener.wsconn.connectionState&&"Connected"!=mySignalRListener.wsconn.M?SendNotConnectAlert("you are not connect to signalr. For video call you must refresh page. For refresh page touch on ok button."):(beepring.play(),beepring.volume=.1,$("#call-status-lbl").html("video calling to user..."),isVideoCall=!0,console.log("calling user... "),$("#VideoCallModalLabel").html("Video Call"),$(".partner")[0].style.display="none",localVideo.style.display="",remoteVideo.style.display="",$("#CallingModal .video").addClass("active"),$("#CallingModal .video video").show(),$(".call-buttons img").removeClass("active"),$.post("/Home/CallLogUpdate",{IsVideo:!0,Status:1,ToUser:e},function(){}),initializeUserMediaVideo(),mySignalRListener.callUser(e,!0),dt1=new Date,$(".page4 .txt-timer").eq(0).attr("st",dt1),$(".page4 .txt-timer").eq(1).attr("st",dt1),videoaudiotimer=setTimeout(timerDisplayFun,1e3),$("body").attr("data-mode","calling"),$("#CallingModal").modal("show"),$("#GotoCall").addClass("active"),$("#CallingModal .screen").removeClass("active"),$("#CallingModal .page1").hide(),$("#CallingModal .page3").hide(),$("#CallingModal .page4").hide(),$("#CallingModal .page2").show(),$("#CallingModal img.me").attr("src",myprofilepic),$("#CallingModal .row.blur-img").css("background-image","url('"+$(".def-mess.active img").attr("src")+"')"),$("#CallingModal img.other").eq(0).attr("src",$(".def-mess.active img").attr("src")),$("#CallingModal .page1 img.other, #CallingModal .page2 img.other, #CallingModal .page3 img.other").attr("src",$(".def-mess.active img").attr("src")),$("#CallingModal .page4 img.other").eq(0).attr("src",$(".def-mess.active img").attr("src")),$("#CallingModal h3.other").eq(0).html($(".def-mess.active label.name").text()),$("#CallingModal label.me").html(myname),$("#CallingModal label.other").eq(0).html($(".def-mess.active label.name").text()),$(".page4 .persons").eq(1).attr("data-id",myUserId),$(".page4 .persons").eq(2).attr("data-id",e),$("#callstatus").text("Calling..."))):alertify.error("Ah, nope.  Can't call yourself.",5)}function resetVideoAudioCall(){if(2<$(".page4 .persons").length)for(var e=$(".page4 .persons").length-1;2<e;e--)$(".page4 .persons").eq(e).remove();remoteVideo.removeAttribute("data-userid"),partnerAudio.removeAttribute("data-userid");for(var t=$("#CallingModal .video"),e=t.length-1;0<=e;e--)0==t.eq(e).hasClass("local")&&0==t.eq(e).hasClass("i1")?t.eq(e).remove():"videoDivInvisible"==t.eq(e).parent().attr("id")&&t.eq(e).appendTo($("#videoDiv"));for(e=(t=$(".audio.partner")).length-1;1<e;e--)t.eq(e).remove();$("body").attr("data-json",""),arrRemoteAudio=[],arrRemoteVideo=[]}function VoiceCallProcess(){var e;$(".two-img").removeClass("hideinmobile"),"idle"!==$("body").attr("data-mode")?alertify.error("Sorry, you are already in a call. For add member please touch add member button in call option.",5):(e=$(".def-mess.active").attr("data-id"))!=myUserId?"Connected"!=mySignalRListener.wsconn.connectionState&&"Connected"!=mySignalRListener.wsconn.M?SendNotConnectAlert("you are not connect to signalr. For voice call you must refresh page. For refresh page touch on ok button."):($("#call-status-lbl").html("voice calling to user..."),isVideoCall=!1,localVideo.style.display="none",remoteVideo.style.display="none",$("#VideoCallModalLabel").html("Voice Call"),console.log("calling user... "),$("#CallingModal .video").removeClass("active"),$("#CallingModal .screen").removeClass("active"),$("#CallingModal .video video").hide(),$(".call-buttons img").removeClass("active"),$.post("/Home/CallLogUpdate",{IsVideo:!1,Status:1,ToUser:e},function(){}),initializeUserMediaVoice(),mySignalRListener.callUser(e,!1),beepring.volume=.1,beepring.play(),dt1=new Date,$(".page4 .txt-timer").eq(0).attr("st",dt1),$(".page4 .txt-timer").eq(1).attr("st",dt1),videoaudiotimer=setTimeout(timerDisplayFun,1e3),$("body").attr("data-mode","calling"),$("#ChatPmModal").modal("hide"),$("#CallingModal").modal("show"),$("#GotoCall").addClass("active"),$("#CallingModal .page1").hide(),$("#CallingModal .page3").hide(),$("#CallingModal .page4").hide(),$("#CallingModal .page2").show(),$("#CallingModal img.me").attr("src",myprofilepic),$("#CallingModal .row.blur-img").css("background-image","url('"+$(".def-mess.active img").attr("src")+"')"),$("#CallingModal .page1 img.other, #CallingModal .page2 img.other, #CallingModal .page3 img.other").attr("src",$(".def-mess.active img").attr("src")),$("#CallingModal .page4 img.other").eq(0).attr("src",$(".def-mess.active img").attr("src")),$("#CallingModal h3.other").eq(0).html($(".def-mess.active label.name").text()),$("#CallingModal label.me").html(myname),$("#CallingModal label.other").eq(0).html($(".def-mess.active label.name").text()),$("#callstatus").text("Calling..."),$(".page4 .persons").eq(1).attr("data-id",myUserId),$(".page4 .persons").eq(2).attr("data-id",e)):alertify.error("Ah, nope.  Can't call yourself.",5)}function timerDisplayFun(){var e=new Date,t=e-new Date($(".page4 .txt-timer").eq(0).attr("st")),a=Math.floor(t/1e3%60),i=Math.floor(t/1e3/60);if($("#CallingModal .page3 .txt-timer").html((i<10?"0":"")+i.toString()+":"+(a<10?"0":"")+a.toString()),$("#CallingModal .page4 .txt-timer").eq(0).html((i<10?"0":"")+i.toString()+":"+(a<10?"0":"")+a.toString()),$("#CallingModal .page4 .txt-timer").eq(1).html((i<10?"0":"")+i.toString()+":"+(a<10?"0":"")+a.toString()),2<$("#CallingModal .page4 .txt-timer").length)for(var s=2;s<$("#CallingModal .page4 .txt-timer").length;s++){t=e-new Date($(".page4 .txt-timer").eq(s).attr("st")),a=Math.floor(t/1e3%60),i=Math.floor(t/1e3/60);$("#CallingModal .page4 .txt-timer").eq(s).html((i<10?"0":"")+i.toString()+":"+(a<10?"0":"")+a.toString())}videoaudiotimer=setTimeout(timerDisplayFun,1e3)}function ProcessLinkMess(e){var a=e.split(" "),i="";return $.each(a,function(e,t){a[e].toLowerCase().startsWith("http:")||a[e].toLowerCase().startsWith("https:")?i+='<a href="'+a[e]+'" >'+a[e]+"</a> ":i+=a[e]+" "}),i}function SetResultOfMessage(e,t,a,i){var s="";0==lmore&&(s+="<ul>"),(minId=0<e.length?e[e.length-1].id:minId)>parseInt($(".contact.active").attr("minid"))&&(s+="<li class='lmore'><button class='btn btn-info'>load more</button></li>");for(var o,l,n=e.length-1;0<=n;n--){var c=e[n].profilePic?"/ProfilePics/thumbnails/"+e[n].profilePic:"/img/person-icon.png",r=!1,d=0;if(e[n].body=ProcessLinkMess(e[n].body),e[n].body&&e[n].body.startsWith("@@@announcementData:")&&(r=!0,e[n].body=e[n].body.substring("@@@announcementData:".length),e[n].isFile=!1,d=parseInt(e[n].body.substring(0,e[n].body.indexOf(":"))),e[n].body=e[n].body.substring(e[n].body.indexOf(":")+1)),0==e[n].isFile)s+='<li class="'+(e[n].isReciver?"from-me":"from-other")+(r?" announcement":"")+'" data-id="'+e[n].id+'" >'+(e[n].grpContactName&&lastUserIngroup!=e[n].grpContactName?"<div class='"+(e[n].isReciver?"float-end":"float-start")+"'><img src='"+c+"' class='img-pro' /></div><div class='"+(e[n].isReciver?"float-end":"float-start")+" name'>"+e[n].grpContactName+"</div>":"")+(0<=e[n].body.indexOf(",;,")?'<div class="card" data-id="'+(e[n].replyId||"")+`" >
                      <div class="card-header" `+ForwardSenderId(e[n].body)+">"+e[n].body.split(",;,")[0].split(",@,")[0]+`
                      </div><label`+checkRtlOfText(e[n].body.split(",;,")[1])+">"+textToWrite(e[n].body.split(",;,")[1])+"</label></div>":"<label"+checkRtlOfText(e[n].body)+">"+textToWrite(e[n].body)+"</label>")+(e[n].isReciver?'<span class="'+IsSeen(e[n])+'">✓</span>':"")+'</li><li class="'+(e[n].isReciver?"from-me":"from-other")+(r?" announcement":"")+`" >
                    <div class="date">`+getNiceDateTimeFormat(e[n].createdDate)+`</div>
                </li>`,0<d&&removeLiAfterSecond(e[n].id,1e3*(d+1));else{var m=[],p=(m.push(e[n].body),"");0<=e[n].body.indexOf("^")&&(m=e[n].body.split("^"),p="");for(var v=0;v<m.length;v++){var h=m[v];0<m[v].indexOf(",;,")&&(h=m[v].split(",;,")[1],p=m[v].split(",;,")[0],m[v]=m[v].replace(",;,"," ")),s=(s+='<li class="'+(e[n].isReciver?"from-me":"from-other")+'" data-id="'+e[n].id+'" >')+(e[n].grpContactName&&lastUserIngroup!=e[n].grpContactName?"<div class='"+(e[n].isReciver?"float-end":"float-start")+"'><img src='"+c+"' class='img-pro' /></div><div class='"+(e[n].isReciver?"float-end":"float-start")+" name'>"+e[n].grpContactName+"</div>":""),p&&(s+='<div class="card" data-id="'+(replyid||"")+`" >
                      <div class="card-header " `+ForwardSenderId(p)+">"+p.split(",@,")[0]+"</div>"),IsImage(removeCaptionFromFilename(h))?s+='<label ><a href="/Home/GetFile?fileName='+removeCaptionFromFilename(h)+'&fileType=up" class="js-smartPhoto img-tag"><div><img  class="fupload" src="/Home/GetFile?fileName='+removeCaptionFromFilename(h)+'&fileType=up&th=true" /></div><div>'+SimpleFileName(h)+"</div></a></label>":IsAudio(removeCaptionFromFilename(h))?s+='<label><div><audio controls src="/Home/GetFile?fileName='+removeCaptionFromFilename(h)+'&fileType=up" ></audio></div><div> '+SimpleFileName(h)+"</div></label>":IsVideo(h)?s+='<label><div><video controls  ><source src="/Home/GetFile?fileName='+removeCaptionFromFilename(h)+'&fileType=up" ></video></div><div> '+SimpleFileName(h)+"</div></label>":IsPdfOrDoc(removeCaptionFromFilename(h))?s+='<label><a href="/Home/GetFile?fileName='+removeCaptionFromFilename(h)+'&fileType=up" target="_blank" ><div><img class="docpdfimg" src="/Home/GetFile?fileName='+removeCaptionFromFilename(h).substring(0,removeCaptionFromFilename(h).lastIndexOf("."))+'.jpg&fileType=up&th=true" /></div><div>'+SimpleFileName(h)+"</div></a></label>":s+='<label><a href="/Home/GetFile?fileName='+removeCaptionFromFilename(h)+'&fileType=up" target="_blank" ><div><img src="/img/file-icon.png"  /></div><div>'+SimpleFileName(h)+"</div></a></label>",p&&(s+="</div>"),s=(s+=(e[n].isReciver?'<span class="'+IsSeen(e[n])+'">✓</span>':"")+"</li>")+('<li class="'+(e[n].isReciver?"from-me":"from-other")+"\" ><div class='date'>"+getNiceDateTimeFormat(e[n].createdDate)+"</div></li>")}}e[n].grpContactName&&(lastUserIngroup=e[n].grpContactName)}lmore?($(".lmore").before(s),(1<$(".lmore").length?$($(".lmore")[1]):$(".lmore")).remove(),lmore=!1,$(".lmore").on("click",function(){lmore=!0;var e=$(".contact.active").data("id");$.post("/Home/GetContactMessage",{minId:minId,contactId:e},function(e){$(".loading").hide(),null!=e&&0<e.length&&(SetResultOfMessage(e),$(".contact.active .text-bg-success").html(""))})})):(s+="<li id='lastchat'></li></ul>",l=o="",l=($(".contact.active").hasClass("grp")?(o=30<(a=a||$(".contact.active .group-name").html()).length?a.substring(0,29)+"...":a,$(".contact.active .chat-bio")):(o=30<(a=a||$(".contact.active .name").html()).length?a.substring(0,29)+"...":a,$(".contact.active .company").text(),$(".contact.active .role"))).text(),a=`
		<div class="row">
			<div class="chat px-3">
			
			  <div class="mb-auto row">
				<div class="text-start display-block">
				  <div class="text-start float-start btn w-100">

					<div class="d-inline">
						<div class="float-start mt--5">
							<a class="active text-light close mx-2" aria-current="page" href="#" ><i class="fas fa-arrow-left"></i></a>
							<img src="`+$(".contact.active img").attr("src")+`" class="img-pro-pm-chat" />
						</div>
						<div class="float-start mx-2 mt--11">
							<div class="pro-small" >
								<label class="name">`+o+`</label>
								<label class="role">`+l+`</label>
								<label class="lastseen"></label>
							</div>
						</div>

						<div class="float-end text-end">
						  <div class="text-start float-end btn px-0">
							<a class="active text-light pr-2 d-none" aria-current="page" href="#" title="Deselect"><i class="fa fa-remove"></i></a>
							<a class="active text-light pr-2 d-none" aria-current="page" href="#" title="Copy"><i class="fa-solid fa-copy"></i></a>
							<a class="active text-light pr-2 d-none" aria-current="page" href="#" title="Forward"><i class="fa-solid fa-share"></i></a>
							<a class="active text-light pr-2 d-none" aria-current="page" href="#" title="Reply"><i class="fa-solid fa-reply"></i></a>
							<a class="active text-light pr-2 d-none" aria-current="page" href="#" title="Edit"><i class="fa fa-edit"></i></a>
							<a class="active text-light pr-2 d-none" aria-current="page" href="#" title="Remove"><i class="fa-solid fa-trash"></i></a>
							<a class="active text-light pr-2 d-none emjbtn" aria-current="page" href="#" title="Emoji"><img width="20" src="/emojiicon.svg" /></a>
							`+($(".contact.active").hasClass("grp")?'<a class="active text-light d-none" aria-current="page" href="#"><i class="fa fa-info-circle"></i></a>':$(".contact.active").attr("data-id")!=myUserId?`
							    <a class="active text-light pr-2" aria-current="page" href="#"><i class="fas fa-phone"></i></a>
							    <a class="active text-light" aria-current="page" href="#"><i class="fas fa-video"></i></a>`:"")+`
						  </div>
						</div>
					</div>
				  </div>
				</div>
			  </div>
			  <div class="row tab-div">
				<div class="chat-pm">
        `+s+`
                 <!--<div class="darkForContextMenu"></div>-->
                <a href="#" class="back-to-top z-3 d-flex align-items-center justify-content-center"><i class="fa fa-arrow-down"></i></a>
					<div id="drop-area" class="chat-pm-input ">
                        <div class="context-menu d-none">
                            <div class="origin"><div class="emj"><div><img src="/emj/Thumbs-up.svg" /></div></div><div class="emj"><div><img src="/emj/Red-heart.svg" /></div></div><div class="emj"><div><img src="/emj/Hug-face.svg" /></div></div><div class="emj"><div><img src="/emj/Joy.svg" /></div></div><div class="emj"><div><img src="/emj/Thinking-face.svg" /></div></div><div class="emj"><div><img src="/emj/Cry.svg" /></div></div><div class="emj emj-modal"><div><img src="/emj/emoji-plus.svg"/></div></div></div>
                            <div class="item reply-btn origin">Reply</div>
                            <div class="item forward-btn origin">Forward</div>
                            <div class="item copy-btn origin">Copy</div>
                            <div class="item delete-btn origin">Delete</div>
                            <div class="item reac-rep-btn origin">Reaction Report</div>
                            <div class="item survey-btn d-none">Survey Report</div>
                            <div class="item close-context">&times;</div>
                        </div>
						<textarea rows="1" class="w-100 form-control" ></textarea>
						<div class="send-btn">`+($(".contact.active").hasClass("grp")?`<div class="input-group-append" id="survey_btn">
                                <span class="input-group-text survey_btn"><img src="/img/survay.svg" /></span>
                            </div>`:"")+`<div class="input-group-append" id="microphone_btn">
                                <span class="input-group-text microphone_btn"><i class="fa fa-microphone"></i></span>
                            </div>
                            <div class="input-group-append" id="stopButton">
                                <span class="input-group-text stopButton"><i class="fa fa-stop-circle"></i></span>
                            </div>
							<img class="attach" src="/img/attach_file.png" />
							<img class="send" src="/img/send-icon.svg" />
						</div>
					</div>
                </div>
            </div>`,$("#ChatPmModal .modal-body").html(a),o=$(".contact.active").data("id"),i?($(".pro-small .lastseen").html(getNiceDateTimeFormat(i)),delevCalc(o,i)):(l=$(".pro-small .lastseen").html())&&delevCalc(o,l.split(" ")[0]+" "+l.split(" ")[1]),backToTop(),handleDropFileArea(),0<$(".js-smartPhoto:not(.proc)").length&&(new SmartPhoto(".js-smartPhoto:not(.proc)"),$(".js-smartPhoto:not(.proc)").addClass("proc")),$("#close-img-modal").on("click",function(){$("#imgViewerModal").modal("hide")}),$("#ChatPmModal").modal("show"),$(".pro-small").on("click",function(){"idle"===$("body").attr("data-mode")&&($(".loading").show(),window.location.href="/Home/Profile?uid="+$(".contact.active").data("id")+"&IsGroup="+$(".contact.active").hasClass("grp"))}),$("#ChatPmModal .close").on("click",function(){fromNewChat?($(".loading").show(),window.location.href="/"):($(".contact").removeClass("active"),$("#ChatPmModal").modal("hide"))}),$(".chat-pm-input textarea").on("keyup",function(){hasPersian($(this).val())?$(this).addClass("rtl"):$(this).removeClass("rtl")}),$(".fa-video").on("click",function(){$(".page3").children().eq(0).children().eq(1).find(".text-success").html("In Call With"),VideoCallProcess()}),$(".fa-phone:not(.red)").on("click",function(){VoiceCallProcess()}),$(".lmore").on("click",function(){lmore=!0;var e=$(".contact.active").data("id");$.post("/Home/GetContactMessage",{minId:minId,contactId:e},function(e){$(".loading").hide(),null!=e&&0<e.length&&(SetResultOfMessage(e),$(".contact.active .text-bg-success").html(""))})}),setTimeout(function(){t?($(".chat-pm ul").scrollTop($('[data-id="'+t+'"]').offset().top),$('[data-id="'+t+'"]').removeClass("showinchat"),setTimeout(function(){$('[data-id="'+t+'"]').addClass("showinchat"),$("#showinchatStyle").html("")},500),setTimeout(function(){$('[data-id="'+t+'"]').removeClass("showinchat")},1e3),setTimeout(function(){$('[data-id="'+t+'"]').addClass("showinchat")},1500),setTimeout(function(){$('[data-id="'+t+'"]').removeClass("showinchat")},2e3)):$(".chat-pm ul").scrollTop($(".chat-pm ul").get(0).scrollHeight)},500),setSomeFeatureForSendingMess(),loadRecData(),$("img:not(.proc),video source:not(.proc),audio:not(.proc)").on("error",function(){reloadFile($(this))}),$("img:not(.proc),video source:not(.proc),audio:not(.proc)").addClass("proc"),$("li .card .card-header").on("click",function(){var e,t=$(this).data("senderid");t?($("#ChatPmModal").modal("hide"),$(".contact.active").removeClass("active"),$('.contact[data-id="'+t.toLowerCase()+'"]').addClass("active"),setTimeout(function(){$('.contact[data-id="'+t.toLowerCase()+'"]').trigger("click")},400)):(e=$(this).parent().data("id"),$(".chat-pm ul").scrollTop($('[data-id="'+e+'"]').get(0).offsetTop-200),$('[data-id="'+e+'"]').eq(0).css("background","black"),setTimeout(function(){$('[data-id="'+e+'"]').eq(0).css("background","transparent")},500),setTimeout(function(){$('[data-id="'+e+'"]').eq(0).css("background","black")},1e3),setTimeout(function(){$('[data-id="'+e+'"]').eq(0).css("background","transparent")},1500))}),surveyCreator())}function removeLiAfterSecond(e,t){setTimeout(function(){$('li[data-id="'+e+'"]').next("li.announcement").remove(),$('li[data-id="'+e+'"].announcement').remove()},t)}$(".expand-button , #profile-img").on("click",showStatus),$($("#profile p")[0]).on("click",showStatus),$(document).on("click",function(){(visible=!visible)&&($("#status-options").css("opacity","0"),$("#status-options").css("visibility","hidden"))}),$("#status-options li").on("click",function(){var e=$(this).attr("id").split("-")[1];$("#profile-img").removeAttr("class"),$("#profile-img").addClass(e),$.post("/Home/SetStatus",{status:e},function(){})}),$("#search input").on("keydown",function(e){13==e.keyCode&&searchContact()});var listFileError=[];function delevCalc(e,t){if(e==$(".contact.active").data("id")&&0==$(".contact.active").hasClass("grp"))for(var a,i=$("#ChatPmModal .modal-body li span:not(.seen):not(.delev)").length,s=$("#ChatPmModal .modal-body li.from-me"),o=($("#ChatPmModal .modal-body li.from-me").find("div.date"),ul&&ul.find(e=>e.userId.toLowerCase()==$(".contact.active").data("id").toLowerCase())),l=0;l<i;l+=2)s.eq(l).find("span:not(.seen):not(.delev)")&&(a=(a=s.eq(l+1).find("div.date").html()).split(" ")[0]+" "+a.split(" ")[1],o||new Date(a)<new Date(t))&&s.eq(l).addClass("delev")}function reloadFile(e){var t=e.attr("src");listFileError.push(t),listFileError.filter(e=>e==t).length<3&&(e.removeAttr("src"),setTimeout(function(){e.attr("src",t)},1500))}function removeCaptionFromFilename(e){if(e)return 0<=e.indexOf("||")?e.split("||")[0]:e}function SimpleFileName(e){return e?0<=e.indexOf("||")?unicodeToChar(e.split("||")[1]):25<e.length?unicodeToChar(e).substring(0,12)+"..."+unicodeToChar(e).substring(unicodeToChar(e).length-10):unicodeToChar(e):""}function unicodeToChar(e){return e.replace(/\\u[\dA-F]{4}/gi,function(e){return String.fromCharCode(parseInt(e.replace(/\\u/g,""),16))})}function ForwardSenderId(e){return e&&0<e.indexOf(",@,")?' data-senderid="'+e.split(",@,")[1].split(">>")[0]+'" ':""}function IsSeen(e){return e.isSeen||null==e.isSeen?"seen":""}function loadImageModal(e){$("#img").attr("src",e),$("#download-img").attr("href",e),start(),$("#img").removeClass("d-none"),$("#imgViewerModal").modal("show"),$("#img").on("load",function(){var e,t,a,i=this.width,s=this.height,o=$(window).width()-10,l=$(window).height()-160;i<=o&&s<=l?($("#canvas").attr("height",i),$("#canvas").attr("width",s),$("#img").addClass("d-none")):(a=t=0,a=(l=((e=s<=l?l:s)-(s<=l?s:l))/e)<(o=((e=i<=o?o:i)-(i<=o?i:o))/e)?(t=i*(1-o),s*(1-o)):(t=i*(1-l),s*(1-l)),$("#canvas").attr("height",a),$("#canvas").attr("width",t),$("#img").addClass("d-none"),console.log("newH-newW",a+","+t)),initDraw(),$(".loading").hide()}),$(".loading").show()}$("#showInChatBtn").on("click",function(){var e;"#images-tab"==$(".nav-link.active").attr("data-bs-target")?(e=$(".img-tag.selected").data("id"),window.location.href="/?showInChat="+e):"#files-tab"==$(".nav-link.active").attr("data-bs-target")?(e=$(".file-tag.selected").data("id"),window.location.href="/?showInChat="+e):"#voices-tab"==$(".nav-link.active").attr("data-bs-target")&&(e=$(".voice-tag.selected").data("id"),window.location.href="/?showInChat="+e)});var selectDefMessTimeoutId,innerHtmlReply="",replyid="",editid="",beforeReplytext="",forwardid="",deleteid="";function setSomeFeatureForSendingMess(){sendMessagebtn(),loadForSelectLi(),allDropDownButtonProcess()}function sendMessagebtn(){$(".send-btn .send").on("click",function(e){SendMessageProcess(!1)}),$(".send-btn .attach").on("click",SendFileProcess),$(".chat-pm-input textarea").on("keydown",function(e){if(13==e.keyCode&&e.shiftKey)return SendMessageProcess(!1),!1})}function allDropDownButtonProcess(){deselectBtnProcess(),copyBtnProcess(),replyBtnProcess(),seenListBtnProcess(),editBtnProcess(),forwardBtnProcess(),deleteBtnProcess(),emojiBtnProcess(),emojiContextMenuProcess()}function SendMessageProcess(l){l=l||!1;var n,e="",c="";$(".chat-pm-empty").hide(),c=(0==l?(e=$(".chat-pm-input textarea").val(),$(".contact.active")):$("#forward-body .mess.active")).data("id"),(e||l)&&($(".loading").show(),0==l&&$(".chat-pm-input textarea").val(""),n=c,$.post("/Home/sendMess",{mess:e,contactId:c,replyId:l?"":replyid,forwardId:l?forwardid:"",editId:editid},function(e){if($(".loading").hide(),0==l||$("#forward-body .mess.active").data("id")==$(".contact.active").data("id")){for(var t="",a="",i=0;i<e.length;i++){var s=e[i].profilePic?"/ProfilePics/thumbnails/"+e[i].profilePic:"/img/person-icon.png";e[i].body=ProcessLinkMess(e[i].body),a=0<=e[i].body.indexOf(",;,")?textToWrite(e[i].body.split(",;,")[1]):textToWrite(e[i].body),t+='<li class ="from-me" data-id="'+e[i].id+'" data-time="'+e[i].createdDate+'">'+(e[i].grpContactName?"<div class='float-end'><img src='"+s+"' class='img-pro' /></div><div class='float-end name'>"+e[i].grpContactName+"</div>":"")+(0<=e[i].body.indexOf(",;,")?'<div class="newcard" data-id="'+(e[i].replyId||"")+`" >
                              <div class="card-header">
                              `+e[i].body.split(",;,")[0]+`
                              </div><label`+checkRtlOfText(e[i].body.split(",;,")[1])+">"+textToWrite(e[i].body.split(",;,")[1])+"</label><span >✓</span></div>":"<label "+checkRtlOfText(e[i].body)+">"+textToWrite(e[i].body)+"</label><span >✓</span>")+'</li><li class ="from-me" ><div class="date" data-id="'+(e[i].replyId||"")+'" >'+getNiceDateTimeFormat(e[i].createdDate)+"</div></li>"}editid?$('li[data-id="'+editid+'"] label').html(a):$("#lastchat").before(t),$("li .newcard:not(.card) .card-header").on("click",function(){var e=$(this).parent().data("id");$(".chat-pm ul").scrollTop($('[data-id="'+e+'"]').get(0).offsetTop-200),$('[data-id="'+e+'"]').eq(0).css("background","black"),setTimeout(function(){$('[data-id="'+e+'"]').eq(0).css("background","transparent")},500),setTimeout(function(){$('[data-id="'+e+'"]').eq(0).css("background","black")},1e3),setTimeout(function(){$('[data-id="'+e+'"]').eq(0).css("background","transparent")},1500)}),$("li .newcard:not(.card)").addClass("card"),editid||$(".chat-pm ul").scrollTop($(".chat-pm ul").get(0).scrollHeight),0==l?($(".chat-pm-input textarea").val(""),(replyid||editid)&&($(".chat-pm-input .card-header a").trigger("click"),editid=replyid="")):$(".chat-pm li").removeClass("selected"),loadForSelectLi()}var o;$("img:not(.proc),video source:not(.proc),audio:not(.proc)").on("error",function(){reloadFile($(this))}),$("img:not(.proc),video source:not(.proc),audio:not(.proc)").addClass("proc"),l&&$(".chat-pm li").removeClass("selected"),contact_must_be_selected(),n!=myUserId?$(".contact.active").hasClass("grp")?mySignalRListener.sendBySignalRToGroup(c,e[0].createdDate+";;;"+userid+";;;"+e[0].body+";;;"+e[0].id+";;;"+(l?"":replyid)+(l?forwardid:"")):mySignalRListener.sendBySignalR(c,e[0].createdDate+";;;"+userid+";;;"+e[0].body+";;;"+e[0].id+";;;"+(l?"":replyid)+(l?forwardid:"")):$("li span:not(.seen):not(.delev)").addClass("seen"),$(".chat-pm-input textarea").focus(),0<$("li span:not(.seen):not(.delev)").length&&(ul&&ul.find(e=>e.userId.toLowerCase()==n.toLowerCase())?delevCalc(n,e.lastSeen):(o=$(".pro-small .lastseen").html(),delevCalc(n,o.split(" ")[0]+" "+o.split(" ")[1])))}))}var clientXY,fromNewChat,selectDefMessForDel=!1;function showHideDelBtn(e){0==e.find(".btn-danger").length?alertify.error("This is group. Group does not has any option.",5):e.hasClass("selectfordel")?($(".def-mess").removeClass("selectfordel"),$("#delchat-trash").bsHide()):($(".def-mess").removeClass("selectfordel"),e.addClass("selectfordel"),$("#delchat-trash").bsShow())}function searchonmobile(){$("#search input").val($("#searchContact").val()),searchContact(),$("#searchContactModal").modal("hide")}function saveToDb(e,t,a){$.post("/Home/SaveAddress",{Latitude:e,Longitude:t,Address:a},function(e){console.log("logSaveAddress"+e)})}function IsImage(e){e=e.toLowerCase().substring(e.lastIndexOf("."));return!![".jpg",".jpeg",".bmp",".png",".gif",".tiff"].includes(e)}function IsAudio(e){e=e.toLowerCase().substring(e.lastIndexOf("."));return!![".wav",".mp3"].includes(e)}function IsVideo(e){e=e.toLowerCase().substring(e.lastIndexOf("."));return!![".mp4",".webm",".m4p",".mkv",".mpg",".3gp",".avi",".mov",".mp2",".ogg",".3gp",".qt",".3gp"].includes(e)}function IsPdfOrDoc(e){e=e.toLowerCase().substring(e.lastIndexOf("."));return!![".doc",".docx",".pdf"].includes(e)}function searchContact(a){a?$(".selectContact .new-ch").each(function(e,t){0<=$(t).find(".pro").text().toLowerCase().indexOf(a.toLowerCase())&&$(t).prevAll(".contact-tree").first().hasClass("active")?($(t).bsShow(),$(t).show()):($(t).bsHide(),$(t).hide())}):$.each($(".selectContact .new-ch"),function(e,t){$(this).prevAll(".contact-tree").first().hasClass("active")?($(this).bsShow(),$(this).show()):($(this).bsHide(),$(this).hide())})}function fullScreenVideo(e){var t=e.attr("id");e.parent().hasClass("screen")?0==$("#videoRemoteStyle").html().length?$("#videoRemoteStyle").html(`
        .page3 div, .video, .call-buttons, .incall-buttons ,.video {display:none !important;}
        .screen:has(#`+t+`){display:block !important;}
            video#`+t+` {
	            position: fixed;
	            top: 0;
	            left: 0;
	            width: 100vw;
	            height: 100vh;
                z-index:100000;
            }`):$("#videoRemoteStyle").html(""):0==$("#videoRemoteStyle").html().length?$("#videoRemoteStyle").html(`
        .page3 div, .video, .call-buttons, .incall-buttons,.screen {display:none !important;}
        .video:has(#`+t+`){display:block !important;}
            video#`+t+` {
	            position: fixed;
	            top: 0;
	            left: 0;
	            width: 100vw;
	            height: 100vh;
                z-index:100000;
            }`):$("#videoRemoteStyle").html("")}function hasPersian(e){return!(!e||null!==(m=e.match(/[آ-ی]|([a-zA-Z])/))&&m[1])}function checkRtlOfText(e){return hasPersian(e)?" class='direction-rtl'":""}function textToWrite(e){return e.split("\n").join("<br />\n")}function backToTop(){let e=$(".back-to-top").get(0);e&&$(".chat-pm ul").get(0).addEventListener("scroll",function(){$(".chat-pm ul").get(0).scrollHeight-$(".chat-pm ul").scrollTop()>1.5*$(window).height()?e.classList.add("active"):e.classList.remove("active")}),$(".back-to-top,.fa-arrow-down").on("click",function(){$(".chat-pm ul").scrollTop($(".chat-pm ul").get(0).scrollHeight)})}function searchContent(){var e=$("#SearchModal input").val();e?($("#search-contents").html(""),$.post("/Home/GetSearchContent",{searchKey:e},function(e){if(0==e.length)t=`<ul><li class="content new-search-content">
                        <div class="wrap">
                            <div class="meta">
                                <p class="name">Not Found</p>
                                <p class="preview">nothing!</p>
                            </div>
                        </div>
                    </li></ul>`,$("#search-contents").append(t);else{for(var t="",a=0;a<e.length;a++)t+='<div class="new-ch content col-12 m-2 " data-id="'+e[a].id+`">
                            <div class="row">
                                <div class="col-12 mx-3">
                                    <div class="float-start mx-3 ">`+(e[a].profilePic?'<img src="/ProfilePics/thumbnails/'+e[a].profilePic+'" class="img-pro" />':'<img src="/user-profile.png" class="img-pro" />')+`</div>
                                    <div class="float-start text-start d-contents px-2">
                                        <div class="pro">
                                            <label class="name">`+e[a].contactName+`</label>
                                            <label class="role">`+(30<e[a].body.length?e[a].body.substring(0,30):e[a].body)+`</label>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>`;$("#search-contents").append(t),$(".content").on("click",function(){var e=$(this).data("id");$(".loading").show(),window.location.href="/?showInChat="+e})}})):($(".new-search-mess").hide(),$(".def-mess").show())}function getDuraton(e){var e=Math.round(e),t="";return 60<e&&(t=Math.floor(e/60)<10?"0"+Math.floor(e/60):Math.floor(e/60)),t+=(t?":":"00:")+(Math.floor(e%60)<10?"0"+Math.floor(e%60):Math.floor(e%60))}function openAllContact(c){$.post("/Home/AllContact",{},function(e){for(var t="",a="",i=0;i<e.length;i++){var s=e[i],o='<div class="search-contact-btn-group"><div>Collapse All</div><div>Expend All</div></div>',l="",n=(a!=s.departmentTitle&&(l="<div class='contact-tree'>"+s.departmentTitle+"</div>",a=s.departmentTitle),ul&&ul.find(e=>e.userId.toLowerCase()==s.id.toLowerCase()));t+=l+'<div class="new-ch contact col-12'+(n?" online":"")+(s.isGroup?" grp":"")+'" data-id="'+s.id+'" department="'+s.departmentTitle+`">
                            <div class="row">
                                <div class="col-12 mx-3 b-online">
                                    <div class="float-start mx-3 ">
                                        <img src="`+(s.id==myUserId?"/img/cloud-folder-b.svg":s.profilePic)+'" class="'+(s.id==myUserId?"mydrive":"img-pro")+`" />
                                    </div>
                                    <div class="float-start text-start d-contents px-2">
                                        <div class="pro">`+(s.isGroup?`
                                            <label class="group-name">`+(s.id==myUserId?"My Drive":(s.name||s.username)+"")+`</label>
                                            <label class="chat-bio">`+(s.id==myUserId?"Saved Message":s.companyName)+"</label>":`
                                            <label class="name">`+(s.id==myUserId?"My Drive":s.name||s.username)+`</label>
                                            <label class="company">`+(s.id==myUserId?"Saved Message":s.companyName)+`</label>
                                            <label class="role`+(s.id!=myUserId&&s.position&&20<s.position.length?" ft-9":"")+'">'+s.position+"</label>")+`
                                        </div>
                                    </div>
                                    <div class="on-bor" ></div>
                                </div>
                            </div>
                        </div>`}$(".selectContact").html(o+t),$(".selectContact .new-ch").hide(),$(".selectContact .contact-tree").on("click",function(){var e=$(this);e.text();e.toggleClass("active"),searchContact($("#search-contact").val())}),$("#selectContactModal").modal("show"),$(".new-ch").on("click",function(){var e=$(this);c(e)}),$(".search-contact-btn-group div").eq(0).on("click",function(){$(".contact-tree").removeClass("active"),searchContact($("#search-contact").val())}),$(".search-contact-btn-group div").eq(1).on("click",function(){$(".contact-tree").addClass("active"),searchContact($("#search-contact").val())}),$(".search-contact-btn-group div").eq(1).trigger("click")})}$(".def-mess").on("touchmove mousemove",function(e){("mousedown"==e.handleObj.origType&&e.clientY&&0<touchxy.length&&(20<Math.abs(e.clientY-touchxy[1])||20<Math.abs(e.clientX-touchxy[0]))||e.touches[0].clientX&&0<touchxy.length&&(20<Math.abs(e.touches[0].clientY-touchxy[1])||20<Math.abs(e.touches[0].clientX-touchxy[0])))&&clearTimeout(selectDefMessTimeoutId)}),$(".def-mess").on("mousedown touchstart",function(e){var t=$(this);clientXY="mousedown"==e.handleObj.origType?[e.clientX,e.clientY]:[e.touches[0].clientX,e.touches[0].clientY],selectDefMessTimeoutId=setTimeout(function(){selectDefMessForDel=!0,showHideDelBtn(t)},1e3)}).on("mouseup mouseleave touchend",function(e){clearTimeout(selectDefMessTimeoutId),setTimeout(function(){selectDefMessForDel=!1},100)}),$("#delchat-trash").on("click",function(){var t=$(".def-mess.selectfordel").attr("data-id"),a=(faTrashClicked=!0,$(".def-mess.selectfordel"));alertify.confirm("Are you share to delete this chat?",function(e){e&&$.post("/Home/DeleteUserChat",{contactId:t},function(e){e.ok&&a.remove()}),sendNotConnectMess=!1}).set({title:"ZN Vostok"}).set("closable",!1).set("labels",{ok:"Delete",cancel:"Cancel"})}),$(".def-mess").on("click",function(){var t,a;selectDefMessForDel||(faTrashClicked?faTrashClicked=!1:(t=$(this).hasClass("grp"),fromNewChat=!1,$(".loading").show(),$(".contact").removeClass("active"),$(this).addClass("active"),a=$(this).data("id"),$(this).data("id"),0<$("#ChatPmModal .chat-pm").length&&$("#ChatPmModal .chat-pm").remove(),$.post("/Home/GetContactMessageWithLastSeen",{minId:"0",contactId:a,isGroup:t},function(e){lastUserIngroup="",$(".loading").hide(),null==e||0==e.length?SetEmptyMessage():(SetResultOfMessage(e.res,null,null,e.userLastSeen),$(".contact.active .text-bg-success").html("")),t?mySignalRListener.SeenMessegeForGroup("all","all",a):mySignalRListener.SeenMessege("all",a)}),allSurveyResults=[],getSurvey(myUserId,a),$.post("/Home/GetEmoji",{originalUserId:myUserId,selectedUserId:a},function(e){applyEmoji(e)})))}),$("#logout").on("click",function(){$("#logoutForm").submit()}),$("#search-btn").on("click",function(){$("#searchContactModal").modal("show")}),$("#searchContact").on("keydown",function(e){13==e.keyCode&&searchonmobile()}),$(".search-contact").on("click",function(){searchonmobile()}),$(".search-contact-reset").on("click",function(){$("#searchContact").val("")}),$(".logout").on("click",function(){$("#logoutForm").submit()}),$(".setting").on("click",function(){"idle"===$("body").attr("data-mode")&&($(".loading").show(),window.location.href="/Identity/Account/Manage/Index")}),$(".chatpage").on("click",function(){"idle"===$("body").attr("data-mode")&&($(".loading").show(),window.location.href="/")}),$(".chat-mess-new").on("click",function(){openAllContact(function(e){fromNewChat=!0,$("#selectContactModal").modal("hide"),$(".contact").removeClass("active"),e.addClass("active");var t=e.data("id");e.data("id");$.post("/Home/GetContactMessage",{minId:"0",contactId:t},function(e){lastUserIngroup="",$(".loading").hide(),null==e||0==e.length?SetEmptyMessage():(SetResultOfMessage(e),$(".contact.active .text-bg-success").html("")),mySignalRListener.SeenMessege("all",t)}),getSurvey(myUserId,t)})}),$(".sos").on("click",function(){fromNewChat=!0,$(".contact").removeClass("active"),$(this).addClass("active");var t=$(this).data("id");$(this).data("id");$.post("/Home/GetContactMessage",{minId:"0",contactId:t},function(e){lastUserIngroup="",$(".loading").hide(),null==e||0==e.length?SetEmptyMessage():(SetResultOfMessage(e),$(".contact.active .text-bg-success").html("")),mySignalRListener.SeenMessege("all",t)}),getSurvey(myUserId,t)}),$.fn.bsShow=function(){$(this).removeClass("d-none")},$.fn.bsHide=function(){$(this).addClass("d-none")},$("#forwardModal .close").on("click",function(){$("#forwardModal").modal("hide")}),$("#deleteModal .close , #btn-cancel-delete").on("click",function(){$("#deleteModal").modal("hide")}),$("#selectContactModal .close").on("click",function(){$("#selectContactModal").modal("hide")}),$("#search-contact").on("keypress",function(e){e=$(this).val()+e.key;searchContact(e)}),$("#search-contact").on("keyup",function(e){var t;13==e.keyCode&&(t=$("#search-contact").val(),searchContact(t)),8!=e.keyCode&&46!=e.keyCode||setTimeout(function(){var e=$("#search-contact").val();searchContact(e)},100)}),$("#refresh-page-btn").on("click",function(){window.location.reload()}),$("#CallingModal video").on("click",function(){fullScreenVideo($(this))}),$(".contact .fa-trash").on("click",function(){faTrashClicked=!0;var t=$(this).parent().parent().parent(),a=t.data("id");alertify.confirm("Are you share to delete this chat?",function(e){e&&$.post("/Home/DeleteUserChat",{contactId:a},function(){t.remove()}),sendNotConnectMess=!1}).set({title:"ZN Vostok"}).set("closable",!1).set("labels",{ok:"Delete",cancel:"Cancel"})}),$(".del-chat").on("click",function(){$(".contacts .fa-trash").each(function(e,t){$(t).parent().hasClass("d-none")?$(t).parent().removeClass("d-none"):$(t).parent().addClass("d-none")})}),$(".fa-search").on("click",function(){$("#SearchModal input").val(""),$("#SearchModal").modal("show")}),$("#search-data").on("keydown",function(e){13==e.keyCode&&searchContent()}),$("#SearchModal .fa-arrow-left").on("click",function(){$("#SearchModal").modal("hide")}),$("#CreateGroupModal .fa-arrow-left").on("click",function(){$("#CreateGroupModal").modal("hide")}),$("#calllog-tab").on("click",function(){$(".calls").html(""),$.post("/home/getcall",null,function(e){for(var t="",a=0;a<e.length;a++)t+=`<div class="new-ch content col-12 m-2">
                            <div class="row">
                                <div class="col-12 mx-3">
                                    <div class="float-start mx-3 ">`+(e[a].incall?'<i class="fas fa-arrow-down-long"></i>':e[a].outcall?'<i class="fas fa-arrow-up-long"></i>':'<i class="fas fa-arrow-down-long missed" style="color:red"></i>')+(e[a].profilePic?'<img src="/ProfilePics/thumbnails/'+e[a].profilePic+'" class="img-pro" />':'<img src="/user-profile.png" class="img-pro" />')+`</div>
                                    <div class="float-start text-start px-2">
                                        <div class="pro">
                                            <label class="name">`+e[a].contactName+`</label>
                                            <label class="role">`+(e[a].isVideo?"video call":"voice call")+"  Duration:"+getDuraton(e[a].duration)+`</label>
                                            <label class="role">`+getNiceDateTimeFormat(e[a].createdDate)+`</label>
                                        </div>
                                    </div>
                                    <i class='float-end pt-3 pr-2 fa`+(e[a].isVideo?" fa-call-video":" fa-call-phone")+`' data-id="`+(e[a].userId==myUserId?e[a].toUserId:e[a].userId)+`"></i>
                                </div>
                            </div>
                        </div>`;$(".calls").html(t),$(".fa-call-video").on("click",function(){var e=$(this).attr("data-id");$(this).prev(".float-start").addClass("def-mess").addClass("active").attr("data-id",e),VideoCallProcess()}),$(".fa-call-phone").on("click",function(){var e=$(this).attr("data-id");$(this).prev(".float-start").addClass("def-mess").addClass("active").attr("data-id",e),VoiceCallProcess()})})}),$(".newgroupCreate").on("click",function(){$.post("/Home/AllContact",{},function(e){for(var t,a="",i=0;i<e.length;i++){var s=e[i];a+='<option value="'+s.id+'">'+(s.name||s.username)+"</option>"}t=`<div class="content row">
                        <div class="col-lg-3 col-md-4 col-sm-6 px-3">
                            <label for="Title">Title</label>
                            <input id="Title" name="Title" class="form-control" />
                            <span asp-validation-for="Title" class="text-danger"></span>
                        </div>
                        <div class="col-lg-3 col-md-4 col-sm-6 px-3">
                            <label asp-for="GroupBIO">GroupBIO</label>
                            <input id="GroupBIO" name="GroupBIO" class="form-control" />
                            <span asp-validation-for="GroupBIO" class="text-danger"></span>
                        </div>
                        <div class="col-12 px-3">
                            <label asp-for="GroupUserIds">Users</label>
                            <select id="GroupUserIds" name="GroupUserIds" class="form-control select-search" multiple="">
                            `+a+`
                            </select>
                            <span asp-validation-for="GroupUserIds" class="text-danger"></span>
                        </div>
                        <div class="col-12 px-3">
                            <label >&nbsp;</label>
                            <button class="btn btn-primary" id="save-group">Save Group</button>
                        </div>
                    </div>
            <link href="/css/select2.min.css" rel="stylesheet" />
            <script src="/js/select2.min.js"></script>
            <script src="/JavaScript/SimpleJs?indexOfJs=select2">
            </script>`,$("#group-contents").html(t),$("#CreateGroupModal").modal("show"),$("#save-group").on("click",function(){var e=!1;$("#Title").val()||($('[asp-validation-for="Title"]').html("Title is required."),e=!0),$("#GroupBIO").val()||($('[asp-validation-for="GroupBIO"]').html("GroupBIO is required."),e=!0),$("#GroupUserIds").val()||($('[asp-validation-for="GroupUserIds"]').html("GroupUserIds is required."),e=!0),e||$.post("/Home/CreateGroup",{Title:$("#Title").val(),GroupBIO:$("#GroupBIO").val(),GroupUserIds:$("#GroupUserIds").val()},function(e){$(".loading").show(),window.location.reload()})})})});