function showStatus(){$("#status-options").css("opacity","1");$("#status-options").css("visibility","visible")}function searchData(){var n=$("#search input").val();n?($(".new-search-mess").hide(),$(".new-search-mess").removeClass("new-search-mess").addClass("search-mess"),$(".new-search-mess").html(""),$.post("/Home/GetAccounts",{searchKey:n},function(n){var t,r,i;if($(".def-mess").hide(),n.length==0){i=`<li class="contact new-search-mess">
                        <div class="wrap">
                            <div class="meta">
                                <p class="name">Not Found</p>
                                <p class="preview">nothing!</p>
                            </div>
                        </div>
                    </li>`;$("#contacts ul").append(i);return}for(t=0;t<n.length;t++){r="online";r=n[t].status==1?"away":n[t].status==2?"busy":n[t].status==3?"offline":r;i=`<li class="contact new-search-mess"  data-id="`+n[t].userId+`">
                        <div class="wrap">
                            <span class="contact-status `+r+`"></span>`+(n[t].profilePic?'<img src="/ProfilePics/'+n[t].profilePic+'" alt="" />':'<img src="/user-profile.png" alt="" />')+`<div class="meta">
                                <p class="name">`+n[t].userName+`<span></span></p>
                                <p class="preview"></p>
                            </div>
                        </div>
                    </li>`;$("#contacts ul").append(i);$(".new-search-mess").on("click",function(){fromNewChat=!1;$(".new-search-mess").removeClass("active");$(this).addClass("active");var n=$(this).data("id"),t=$(this).data("id");$.post("/Home/GetContactMessage",{minId:"0",contactId:n},function(n){$(".loading").hide();n==null||n.length==0?SetEmptyMessage():SetResultOfMessage(n)})})}})):($(".new-search-mess").hide(),$(".def-mess").show())}function SetEmptyMessage(){var i=`<div class="chat-pm-empty ">
						<label class="text-larg">
							No message here yet!
						</label>
						<label>
							Send a message or send file or voice.
						</label>
					</div>
            <ul><li id='lastchat'></li></ul>`,n=$(".contact.active .name").html(),t=n.length>30?n.substring(0,29)+"...":n,e=$(".contact.active .company").text(),r=$(".contact.active .role").text(),u=$(".contact.active img").attr("src"),o=`<button id="nameofcontact" type="button"  data-toggle="tooltip" data-placement="bottom" title="`+n+`">
                          `+t+`
                        </button>`,f=`
		<div class="row">
			<div class="chat px-3">
			
			  <div class="mb-auto row">
				<div class="text-start display-block">
				  <div class="text-start float-start btn w-100">

					<div class="d-inline">
						<div class="float-start">
							<a class="active text-light close mx-2" aria-current="page" href="#" ><i class="fas fa-arrow-left"></i></a>
							<img src="`+u+`" class="img-pro-pm-chat" />
						</div>
						<div class="float-start mx-2">
							<div class="pro-small">
								<label class="name">`+t+`</label>
								<label class="role">`+r+`</label>
							</div>
						</div>

						<div class="float-end text-end">
						  <div class="text-start float-end btn px-0">
							<a class="active text-light pr-2" aria-current="page" href="#"><i class="fas fa-phone"></i></a>
							<a class="active text-light" aria-current="page" href="#"><i class="fas fa-video"></i></a>
						  </div>
						</div>
					</div>
				  </div>
				</div>
			  </div>
			  <div class="row tab-div">
				<div class="chat-pm">
        `+i+`
        
					<div class="chat-pm-input ">
						
						<textarea rows="1" class="w-100 form-control" ></textarea>
						<div class="send-btn">
                            <div class="input-group-append" id="microphone_btn">
                                <span class="input-group-text microphone_btn"><i class="fa fa-microphone"></i></span>
                            </div>
                            <div class="input-group-append" id="stopButton">
                                <span class="input-group-text stopButton"><i class="fa fa-stop-circle"></i></span>
                            </div>
							<img class="attach" src="/img/attach_file.png" />
							<img class="send" src="/img/send-icon.png" />
						</div>
					</div>
                </div>
            </div>`;$("#ChatPmModal .modal-body").html(f);$("#ChatPmModal").modal("show");$("#ChatPmModal .close").on("click",function(){fromNewChat?window.location.href="/":$("#ChatPmModal").modal("hide")});$(".fa-video").on("click",function(){VideoCallProcess()});$(".fa-phone").on("click",function(){VoiceCallProcess()});$(".lmore").on("click",function(){lmore=!0;var n=$(".contact.active").data("id");$.post("/Home/GetContactMessage",{minId:minId,contactId:n},function(n){$(".loading").hide();n==null||n.length==0?SetEmptyMessage():(SetResultOfMessage(n),$(".contact.active .text-bg-success").html("(0)"))})});setTimeout(function(){$(".chat-pm ul").scrollTop($(".chat-pm ul")[0].scrollHeight)},500);setSomeFeatureForSendingMess();loadRecData()}function beepRing(){beepring.play();beepRingTimer=setTimeout(function(){beepRing()},5e3)}function VideoCallProcess(){try{if(console.log("IsCameraPermission:"+IsCameraPermission),IsCameraPermission==!1){IsCameraPermission=JSBridge.getVideoPermission();console.log("IsCameraPermission:"+IsCameraPermission);return}}catch{}if(wsconn.connectionState!="Connected"){SendNotConnectAlert("you are not connect to signalr. For video call you must refresh page. For refresh page touch on ok button.");return}beepring.volume=.3;beepRing();$("#call-status-lbl").html("video calling to user...");isVideoCall=!0;console.log("calling user... ");$("#VideoCallModalLabel").html("Video Call");dt1=new Date;videoaudiotimer=setTimeout(timerDisplayFun,1e3);$(".partner")[0].style.display="none";localVideo.style.display="";remoteVideo.style.display="";var n=$(".def-mess.active").attr("data-id");if($("body").attr("data-mode")!=="idle"){alertify.error("Sorry, you are already in a call.  Conferencing is not yet implemented.");return}n!=myUserId?(initializeUserMediaVideo(),wsconn.invoke("callUser",n,!0),dt1=new Date,setTimeout(timerDisplayFun,1e3),$("body").attr("data-mode","calling"),$("#VideoCallModal").modal("show"),$("#callstatus").text("Calling...")):alertify.error("Ah, nope.  Can't call yourself.")}function VoiceCallProcess(){try{if(console.log("IsMicrophonePermission:"+IsMicrophonePermission),IsMicrophonePermission==!1){IsMicrophonePermission=JSBridge.getAudioPermission();console.log("IsMicrophonePermission:"+IsCameraPermission);return}}catch{}if(wsconn.connectionState!="Connected"){SendNotConnectAlert("you are not connect to signalr. For voice call you must refresh page. For refresh page touch on ok button.");return}beepring.volume=.3;$("#call-status-lbl").html("voice calling to user...");beepRing();isVideoCall=!1;dt1=new Date;videoaudiotimer=setTimeout(timerDisplayFun,1e3);localVideo.style.display="none";remoteVideo.style.display="none";$("#VideoCallModalLabel").html("Voice Call");console.log("calling user... ");var n=$(".def-mess.active").attr("data-id");if($("body").attr("data-mode")!=="idle"){alertify.error("Sorry, you are already in a call.  Conferencing is not yet implemented.");return}n!=myUserId?(initializeUserMediaVoice(),wsconn.invoke("callUser",n,!1),$("body").attr("data-mode","calling"),$("#ChatPmModal").modal("hide"),$("#VideoCallModal").modal("show"),$("#callstatus").text("Calling...")):alertify.error("Ah, nope.  Can't call yourself.")}function timerDisplayFun(){var r=new Date,n=r-dt1,t=Math.floor(n/1e3%60),i=Math.floor(n/6e4);document.querySelector(".recording-timer-display label").innerHTML=(i<10?"0":"")+i.toString()+":"+(t<10?"0":"")+t.toString();videoaudiotimer=setTimeout(timerDisplayFun,1e3)}function videoAndVoiceCallClick(){$(".social-media .fa-video-camera").on("click",function(){isVideoCall=!0;console.log("calling user... ");$("#VideoCallModalLabel").html("Video Call");$(".partner")[0].style.display="none";localVideo.style.display="";remoteVideo.style.display="";try{Android.loadCamera()}catch(t){alertify.error(t)}var n=$(".def-mess.active").attr("data-id");if($("body").attr("data-mode")!=="idle"){alertify.error("Sorry, you are already in a call.  Conferencing is not yet implemented.");return}n!=myUserId?(initializeUserMediaVideo(),wsconn.invoke("callUser",n,!0),$("body").attr("data-mode","calling"),$("#VideoCallModal").modal("show"),$("#callstatus").text("Calling...")):alertify.error("Ah, nope.  Can't call yourself.")});$(".social-media .fa-phone").on("click",function(){isVideoCall=!1;localVideo.style.display="none";remoteVideo.style.display="none";try{Android.loadMicrophone()}catch(t){alertify.error(t)}dt1=new Date;videoaudiotimer=setTimeout(timerDisplayFun,1e3);$("#VideoCallModalLabel").html("Voice Call");console.log("calling user... ");var n=$(".def-mess.active").attr("data-id");if($("body").attr("data-mode")!=="idle"){alertify.error("Sorry, you are already in a call.  Conferencing is not yet implemented.");return}n!=myUserId?(initializeUserMediaVoice(),wsconn.invoke("callUser",n,!1),$("body").attr("data-mode","calling"),$("#VideoCallModal").modal("show"),$("#callstatus").text("Calling...")):alertify.error("Ah, nope.  Can't call yourself.")})}function SetResultOfMessage(n){var r="",t,u,e,f,i;for(lmore==!1&&(r+="<ul>"),n.length>0&&(minId=n[n.length-1].id),minId>parseInt($(".contact.active").attr("minid"))&&(r+="<li class='lmore'><button class='btn btn-info'>load more<\/button><\/li>"),t=n.length-1;t>=0;t--)if(n[t].isFile==!1)r+=`<li class="`+(n[t].isReciver?"from-me":"from-other")+`" data-id="`+n[t].id+`" >`+(n[t].body.indexOf(",;,")>=0?`<div class="card" data-id="`+(n[t].replyId?n[t].replyId:"")+`" >
                      <div class="card-header">`+n[t].body.split(",;,")[0]+`
                      </div><label`+checkRtlOfText(n[t].body.split(",;,")[1])+`>`+textToWrite(n[t].body.split(",;,")[1])+`</label></div>`:`<label`+checkRtlOfText(n[t].body)+`>`+textToWrite(n[t].body)+`</label>`)+`</li>
                <li class="`+(n[t].isReciver?"from-me":"from-other")+`" >
                    <div class="date">`+getNiceDateTimeFormat(n[t].createdDate)+`</div>
                </li>`;else for(u=[],u.push(n[t].body),e="",n[t].body.indexOf("^")>=0&&(u=n[t].body.split("^"),e=""),f=0;f<u.length;f++)i=u[f],u[f].indexOf(",;,")>0&&(i=u[f].split(",;,")[1],e=u[f].split(",;,")[0],u[f]=u[f].replace(",;,"," ")),r+=`<li class="`+(n[t].isReciver?"from-me":"from-other")+`" data-id="`+n[t].id+`" >`,e&&(r+=`<div class="card" data-id="`+(replyid?replyid:"")+`" >
                      <div class="card-header">`+e+`</div>`),r+=IsImage(i)?`<label><a href="#" data-url="/uploads/`+i+`" class="img-tag"><div><img  class="fupload" src="/uploads/thumbnails/`+i+`" /></div><div>`+i+`</div></a></label>`:IsAudio(i)?`<label><div><audio controls src="/uploads/`+i+`" ></audio></div><div> `+i+`</div></label>`:IsVideo(i)?`<label><div><video controls  ><source src="/uploads/`+i+`" ></video></div><div> `+i+`</div></label>`:`<label><a href="/uploads/`+i+`" target="_blank" ><div><img src="/img/file-icon.png" class="img-ico" /></div><div>`+i+`</div></a></label>`,e&&(r+=`</div>`),r+=`</li>`,r+=`<li class="`+(n[t].isReciver?"from-me":"from-other")+`" >`+"<div class='date'>"+getNiceDateTimeFormat(n[t].createdDate)+"<\/div>"+`</li>`;if(lmore){$(".lmore").before(r);$(".lmore").length>1?$($(".lmore")[1]).remove():$(".lmore").remove();lmore=!1;$(".lmore").on("click",function(){lmore=!0;var n=$(".contact.active").data("id");$.post("/Home/GetContactMessage",{minId:minId,contactId:n},function(n){$(".loading").hide();n==null||n.length==0?SetEmptyMessage():(SetResultOfMessage(n),$(".contact.active .text-bg-success").html("0"))})});return}r+="<li id='lastchat'><\/li><\/ul>";var o=$(".contact.active .name").html(),s=o.length>30?o.substring(0,29)+"...":o,h=$(".contact.active .role").text(),c=$(".contact.active img").attr("src"),l=`
		<div class="row">
			<div class="chat px-3">
			
			  <div class="mb-auto row">
				<div class="text-start display-block">
				  <div class="text-start float-start btn w-100">

					<div class="d-inline">
						<div class="float-start">
							<a class="active text-light close mx-2" aria-current="page" href="#" ><i class="fas fa-arrow-left"></i></a>
							<img src="`+c+`" class="img-pro-pm-chat" />
						</div>
						<div class="float-start mx-2">
							<div class="pro-small" >
								<label class="name">`+s+`</label>
								<label class="role">`+h+`</label>
							</div>
						</div>

						<div class="float-end text-end">
						  <div class="text-start float-end btn px-0">
							<a class="active text-light pr-2 d-none" aria-current="page" href="#" title="Deselect"><i class="fa fa-remove"></i></a>
							<a class="active text-light pr-2 d-none" aria-current="page" href="#" title="Copy"><i class="fa-solid fa-copy"></i></a>
							<a class="active text-light pr-2 d-none" aria-current="page" href="#" title="Forward"><i class="fa-solid fa-share"></i></a>
							<a class="active text-light pr-2 d-none" aria-current="page" href="#" title="Reply"><i class="fa-solid fa-reply"></i></a>
							<a class="active text-light d-none" aria-current="page" href="#" title="Remove"><i class="fa-solid fa-trash"></i></a>
							<a class="active text-light pr-2" aria-current="page" href="#"><i class="fas fa-phone"></i></a>
							<a class="active text-light" aria-current="page" href="#"><i class="fas fa-video"></i></a>
						  </div>
						</div>
					</div>
				  </div>
				</div>
			  </div>
			  <div class="row tab-div">
				<div class="chat-pm">
        `+r+`
        
					<div class="chat-pm-input ">
						
						<textarea rows="1" class="w-100 form-control" ></textarea>
						<div class="send-btn">
                            <div class="input-group-append" id="microphone_btn">
                                <span class="input-group-text microphone_btn"><i class="fa fa-microphone"></i></span>
                            </div>
                            <div class="input-group-append" id="stopButton">
                                <span class="input-group-text stopButton"><i class="fa fa-stop-circle"></i></span>
                            </div>
							<img class="attach" src="/img/attach_file.png" />
							<img class="send" src="/img/send-icon.png" />
						</div>
					</div>
                </div>
            </div>`;$("#ChatPmModal .modal-body").html(l);$(".img-tag").on("click",function(){var n=$(this).data("url");loadImageModal(n)});$("#close-img-modal").on("click",function(){$("#imgViewerModal").modal("hide")});$("#ChatPmModal").modal("show");$(".pro-small").on("click",function(){$(".loading").show();window.location.href="/Home/Profile?uid="+$(".contact.active").data("id")});$("#ChatPmModal .close").on("click",function(){fromNewChat?window.location.href="/":$("#ChatPmModal").modal("hide")});$(".fa-video").on("click",function(){VideoCallProcess()});$(".fa-phone").on("click",function(){VoiceCallProcess()});$(".lmore").on("click",function(){lmore=!0;var n=$(".contact.active").data("id");$.post("/Home/GetContactMessage",{minId:minId,contactId:n},function(n){$(".loading").hide();n==null||n.length==0?SetEmptyMessage():(SetResultOfMessage(n),$(".contact.active .text-bg-success").html("0"))})});setTimeout(function(){$(".chat-pm ul").scrollTop($(".chat-pm ul")[0].scrollHeight)},500);setSomeFeatureForSendingMess();loadRecData()}function loadImageModal(n){var t=n;$("#img").attr("src",t);$("#download-img").attr("href",t);start();$("#img").removeClass("d-none");$("#imgViewerModal").modal("show");$("#img").on("load",function(){var n=this.width,t=this.height,i=1*n/t;$("#img").addClass("d-none");$("#canvas").attr("height",Math.floor($(window).width()/i));$("#canvas").attr("width",Math.floor($(window).width()));initDraw();$(".loading").hide()});$(".loading").show()}function contact_must_be_selected(n){n&&n.hasClass("selected")?n.removeClass("selected"):n&&n.addClass("selected");$(".chat-pm li.selected").length==0?($(".fa-video").parent().bsShow(),$(".fa-phone").parent().bsShow(),$(".pro-small").parent().bsShow(),$(".fa-share").parent().bsHide(),$(".fa-reply").parent().bsHide(),$(".fa-copy").parent().bsHide(),$(".fa-trash").parent().bsHide(),$(".fa-remove").parent().bsHide()):$(".chat-pm li.selected").length==1?($(".fa-video").parent().bsHide(),$(".fa-phone").parent().bsHide(),$(".pro-small").parent().bsHide(),$(".fa-share").parent().bsShow(),$(".fa-reply").parent().bsShow(),$(".fa-copy").parent().bsShow(),$(".fa-trash").parent().bsShow(),$(".fa-remove").parent().bsShow()):($(".fa-phone").parent().bsHide(),$(".fa-video").parent().bsHide(),$(".fa-phone").parent().bsHide(),$(".fa-share").parent().bsHide(),$(".fa-reply").parent().bsHide(),$(".fa-copy").parent().bsHide(),$(".fa-trash").parent().bsHide(),$(".fa-remove").parent().bsHide())}function setSomeFeatureForSendingMess(){sendMessagebtn();loadForSelectLi();allDropDownButtonProcess()}function loadForSelectLi(){var n=0;$(".chat-pm li").unbind("mousedown");$(".chat-pm li").unbind("mouseup");$(".chat-pm li").unbind("mouseleave");$(".chat-pm li").unbind("mouseleave");$(".chat-pm li").unbind("touchstart");$(".chat-pm li").unbind("touchend");$(".chat-pm li").on("mousedown touchstart",function(){var t=$(this);n=setTimeout(function(){contact_must_be_selected(t)},1e3)}).on("mouseup mouseleave touchend",function(){clearTimeout(n)})}function sendMessagebtn(){$(".send-btn .send").on("click",function(){SendMessageProcess(!1)});$(".send-btn .attach").on("click",SendFileProcess);$(".chat-pm-input textarea").on("keydown",function(n){if(n.keyCode==13&&!n.shiftKey)return SendMessageProcess(!1),!1})}function allDropDownButtonProcess(){deselectBtnProcess();copyBtnProcess();replyBtnProcess();forwardBtnProcess();deleteBtnProcess()}function deleteBtnProcess(){$(".fa-trash").on("click",function(){deleteid=$(".chat-pm li.selected").eq(0).data("id");$("#deleteModal").modal("show")});$(".del_").removeClass("del_").addClass("del")}function forwardBtnProcess(){$(".fa-share").on("click",function(){forwardid=$(".chat-pm li.selected").eq(0).data("id");var n="";n+=$(".contacts").clone().html();$("#forward-body").html(n);$("#forward-body .mess").on("click",function(){$("#forward-body .mess").removeClass("active");$(this).addClass("active")});$("#forwardModal").modal("show")});$(".for_").removeClass("for_").addClass("for")}function deselectBtnProcess(){$(".fa-remove").on("click",function(){$(".chat-pm li.selected").removeClass("selected");contact_must_be_selected()})}function copyBtnProcess(){$(".fa-copy").on("click",function(){var t=HTMLEncode($(".chat-pm li.selected").eq(0).text()),n;$("#mycopytextarea").html(t);n=document.getElementById("mycopytextarea");n.select();n.setSelectionRange(0,99999);$("#mycopytextarea").focus();navigator.clipboard.writeText(n.value);try{JSBridge.copyToClipboard(n.value)}catch{}$(".chat-pm li.selected").removeClass("selected");contact_must_be_selected()})}function HTMLEncode(n){const i={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&apos;"};var t=n;for(const n in i)t.indexOf(n)>=0&&(t=t.replaceAll(n,i[n]));return t}function replyBtnProcess(){$(".fa-reply").on("click",function(){var n,t;$(".chat-pm-input .card-header a").trigger("click");forwardid="";innerHtmlReply=$(".chat-pm-input").eq(0).html();beforeReplytext=$(".chat-pm-input textarea").eq(0).val();n=$(".chat-pm li.selected").eq(0);replyid=n.data("id");replyid||n.parent().data("id");t=HTMLEncode(n.get(0).innerText.length>20?n.get(0).innerText.substring(0,20):n.get(0).innerText);$(".chat-pm-input").html(`<div class="card" >
                  <div class="card-header reply" data-id="`+replyid+`">`+t+`<a class="float-end px-3">X</span></a></div>`+innerHtmlReply+`</div>`);$(".chat-pm-input textarea").val(beforeReplytext);$(".chat-pm-input textarea").focus();$(".chat-pm-input .card-header a").on("click",function(){beforeReplytext=$(".chat-pm-input textarea").val();$(".chat-pm-input").html(innerHtmlReply);replyid="";$(".chat-pm textarea").val(beforeReplytext)});sendMessagebtn();$(".chat-pm li.selected").removeClass("selected");contact_must_be_selected()});$(".rep_").removeClass("rep_").addClass("rep")}function SendFileProcess(){$("#fileinput").unbind("change");$("#fileinput").on("change",function(){var n=document.getElementById("fileinput"),t;n.files.length>0&&(t=$(".contact.active").data("id"),fileUploader(n,t))});$("#fileinput").click()}function SendMessageProcess(n){n=n?n:!1;var i="",t="";$(".chat-pm-empty").hide();n==!1?(i=$(".chat-pm-input textarea").val(),t=$(".contact.active").data("id")):t=$("#forward-body .mess.active").data("id");(i||n)&&($(".loading").show(),n==!1&&$(".chat-pm-input textarea").val(""),$.post("/Home/sendMess",{mess:i,contactId:t,replyId:n?"":replyid,forwardId:n?forwardid:""},function(i){var u,r;if($(".loading").hide(),n==!1||$("#forward-body .mess.active").data("id")==$(".contact.active").data("id")){for(u="",r=0;r<i.length;r++)u+=`<li class ="from-me" data-id="`+i[r].id+`" data-time="`+i[r].createdDate+`">`+(i[r].body.indexOf(",;,")>=0?`<div class="card" data-id="`+(i[r].replyId?i[r].replyId:"")+`" >
                              <div class="card-header">
                              `+i[r].body.split(",;,")[0]+`
                              </div><label`+checkRtlOfText(i[r].body.split(",;,")[1])+`>`+textToWrite(i[r].body.split(",;,")[1])+`</label></div>`:`<label `+checkRtlOfText(i[r].body)+`>`+textToWrite(i[r].body)+`</label>`)+`</li><li class ="from-me" >`+`<div class="date" data-id="`+(i[r].replyId?i[r].replyId:"")+`" >`+getNiceDateTimeFormat(i[r].createdDate)+`</div>`+`</li>`;$("#lastchat").before(u);$(".chat-pm ul").scrollTop($(".chat-pm ul")[0].scrollHeight);n==!1?($(".chat-pm-input textarea").val(""),replyid&&($(".chat-pm-input .card-header a").trigger("click"),replyid="")):$(".chat-pm li").removeClass("selected");loadForSelectLi();allDropDownButtonProcess()}n&&$(".chat-pm li").removeClass("selected");contact_must_be_selected();sendBySignalR(t,i[0].createdDate+";;;"+userid+";;;"+i[0].body+";;;"+i[0].id+";;;"+(n?"":replyid)+(n?forwardid:""));$(".chat-pm-input textarea").focus()}))}function searchonmobile(){$("#search input").val($("#searchContact").val());searchData();$("#searchContactModal").modal("hide")}function saveToDb(n,t,i){$.post("/Home/SaveAddress",{Latitude:n,Longitude:t,Address:i},function(n){console.log("logSaveAddress"+n)})}function IsImage(n){var t=n.toLowerCase().substring(n.lastIndexOf("."));return[".jpg",".jpeg",".bmp",".png",".gif",".tiff"].includes(t)?!0:!1}function IsAudio(n){var t=n.toLowerCase().substring(n.lastIndexOf("."));return[".wav",".mp3"].includes(t)?!0:!1}function IsVideo(n){var t=n.toLowerCase().substring(n.lastIndexOf("."));return[".mp4",".webm",".m4p",".mkv",".mpg",".3gp",".avi",".mov",".mp2",".ogg",".3gp",".qt",".3gp"].includes(t)?!0:!1}function searchContact(n){n?$(".selectContact .new-ch").each(function(t,i){var r=$(i).find(".pro").text().toLowerCase();r.indexOf(n.toLowerCase())>=0?$(i).show():$(i).hide()}):$(".selectContact .new-ch").show()}function hasPersian(n){if(n)return(m=n.match(/[آ-ی]|([a-zA-Z])/))!==null?m[1]?!1:!0:!0;return!1}function checkRtlOfText(n){return hasPersian(n)?" class='direction-rtl'":""}function textToWrite(n){return n.split("\n").join("<br />\n")}var minId="0",lmore=!1,visible,dt1,fromNewChat;try{JSBridge.setUserId(myUserId)}catch{}visible=!0;$(".expand-button , #profile-img").on("click",showStatus);$($("#profile p")[0]).on("click",showStatus);$(document).on("click",function(){visible=!visible;visible&&($("#status-options").css("opacity","0"),$("#status-options").css("visibility","hidden"))});$("#status-options li").on("click",function(){var n=$(this).attr("id").split("-")[1];$("#profile-img").removeAttr("class");$("#profile-img").addClass(n);$.post("/Home/SetStatus",{status:n},function(){})});$("#search input").on("keydown",function(n){n.keyCode==13&&searchData()});var innerHtmlReply="",replyid="",beforeReplytext="",forwardid="",deleteid="";$("#btn-submit-delete").on("click",function(){$.post("/Home/DelMess",{messid:deleteid},function(n){if(n.length>0&&n[0].id>0){var t=$(".contact.active").data("id");sendBySignalRForDel(t,deleteid+";;;"+userid);$(".chat-pm li[data-id="+deleteid+"]").next(".chat-pm li").remove();$(".chat-pm li[data-id="+deleteid+"]").remove()}else alert("an error has occured!");$("#deleteModal").modal("hide");contact_must_be_selected();deleteid=""})});$("#btn-cancel-forward").on("click",function(){forwardid="";$("#forwardModal").modal("hide")});$("#btn-submit-forward").on("click",function(){$("#forward-body .mess.active").length>0&&SendMessageProcess(!0);forwardid="";$("#forwardModal").modal("hide");$(".chat-pm li.selected").removeClass("selected");contact_must_be_selected()});$("#forwardModal").on("hidden.bs.modal",function(){forwardid=""});$(".def-mess").on("click",function(){fromNewChat=!1;$(".loading").show();$(".contact").removeClass("active");$(this).addClass("active");var n=$(this).data("id"),t=$(this).data("id");$.post("/Home/GetContactMessage",{minId:"0",contactId:n},function(n){$(".loading").hide();n==null||n.length==0?SetEmptyMessage():(SetResultOfMessage(n),$(".contact.active .text-bg-success").html("0"))})});$("#logout").on("click",function(){$("#logoutForm").submit()});$("#search-btn").on("click",function(){$("#searchContactModal").modal("show")});$("#searchContact").on("keydown",function(n){n.keyCode==13&&searchonmobile()});$(".search-contact").on("click",function(){searchonmobile()});$(".search-contact-reset").on("click",function(){$("#searchContact").val("")});$(".logout").on("click",function(){$("#logoutForm").submit()});$(".setting").on("click",function(){window.location.href="/Identity/Account/Manage/Index"});$(".chatpage").on("click",function(){window.location.href="/"});$(".chat-mess-new").on("click",function(){$.post("/Home/AllContact",{},function(n){for(var t,u,r="",i=0;i<n.length;i++)t=n[i],u=ul.find(n=>n.userId==t.id),r+=`<div class="new-ch contact col-12`+(u?" online":"")+`" data-id="`+t.id+`">
                            <div class="row px-3">
                                <div class="col-2">
                                    <img src="`+t.profilePic+`" class="img-pro" />
                                </div>
                                <div class="col-8 text-start px-2">
                                    <div class="pro">
                                        <label class="name">`+(t.name?t.name:t.username)+`</label>
                                        <label class="company">`+t.companyName+`</label>
                                        <label class="role">`+t.position+`</label>
                                    </div>
                                </div>
                            </div>
                        </div>`;$(".selectContact").html(r);$("#selectContactModal").modal("show");$(".new-ch").on("click",function(){fromNewChat=!0;$("#selectContactModal").modal("hide");$(".contact").removeClass("active");$(this).addClass("active");var n=$(this).data("id"),t=$(this).data("id");$.post("/Home/GetContactMessage",{minId:"0",contactId:n},function(n){$(".loading").hide();n==null||n.length==0?SetEmptyMessage():(SetResultOfMessage(n),$(".contact.active .text-bg-success").html("0"))})})})});$(".sos").on("click",function(){fromNewChat=!0;$(".contact").removeClass("active");$(this).addClass("active");var n=$(this).data("id"),t=$(this).data("id");$.post("/Home/GetContactMessage",{minId:"0",contactId:n},function(n){$(".loading").hide();n==null||n.length==0?SetEmptyMessage():(SetResultOfMessage(n),$(".contact.active .text-bg-success").html("0"))})});$.fn.bsShow=function(){$(this).removeClass("d-none")};$.fn.bsHide=function(){$(this).addClass("d-none")};$("#forwardModal .close").on("click",function(){$("#forwardModal").modal("hide")});$("#deleteModal .close , #btn-cancel-delete").on("click",function(){$("#deleteModal").modal("hide")});$("#selectContactModal .close").on("click",function(){$("#selectContactModal").modal("hide")});$("#search-contact").on("keypress",function(n){var t=$(this).val()+n.key;searchContact(t)});$("#search-contact").on("keyup",function(n){if(n.keyCode==13){var t=$("#search-contact").val();searchContact(t)}(n.keyCode==8||n.keyCode==46)&&setTimeout(function(){var n=$("#search-contact").val();searchContact(n)},100)});$("#refresh-page-btn").on("click",function(){window.location.reload()});$("#localVideo").on("click",function(){$("#videoRemoteStyle").html().length==0?$("#videoRemoteStyle").html(`
            video#remoteVideo {
	            position: fixed;
	            top: 60vh;
	            left: 75vw;
	            width: 23vw;
	            height: 38vh;
            }
            video#localVideo {
	            position: fixed;
	            top: 0;
	            left: 0;
	            width: 100vw;
	            height: 100vh;
            }`):$("#videoRemoteStyle").html("")});