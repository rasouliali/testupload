function showStatus(){$("#status-options").css("opacity","1");$("#status-options").css("visibility","visible")}function searchContact(){var n=$("#search input").val();n?($(".new-search-mess").hide(),$(".new-search-mess").removeClass("new-search-mess").addClass("search-mess"),$(".new-search-mess").html(""),$.post("/Home/GetAccounts",{searchKey:n},function(n){var t,r,i;if($(".def-mess").hide(),n.length==0){i=`<li class="contact new-search-mess">
                        <div class="wrap">
                            <div class="meta">
                                <p class="name">Not Found</p>
                                <p class="preview">nothing!</p>
                            </div>
                        </div>
                    </li>`;$("#contacts ul").append(i);return}for(t=0;t<n.length;t++){r="online";r=n[t].status==1?"away":n[t].status==2?"busy":n[t].status==3?"offline":r;i=`<li class="contact new-search-mess"  data-id="`+n[t].userId.toLowerCase()+`">
                        <div class="wrap">
                            <span class="contact-status `+r+`"></span>`+(n[t].profilePic?'<img src="/ProfilePics/thumbnails/'+n[t].profilePic+'" alt="" />':'<img src="/user-profile.png" alt="" />')+`<div class="meta">
                                <p class="name">`+n[t].userName+(data.id==myUserId?"<span class='badge text-info'>(You)<\/span>":"")+`<span></span></p>
                                <p class="preview"></p>
                            </div>
                        </div>
                    </li>`;$("#contacts ul").append(i);$(".new-search-mess").on("click",function(){fromNewChat=!1;$(".contact").removeClass("active");$(".new-search-mess").removeClass("active");$(this).addClass("active");var n=$(this).data("id"),t=$(this).data("id");$.post("/Home/GetContactMessage",{minId:"0",contactId:n},function(t){$(".loading").hide();t==null||t.length==0?SetEmptyMessage():SetResultOfMessage(t);wsconn.invoke("SeenMessege","all",n)})})}})):($(".new-search-mess").hide(),$(".def-mess").show())}function SetEmptyMessage(n){var r=`<div class="chat-pm-empty ">
						<label class="text-larg">
							No message here yet!
						</label>
						<label>
							Send a message or send file or voice.
						</label>
					</div>
            <ul><li id='lastchat'></li></ul>`,t="",i="",u;$(".contact.active").hasClass("grp")?(n=n?n:$(".contact.active .group-name").html(),t=n.length>30?n.substring(0,29)+"...":n,i=$(".contact.active .chat-bio").text()):(n=n?n:$(".contact.active .name").html(),t=n.length>30?n.substring(0,29)+"...":n,u=$(".contact.active .company").text(),i=$(".contact.active .role").text());var f=$(".contact.active img").attr("src"),o=`<button id="nameofcontact" type="button"  data-toggle="tooltip" data-placement="bottom" title="`+n+`">
                          `+t+`
                        </button>`,e=`
		<div class="row">
			<div class="chat px-3">
			
			  <div class="mb-auto row">
				<div class="text-start display-block">
				  <div class="text-start float-start btn w-100">

					<div class="d-inline">
						<div class="float-start">
							<a class="active text-light close mx-2" aria-current="page" href="#" ><i class="fas fa-arrow-left"></i></a>
							<img src="`+f+`" class="img-pro-pm-chat" />
						</div>
						<div class="float-start mx-2">
							<div class="pro-small">
								<label class="name">`+t+`</label>
								<label class="role">`+i+`</label>
							</div>
						</div>

						<div class="float-end text-end">
						  <div class="text-start float-end btn px-0">
							<a class="active text-light pr-2 d-none" aria-current="page" href="#" title="Deselect"><i class="fa fa-remove"></i></a>
							<a class="active text-light pr-2 d-none" aria-current="page" href="#" title="Copy"><i class="fa-solid fa-copy"></i></a>
							<a class="active text-light pr-2 d-none" aria-current="page" href="#" title="Forward"><i class="fa-solid fa-share"></i></a>
							<a class="active text-light pr-2 d-none" aria-current="page" href="#" title="Reply"><i class="fa-solid fa-reply"></i></a>
							<a class="active text-light pr-2 d-none" aria-current="page" href="#" title="Edit"><i class="fa fa-edit"></i></a>
							<a class="active text-light d-none" aria-current="page" href="#" title="Remove"><i class="fa-solid fa-trash"></i></a>
							`+($(".contact.active").hasClass("grp")?`<a class="active text-light d-none" aria-current="page" href="#"><i class="fa fa-info-circle"></i></a>`:`
							    <a class="active text-light pr-2" aria-current="page" href="#"><i class="fas fa-phone"></i></a>
							    <a class="active text-light" aria-current="page" href="#"><i class="fas fa-video"></i></a>`)+`
						  </div>
						</div>
					</div>
				  </div>
				</div>
			  </div>
			  <div class="row tab-div">
				<div class="chat-pm">
        `+r+`
        
					<div id="drop-area" class="chat-pm-input ">
						
						<textarea rows="1" class="w-100 form-control" ></textarea>
						<div class="send-btn">
                            <div class="input-group-append" id="microphone_btn">
                                <span class="input-group-text microphone_btn"><i class="fa fa-microphone"></i></span>
                            </div>
                            <div class="input-group-append" id="stopButton">
                                <span class="input-group-text stopButton"><i class="fa fa-stop-circle"></i></span>
                            </div>
							<img class="attach" src="/img/attach_file.png" />
							<img class="send" src="/img/send-icon.svg" />
						</div>
					</div>
                </div>
            </div>`;$("#ChatPmModal .modal-body").html(e);backToTop();handleDropFileArea();$("#ChatPmModal").modal("show");$("#ChatPmModal .close").on("click",function(){fromNewChat?window.location.href="/":$("#ChatPmModal").modal("hide")});$(".fa-video").on("click",function(){VideoCallProcess()});$(".fa-phone").on("click",function(){VoiceCallProcess()});$(".lmore").on("click",function(){lmore=!0;var n=$(".contact.active").data("id");$.post("/Home/GetContactMessage",{minId:minId,contactId:n},function(n){$(".loading").hide();n==null||n.length==0?SetEmptyMessage():(SetResultOfMessage(n),$(".contact.active .text-bg-success").html("(0)"))})});setTimeout(function(){$(".chat-pm ul").scrollTop($(".chat-pm ul").get(0).scrollHeight)},500);setSomeFeatureForSendingMess();loadRecData();$("li .card .card-header").on("click",function(){var i=$(this).data("senderid"),n,t;if(i){$("#ChatPmModal").modal("hide");$(".contact.active").removeClass("active");$('.contact[data-id="'+i.toLowerCase()+'"]').addClass("active");setTimeout(function(){$('.contact[data-id="'+i.toLowerCase()+'"]').trigger("click")},400);return}n=$(this).parent().data("id");t=$('[data-id="'+n+'"]').get(0).offsetTop-150;t=t>0?t:0;$(".chat-pm ul").scrollTop(t);$('[data-id="'+n+'"]').eq(0).css("background","black");setTimeout(function(){$('[data-id="'+n+'"]').eq(0).css("background","transparent")},500);setTimeout(function(){$('[data-id="'+n+'"]').eq(0).css("background","black")},1e3);setTimeout(function(){$('[data-id="'+n+'"]').eq(0).css("background","transparent")},1500)})}function handleDropFileArea(){function t(n){n.preventDefault();n.stopPropagation()}function i(){n.classList.add("highlight")}function r(){n.classList.remove("highlight")}function u(n){var t,i,r;let u=n.dataTransfer,f=u.files[0];t=new FormData;t.append("file1",f);i=$(".contact.active").data("id");t.append("contactId",i);t.append("replyId",replyid);r=`<li class="from-me" id="tempProgressBar" >
              <div class="progress">
                <div class="progress-bar" id="my-progress-bar" role="progressbar" style="width: 25%" aria-valuenow="25" aria-valuemin="0" aria-valuemax="100">25%</div>
              </div>
            </li>`;$("#lastchat").before(r);$(".chat-pm ul").scrollTop($(".chat-pm ul").get(0).scrollHeight);setTimeout(function(){$(".chat-pm ul").scrollTop($(".chat-pm ul").get(0).scrollHeight)},500);uploadFile(t)}let n=document.getElementById("drop-area");["dragenter","dragover","dragleave","drop"].forEach(i=>{n.addEventListener(i,t,!1)});["dragenter","dragover"].forEach(t=>{n.addEventListener(t,i,!1)});["dragleave","drop"].forEach(t=>{n.addEventListener(t,r,!1)});n.addEventListener("drop",u,!1)}function VideoCallProcess(){try{if(console.log("IsCameraPermission:"+IsCameraPermission),IsCameraPermission==!1){IsCameraPermission=JSBridge.getVideoPermission();console.log("IsCameraPermission:"+IsCameraPermission);return}}catch{}if(wsconn.connectionState!="Connected"){SendNotConnectAlert("you are not connect to signalr. For video call you must refresh page. For refresh page touch on ok button.");return}beepring.play();beepring.volume=.3;$("#call-status-lbl").html("video calling to user...");isVideoCall=!0;console.log("calling user... ");$("#VideoCallModalLabel").html("Video Call");dt1=new Date;videoaudiotimer=setTimeout(timerDisplayFun,1e3);$(".partner")[0].style.display="none";localVideo.style.display="";remoteVideo.style.display="";var n=$(".def-mess.active").attr("data-id");if($("body").attr("data-mode")!=="idle"){alertify.error("Sorry, you are already in a call.  Conferencing is not yet implemented.").set({title:"ZN Vostok"}).set({delay:5e3});return}n!=myUserId?($.post("/Home/CallLogUpdate",{IsVideo:!0,Status:1,ToUser:n},function(){}),initializeUserMediaVideo(),wsconn.invoke("callUser",n,!0),dt1=new Date,setTimeout(timerDisplayFun,1e3),$("body").attr("data-mode","calling"),$("#VideoCallModal").modal("show"),$("#callstatus").text("Calling...")):alertify.error("Ah, nope.  Can't call yourself.").set({title:"ZN Vostok"}).set({delay:5e3})}function VoiceCallProcess(){try{if(console.log("IsMicrophonePermission:"+IsMicrophonePermission),IsMicrophonePermission==!1){IsMicrophonePermission=JSBridge.getAudioPermission();console.log("IsMicrophonePermission:"+IsCameraPermission);return}}catch{}if(wsconn.connectionState!="Connected"){SendNotConnectAlert("you are not connect to signalr. For voice call you must refresh page. For refresh page touch on ok button.");return}beepring.volume=.3;beepring.play();$("#call-status-lbl").html("voice calling to user...");isVideoCall=!1;dt1=new Date;videoaudiotimer=setTimeout(timerDisplayFun,1e3);localVideo.style.display="none";remoteVideo.style.display="none";$("#VideoCallModalLabel").html("Voice Call");console.log("calling user... ");var n=$(".def-mess.active").attr("data-id");if($("body").attr("data-mode")!=="idle"){alertify.error("Sorry, you are already in a call.  Conferencing is not yet implemented.").set({title:"ZN Vostok"}).set({delay:5e3});return}n!=myUserId?($.post("/Home/CallLogUpdate",{IsVideo:!1,Status:1,ToUser:n},function(){}),initializeUserMediaVoice(),wsconn.invoke("callUser",n,!1),$("body").attr("data-mode","calling"),$("#ChatPmModal").modal("hide"),$("#VideoCallModal").modal("show"),$("#callstatus").text("Calling...")):alertify.error("Ah, nope.  Can't call yourself.").set({title:"ZN Vostok"}).set({delay:5e3})}function timerDisplayFun(){var r=new Date,n=r-dt1,t=Math.floor(n/1e3%60),i=Math.floor(n/6e4);document.querySelector(".recording-timer-display label").innerHTML=(i<10?"0":"")+i.toString()+":"+(t<10?"0":"")+t.toString();videoaudiotimer=setTimeout(timerDisplayFun,1e3)}function videoAndVoiceCallClick(){$(".social-media .fa-video-camera").on("click",function(){isVideoCall=!0;console.log("calling user... ");$("#VideoCallModalLabel").html("Video Call");$(".partner")[0].style.display="none";localVideo.style.display="";remoteVideo.style.display="";try{Android.loadCamera()}catch(t){alertify.error(t).set({title:"ZN Vostok"}).set({delay:5e3})}var n=$(".def-mess.active").attr("data-id");if($("body").attr("data-mode")!=="idle"){alertify.error("Sorry, you are already in a call.  Conferencing is not yet implemented.").set({title:"ZN Vostok"}).set({delay:5e3});return}n!=myUserId?(initializeUserMediaVideo(),wsconn.invoke("callUser",n,!0),$("body").attr("data-mode","calling"),$("#VideoCallModal").modal("show"),$("#callstatus").text("Calling...")):alertify.error("Ah, nope.  Can't call yourself.").set({title:"ZN Vostok"}).set({delay:5e3})});$(".social-media .fa-phone").on("click",function(){isVideoCall=!1;localVideo.style.display="none";remoteVideo.style.display="none";try{Android.loadMicrophone()}catch(t){alertify.error(t).set({title:"ZN Vostok"}).set({delay:5e3})}dt1=new Date;videoaudiotimer=setTimeout(timerDisplayFun,1e3);$("#VideoCallModalLabel").html("Voice Call");console.log("calling user... ");var n=$(".def-mess.active").attr("data-id");if($("body").attr("data-mode")!=="idle"){alertify.error("Sorry, you are already in a call.  Conferencing is not yet implemented.").set({title:"ZN Vostok"}).set({delay:5e3});return}n!=myUserId?(initializeUserMediaVoice(),wsconn.invoke("callUser",n,!1),$("body").attr("data-mode","calling"),$("#VideoCallModal").modal("show"),$("#callstatus").text("Calling...")):alertify.error("Ah, nope.  Can't call yourself.").set({title:"ZN Vostok"}).set({delay:5e3})})}function SetResultOfMessage(n,t,i){var f="",r,e,s,o,u,h,c,v,l,a;for(lmore==!1&&(f+="<ul>"),n.length>0&&(minId=n[n.length-1].id),minId>parseInt($(".contact.active").attr("minid"))&&(f+="<li class='lmore'><button class='btn btn-info'>load more<\/button><\/li>"),r=n.length-1;r>=0;r--)if(n[r].isFile==!1)f+=`<li class="`+(n[r].isReciver?"from-me":"from-other")+`" data-id="`+n[r].id+`" >`+(n[r].grpContactName?"<div class='name'>"+n[r].grpContactName+"<\/div>":"")+(n[r].body.indexOf(",;,")>=0?`<div class="card" data-id="`+(n[r].replyId?n[r].replyId:"")+`" >
                      <div class="card-header" `+ForwardSenderId(n[r].body)+`>`+n[r].body.split(",;,")[0].split(",@,")[0]+`
                      </div><label`+checkRtlOfText(n[r].body.split(",;,")[1])+`>`+textToWrite(n[r].body.split(",;,")[1])+`</label></div>`:`<label`+checkRtlOfText(n[r].body)+`>`+textToWrite(n[r].body)+`</label>`)+(n[r].isReciver?`<span class="`+IsSeen(n[r])+`">✓</span>`:"")+`</li><li class="`+(n[r].isReciver?"from-me":"from-other")+`" >
                    <div class="date">`+getNiceDateTimeFormat(n[r].createdDate)+`</div>
                </li>`;else for(e=[],e.push(n[r].body),s="",n[r].body.indexOf("^")>=0&&(e=n[r].body.split("^"),s=""),o=0;o<e.length;o++)u=e[o],e[o].indexOf(",;,")>0&&(u=e[o].split(",;,")[1],s=e[o].split(",;,")[0],e[o]=e[o].replace(",;,"," ")),f+=`<li class="`+(n[r].isReciver?"from-me":"from-other")+`" data-id="`+n[r].id+`" >`,f+=n[r].grpContactName?"<div class='name'>"+n[r].grpContactName+"<\/div>":"",s&&(f+=`<div class="card" data-id="`+(replyid?replyid:"")+`" >
                      <div class="card-header " `+ForwardSenderId(s)+`>`+s.split(",@,")[0]+`</div>`),f+=IsImage(u)?`<label ><a href="#" data-url="/Home/GetFile?fileName=`+u+`&fileType=up" class="img-tag"><div><img  class="fupload" src="/Home/GetFile?fileName=`+u+`&fileType=up&th=true" /></div><div>`+SimpleFileName(u)+`</div></a></label>`:IsAudio(u)?`<label><div><audio controls src="/Home/GetFile?fileName=`+u+`&fileType=up" ></audio></div><div> `+SimpleFileName(u)+`</div></label>`:IsVideo(u)?`<label><div><video controls  ><source src="/Home/GetFile?fileName=`+u+`&fileType=up" ></video></div><div> `+SimpleFileName(u)+`</div></label>`:IsPdfOrDoc(u)?`<label><a href="/Home/GetFile?fileName=`+u+`&fileType=up" target="_blank" ><div><img class="docpdfimg" src="/Home/GetFile?fileName=`+u.substring(0,u.lastIndexOf("."))+`.jpg&fileType=up&th=true" /></div><div>`+SimpleFileName(u)+`</div></a></label>`:`<label><a href="/Home/GetFile?fileName=`+u+`&fileType=up" target="_blank" ><div><img src="/img/file-icon.png" class="img-ico" /></div><div>`+SimpleFileName(u)+`</div></a></label>`,s&&(f+=`</div>`),f+=(n[r].isReciver?`<span class="`+IsSeen(n[r])+`">✓</span>`:"")+`</li>`,f+=`<li class="`+(n[r].isReciver?"from-me":"from-other")+`" >`+"<div class='date'>"+getNiceDateTimeFormat(n[r].createdDate)+"<\/div>"+`</li>`;if(lmore){$(".lmore").before(f);$(".lmore").length>1?$($(".lmore")[1]).remove():$(".lmore").remove();lmore=!1;$(".lmore").on("click",function(){lmore=!0;var n=$(".contact.active").data("id");$.post("/Home/GetContactMessage",{minId:minId,contactId:n},function(n){$(".loading").hide();n==null||n.length==0?SetEmptyMessage():(SetResultOfMessage(n),$(".contact.active .text-bg-success").html("0"))})});return}f+="<li id='lastchat'><\/li><\/ul>";h="";c="";$(".contact.active").hasClass("grp")?(i=i?i:$(".contact.active .group-name").html(),h=i.length>30?i.substring(0,29)+"...":i,c=$(".contact.active .chat-bio").text()):(i=i?i:$(".contact.active .name").html(),h=i.length>30?i.substring(0,29)+"...":i,v=$(".contact.active .company").text(),c=$(".contact.active .role").text());l=$(".contact.active img").attr("src");a=`
		<div class="row">
			<div class="chat px-3">
			
			  <div class="mb-auto row">
				<div class="text-start display-block">
				  <div class="text-start float-start btn w-100">

					<div class="d-inline">
						<div class="float-start">
							<a class="active text-light close mx-2" aria-current="page" href="#" ><i class="fas fa-arrow-left"></i></a>
							<img src="`+l+`" class="img-pro-pm-chat" />
						</div>
						<div class="float-start mx-2">
							<div class="pro-small" >
								<label class="name">`+h+`</label>
								<label class="role">`+c+`</label>
							</div>
						</div>

						<div class="float-end text-end">
						  <div class="text-start float-end btn px-0">
							<a class="active text-light pr-2 d-none" aria-current="page" href="#" title="Deselect"><i class="fa fa-remove"></i></a>
							<a class="active text-light pr-2 d-none" aria-current="page" href="#" title="Copy"><i class="fa-solid fa-copy"></i></a>
							<a class="active text-light pr-2 d-none" aria-current="page" href="#" title="Forward"><i class="fa-solid fa-share"></i></a>
							<a class="active text-light pr-2 d-none" aria-current="page" href="#" title="Reply"><i class="fa-solid fa-reply"></i></a>
							<a class="active text-light pr-2 d-none" aria-current="page" href="#" title="Edit"><i class="fa fa-edit"></i></a>
							<a class="active text-light pr-2 d-none" aria-current="page" href="#" title="Remove"><i class="fa-solid fa-trash"></i></a>
							`+($(".contact.active").hasClass("grp")?`<a class="active text-light d-none" aria-current="page" href="#"><i class="fa fa-info-circle"></i></a>`:`
							    <a class="active text-light pr-2" aria-current="page" href="#"><i class="fas fa-phone"></i></a>
							    <a class="active text-light" aria-current="page" href="#"><i class="fas fa-video"></i></a>`)+`
						  </div>
						</div>
					</div>
				  </div>
				</div>
			  </div>
			  <div class="row tab-div">
				<div class="chat-pm">
        `+f+`
                <a href="#" class="back-to-top z-3 d-flex align-items-center justify-content-center active"><i class="fa fa-arrow-down"></i></a>
					<div id="drop-area" class="chat-pm-input ">
						<textarea rows="1" class="w-100 form-control" ></textarea>
						<div class="send-btn">
                            <div class="input-group-append" id="microphone_btn">
                                <span class="input-group-text microphone_btn"><i class="fa fa-microphone"></i></span>
                            </div>
                            <div class="input-group-append" id="stopButton">
                                <span class="input-group-text stopButton"><i class="fa fa-stop-circle"></i></span>
                            </div>
							<img class="attach" src="/img/attach_file.png" />
							<img class="send" src="/img/send-icon.svg" />
						</div>
					</div>
                </div>
            </div>`;$("#ChatPmModal .modal-body").html(a);backToTop();handleDropFileArea();$(".img-tag").on("click",function(){if(SelectLi==!1){var n=$(this).data("url");loadImageModal(n)}});$("#close-img-modal").on("click",function(){$("#imgViewerModal").modal("hide")});$("#ChatPmModal").modal("show");$(".pro-small").on("click",function(){$(".loading").show();window.location.href="/Home/Profile?uid="+$(".contact.active").data("id")+"&IsGroup="+$(".contact.active").hasClass("grp")});$("#ChatPmModal .close").on("click",function(){fromNewChat?($(".loading").show(),window.location.href="/"):($(".contact").removeClass("active"),$("#ChatPmModal").modal("hide"))});$(".chat-pm-input textarea").on("keyup",function(){var n=$(this).val();hasPersian(n)?$(this).addClass("rtl"):$(this).removeClass("rtl")});$(".fa-video").on("click",function(){VideoCallProcess()});$(".fa-phone").on("click",function(){VoiceCallProcess()});$(".lmore").on("click",function(){lmore=!0;var n=$(".contact.active").data("id");$.post("/Home/GetContactMessage",{minId:minId,contactId:n},function(n){$(".loading").hide();n==null||n.length==0?SetEmptyMessage():(SetResultOfMessage(n),$(".contact.active .text-bg-success").html("0"))})});setTimeout(function(){t?($(".chat-pm ul").scrollTop($('[data-id="'+t+'"]').offset().top),$("#showinchatStyle").html('[data-id="'+t+'"]{background:black}'),setTimeout(function(){$("#showinchatStyle").html("")},500),setTimeout(function(){$("#showinchatStyle").html('[data-id="'+t+'"]{background:black}')},1e3),setTimeout(function(){$("#showinchatStyle").html("")},1500)):$(".chat-pm ul").scrollTop($(".chat-pm ul").get(0).scrollHeight)},500);setSomeFeatureForSendingMess();loadRecData();$("li .card .card-header").on("click",function(){var t=$(this).data("senderid"),n;if(t){$("#ChatPmModal").modal("hide");$(".contact.active").removeClass("active");$('.contact[data-id="'+t.toLowerCase()+'"]').addClass("active");setTimeout(function(){$('.contact[data-id="'+t.toLowerCase()+'"]').trigger("click")},400);return}n=$(this).parent().data("id");$(".chat-pm ul").scrollTop($('[data-id="'+n+'"]').get(0).offsetTop-200);$('[data-id="'+n+'"]').eq(0).css("background","black");setTimeout(function(){$('[data-id="'+n+'"]').eq(0).css("background","transparent")},500);setTimeout(function(){$('[data-id="'+n+'"]').eq(0).css("background","black")},1e3);setTimeout(function(){$('[data-id="'+n+'"]').eq(0).css("background","transparent")},1500)})}function SimpleFileName(n){return n?n.length>25?n.substring(0,12)+"..."+n.substring(n.length-10):n:""}function ForwardSenderId(n){return n&&n.indexOf(",@,")>0?` data-senderid="`+n.split(",@,")[1].split(">>")[0]+`" `:""}function IsSeen(n){return n.isSeen||n.isSeen==null?"seen":""}function loadImageModal(n){var t=n;$("#img").attr("src",t);$("#download-img").attr("href",t);start();$("#img").removeClass("d-none");$("#imgViewerModal").modal("show");$("#img").on("load",function(){var n=this.width,t=this.height,i=$(window).width()-10,r=$(window).height()-160;if(n<=i&&t<=r)$("#canvas").attr("height",n),$("#canvas").attr("width",t),$("#img").addClass("d-none");else{var s=i>=n?i:n,c=i>=n?n:i,h=r>=t?r:t,l=r>=t?t:r,e=(s-c)/s,o=(h-l)/h,u=0,f=0;e>o?(u=n*(1-e),f=t*(1-e)):(u=n*(1-o),f=t*(1-o));$("#canvas").attr("height",f);$("#canvas").attr("width",u);$("#img").addClass("d-none");console.log("newH-newW",f+","+u)}initDraw();$(".loading").hide()});$(".loading").show()}function contact_must_be_selected(n){n&&n.hasClass("selected")?n.removeClass("selected"):n&&n.addClass("selected");$(".chat-pm li.selected").length==0?(SelectLi=!1,$(".fa-video").parent().bsShow(),$(".fa-phone").parent().bsShow(),$(".pro-small").parent().bsShow(),$(".fa-share").parent().bsHide(),$(".fa-reply").parent().bsHide(),$(".fa-copy").parent().bsHide(),$(".fa-edit").parent().bsHide(),$(".fa-info-circle").parent().bsHide(),$(".modal-body .fa-trash").parent().bsHide(),$(".fa-remove").parent().bsHide()):$(".chat-pm li.selected").length==1?(SelectLi=!0,$(".fa-video").parent().bsHide(),$(".fa-phone").parent().bsHide(),$(".pro-small").parent().bsHide(),$(".fa-share").parent().bsShow(),$(".fa-reply").parent().bsShow(),$(".chat-pm li.selected").hasClass("from-me")?$(".fa-info-circle").parent().bsShow():$(".fa-info-circle").parent().bsHide(),$(".chat-pm li.selected").hasClass("from-me")?$(".fa-edit").parent().bsShow():$(".fa-edit").parent().bsHide(),$(".chat-pm li.selected").hasClass("from-me")?$(".modal-body .fa-trash").parent().bsShow():$(".modal-body .fa-trash").parent().bsHide(),$(".fa-remove").parent().bsShow()):(SelectLi=!0,$(".fa-phone").parent().bsHide(),$(".fa-video").parent().bsHide(),$(".pro-small").parent().bsHide(),$(".fa-share").parent().bsShow(),$(".fa-reply").parent().bsHide(),$(".fa-copy").parent().bsHide(),$(".fa-info-circle").parent().bsHide(),$(".fa-edit").parent().bsHide(),canRemove()?$(".modal-body .fa-trash").parent().bsShow():$(".modal-body .fa-trash").parent().bsHide(),$(".fa-remove").parent().bsShow())}function canRemove(){var n=!0;return $(".chat-pm li.selected").each(function(t,i){if(!$(i).hasClass("from-me"))return n=!1,!1}),n}function image_must_be_selected(n){n&&n.hasClass("selected")?n.removeClass("selected"):n&&n.addClass("selected");$(".img-tag.selected").length==0?$("#selectedItembtn").bsHide():$(".img-tag.selected").length==1?$("#selectedItembtn").bsShow():$("#selectedItembtn").bsShow()}function file_must_be_selected(n){n&&n.hasClass("selected")?n.removeClass("selected"):n&&n.addClass("selected");$(".file-tag.selected").length==0?$("#selectedItembtn").bsHide():$(".file-tag.selected").length==1?$("#selectedItembtn").bsShow():$("#selectedItembtn").bsShow()}function voice_must_be_selected(n){n&&n.hasClass("selected")?n.removeClass("selected"):n&&n.addClass("selected");$(".voice-tag.selected").length==0?$("#selectedItembtn").bsHide():$(".voice-tag.selected").length==1?$("#selectedItembtn").bsShow():$("#selectedItembtn").bsShow()}function setSomeFeatureForSendingMess(){sendMessagebtn();loadForSelectLi();allDropDownButtonProcess()}function loadForSelectLi(){var n=0;$(".chat-pm li").unbind("mousedown");$(".chat-pm li").unbind("mouseup");$(".chat-pm li").unbind("mouseleave");$(".chat-pm li").unbind("mouseleave");$(".chat-pm li").unbind("touchstart");$(".chat-pm li").unbind("touchend");$(".chat-pm li").on("mousedown touchstart",function(t){var i=$(this);SelectLi&&t.type=="mousedown"&&contact_must_be_selected(i);n=setTimeout(function(){contact_must_be_selected(i)},1e3)}).on("mouseup mouseleave touchend",function(){clearTimeout(n)})}function loadForSelectImage(){var n=0;$(".img-tag").unbind("mousedown");$(".img-tag").unbind("mouseup");$(".img-tag").unbind("mouseleave");$(".img-tag").unbind("mouseleave");$(".img-tag").unbind("touchstart");$(".img-tag").unbind("touchend");$(".img-tag").on("mousedown touchstart",function(){var t=$(this);selectedImage=!1;n=setTimeout(function(){image_must_be_selected(t);selectedImage=!0},1e3)}).on("mouseup mouseleave touchend",function(){clearTimeout(n)})}function loadForSelectFile(){var n=0;$(".file-tag").unbind("mousedown");$(".file-tag").unbind("mouseup");$(".file-tag").unbind("mouseleave");$(".file-tag").unbind("mouseleave");$(".file-tag").unbind("touchstart");$(".file-tag").unbind("touchend");$(".file-tag").on("mousedown touchstart",function(){var t=$(this);selectedFile=!1;n=setTimeout(function(){file_must_be_selected(t);selectedFile=!0},1e3)}).on("mouseup mouseleave touchend",function(t){selectedFile&&t.preventDefault();clearTimeout(n)});$(".filea").on("click",function(n){selectedFile&&n.preventDefault()})}function loadForSelectVoice(){var n=0;$(".voice-tag").unbind("mousedown");$(".voice-tag").unbind("mouseup");$(".voice-tag").unbind("mouseleave");$(".voice-tag").unbind("mouseleave");$(".voice-tag").unbind("touchstart");$(".voice-tag").unbind("touchend");$(".voice-tag").on("mousedown touchstart",function(){var t=$(this);selectedVoice=!1;n=setTimeout(function(){voice_must_be_selected(t);selectedVoice=!0},1e3)}).on("mouseup mouseleave touchend",function(){clearTimeout(n)})}function sendMessagebtn(){$(".send-btn .send").on("click",function(){SendMessageProcess(!1)});$(".send-btn .attach").on("click",SendFileProcess);$(".chat-pm-input textarea").on("keydown",function(n){if(n.keyCode==13&&n.shiftKey)return SendMessageProcess(!1),!1})}function allDropDownButtonProcess(){deselectBtnProcess();copyBtnProcess();replyBtnProcess();seenListBtnProcess();editBtnProcess();forwardBtnProcess();deleteBtnProcess()}function deleteBtnProcess(){$(".modal-body .fa-trash").on("click",function(){$("#deleteModal").modal("show")});$(".del_").removeClass("del_").addClass("del")}function forwardBtnProcess(){$(".fa-share").on("click",function(){forwardid="";$(".chat-pm li.selected").each((n,t)=>{forwardid+=$(t).data("id")+","});forwardid=forwardid.substring(0,forwardid.length-1);var n="";n+=$(".contacts").clone().html();$("#forward-body").html(n);$("#forward-body .mess").on("click",function(){$("#forward-body .mess").removeClass("active");$(this).addClass("active")});$("#forwardModal").modal("show")});$(".for_").removeClass("for_").addClass("for")}function deselectBtnProcess(){$(".fa-remove").on("click",function(){$(".chat-pm li.selected").removeClass("selected");contact_must_be_selected()})}function copyBtnProcess(){$(".fa-copy").on("click",function(){var t=HTMLEncode($(".chat-pm li.selected label").eq(0).text()),n;$("#mycopytextarea").bsShow();$("#mycopytextarea").html(t);n=document.getElementById("mycopytextarea");n.select();n.setSelectionRange(0,99999);$("#mycopytextarea").focus();navigator.clipboard.writeText(n.value);try{JSBridge.copyToClipboard(n.value)}catch{}$(".chat-pm li.selected").removeClass("selected");contact_must_be_selected();$("#mycopytextarea").bsHide()})}function HTMLEncode(n){const i={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&apos;"};var t=n;for(const n in i)t.indexOf(n)>=0&&(t=t.replaceAll(n,i[n]));return t}function replyBtnProcess(){$(".fa-reply").on("click",function(){var n,t;if($(".chat-pm-input .card-header a").trigger("click"),forwardid="",innerHtmlReply=$(".chat-pm-input").eq(0).html(),beforeReplytext=$(".chat-pm-input textarea").eq(0).val(),n=$(".chat-pm li.selected").eq(0),n){replyid=n.data("id");replyid||(replyid=n.parent().data("id"));t=HTMLEncode(n.get(0).innerText.length>20?n.get(0).innerText.substring(0,20):n.get(0).innerText);$(".chat-pm-input").html(`<div class="card" >
                  <div class="card-header reply" data-id="`+replyid+`">`+t+`<a class="float-end px-3">X</span></a></div>`+innerHtmlReply+`</div>`);$(".chat-pm-input textarea").val(beforeReplytext);$(".chat-pm-input textarea").focus();$(".chat-pm-input .card-header a").on("click",function(){beforeReplytext=$(".chat-pm-input textarea").val();$(".chat-pm-input").html(innerHtmlReply);replyid="";$(".chat-pm textarea").val(beforeReplytext);loadRecData();sendMessagebtn()});sendMessagebtn();$(".chat-pm li.selected").removeClass("selected");contact_must_be_selected()}});$(".rep_").removeClass("rep_").addClass("rep")}function seenListBtnProcess(){$(".fa-info-circle").on("click",function(){$(".loading").show();var n=$(".chat-pm li.selected").eq(0).data("id");$.post("/Home/GetSeenListMess",{messId:n},function(n){var i,t;for($(".loading").hide(),i="",i=n.length==0?"<div>No one seen this messege.<\/div>":n.length==1?"<div>1 person seen this messege:<\/div>":"<div>"+n.length.toString()+" people seen this messege:<\/div>",t=0;t<n.length;t++)i+=`<div>`+n[t].name+` - `+getNiceDateTimeFormat(n[t].createdDate)+`</div>`;alertify.alert(i).set({title:"ZN Vostok"})})})}function editBtnProcess(){$(".fa-edit").on("click",function(){var n,t;if($(".chat-pm-input .card-header a").trigger("click"),forwardid="",innerHtmlReply=$(".chat-pm-input").eq(0).html(),beforeCopytext=$(".chat-pm-input textarea").eq(0).val(),n=$(".chat-pm li.selected").eq(0),n){editid=n.data("id");editid||(editid=n.parent().data("id"));t=HTMLEncode(n.get(0).innerText.length>20?n.get(0).innerText.substring(0,20):n.get(0).innerText);$(".chat-pm-input").html(`<div class="card" >
                  <div class="card-header reply" data-id="`+replyid+`">`+t+`<a class="float-end px-3">X</span></a></div>`+innerHtmlReply+`</div>`);$(".chat-pm-input textarea").val(n.find("label").text());$(".chat-pm-input textarea").focus();$(".chat-pm-input .card-header a").on("click",function(){beforeReplytext=$(".chat-pm-input textarea").val();$(".chat-pm-input").html(innerHtmlReply);editid="";editId="";$(".chat-pm textarea").val(beforeReplytext);loadRecData();sendMessagebtn()});sendMessagebtn();$(".chat-pm li.selected").removeClass("selected");contact_must_be_selected()}});$(".rep_").removeClass("rep_").addClass("rep")}function SendFileProcess(){$("#fileinput").unbind("change");$("#fileinput").on("change",function(){var n=document.getElementById("fileinput"),t,i;n.files.length>0&&(t=$(".contact.active").data("id"),i=`<li class="from-me" id="tempProgressBar" >
              <div class="progress">
                <div class="progress-bar" id="my-progress-bar" role="progressbar" style="width: 25%" aria-valuenow="25" aria-valuemin="0" aria-valuemax="100">25%</div>
              </div>
            </li>`,$("#lastchat").before(i),setTimeout(function(){$(".chat-pm ul").scrollTop($(".chat-pm ul").get(0).scrollHeight)},500),fileUploader(n,t))});$("#fileinput").trigger("click")}function SendMessageProcess(n){n=n?n:!1;var i="",t="";$(".chat-pm-empty").hide();n==!1?(i=$(".chat-pm-input textarea").val(),t=$(".contact.active").data("id")):t=$("#forward-body .mess.active").data("id");(i||n)&&($(".loading").show(),n==!1&&$(".chat-pm-input textarea").val(""),$.post("/Home/sendMess",{mess:i,contactId:t,replyId:n?"":replyid,forwardId:n?forwardid:"",editId:editid},function(i){var u,f,r;if($(".loading").hide(),n==!1||$("#forward-body .mess.active").data("id")==$(".contact.active").data("id")){for(u="",f="",r=0;r<i.length;r++)f=i[r].body.indexOf(",;,")>=0?textToWrite(i[r].body.split(",;,")[1]):textToWrite(i[r].body),u+=`<li class ="from-me" data-id="`+i[r].id+`" data-time="`+i[r].createdDate+`">`+(i[r].grpContactName?"<div class='name'>"+i[r].grpContactName+"<\/div>":"")+(i[r].body.indexOf(",;,")>=0?`<div class="newcard" data-id="`+(i[r].replyId?i[r].replyId:"")+`" >
                              <div class="card-header">
                              `+i[r].body.split(",;,")[0]+`
                              </div><label`+checkRtlOfText(i[r].body.split(",;,")[1])+`>`+textToWrite(i[r].body.split(",;,")[1])+`</label><span >✓</span></div>`:`<label `+checkRtlOfText(i[r].body)+`>`+textToWrite(i[r].body)+`</label><span >✓</span>`)+`</li><li class ="from-me" >`+`<div class="date" data-id="`+(i[r].replyId?i[r].replyId:"")+`" >`+getNiceDateTimeFormat(i[r].createdDate)+`</div>`+`</li>`;editid?$('li[data-id="'+editid+'"] label').html(f):$("#lastchat").before(u);$("li .newcard:not(.card) .card-header").on("click",function(){var n=$(this).parent().data("id");$(".chat-pm ul").scrollTop($('[data-id="'+n+'"]').get(0).offsetTop-200);$('[data-id="'+n+'"]').eq(0).css("background","black");setTimeout(function(){$('[data-id="'+n+'"]').eq(0).css("background","transparent")},500);setTimeout(function(){$('[data-id="'+n+'"]').eq(0).css("background","black")},1e3);setTimeout(function(){$('[data-id="'+n+'"]').eq(0).css("background","transparent")},1500)});$("li .newcard:not(.card)").addClass("card");$(".chat-pm ul").scrollTop($(".chat-pm ul").get(0).scrollHeight);n==!1?($(".chat-pm-input textarea").val(""),(replyid||editid)&&($(".chat-pm-input .card-header a").trigger("click"),replyid="",editid="")):$(".chat-pm li").removeClass("selected");loadForSelectLi()}n&&$(".chat-pm li").removeClass("selected");contact_must_be_selected();$(".contact.active").hasClass("grp")?sendBySignalRToGroup(t,i[0].createdDate+";;;"+userid+";;;"+i[0].body+";;;"+i[0].id+";;;"+(n?"":replyid)+(n?forwardid:"")):sendBySignalR(t,i[0].createdDate+";;;"+userid+";;;"+i[0].body+";;;"+i[0].id+";;;"+(n?"":replyid)+(n?forwardid:""));$(".chat-pm-input textarea").focus()}))}function searchonmobile(){$("#search input").val($("#searchContact").val());searchContact();$("#searchContactModal").modal("hide")}function saveToDb(n,t,i){$.post("/Home/SaveAddress",{Latitude:n,Longitude:t,Address:i},function(n){console.log("logSaveAddress"+n)})}function IsImage(n){var t=n.toLowerCase().substring(n.lastIndexOf("."));return[".jpg",".jpeg",".bmp",".png",".gif",".tiff"].includes(t)?!0:!1}function IsAudio(n){var t=n.toLowerCase().substring(n.lastIndexOf("."));return[".wav",".mp3"].includes(t)?!0:!1}function IsVideo(n){var t=n.toLowerCase().substring(n.lastIndexOf("."));return[".mp4",".webm",".m4p",".mkv",".mpg",".3gp",".avi",".mov",".mp2",".ogg",".3gp",".qt",".3gp"].includes(t)?!0:!1}function IsPdfOrDoc(n){var t=n.toLowerCase().substring(n.lastIndexOf("."));return[".doc",".docx",".pdf"].includes(t)?!0:!1}function searchContact(n){n?$(".selectContact .new-ch").each(function(t,i){var r=$(i).find(".pro").text().toLowerCase();r.indexOf(n.toLowerCase())>=0?$(i).show():$(i).hide()}):$(".selectContact .new-ch").show()}function hasPersian(n){if(n)return(m=n.match(/[آ-ی]|([a-zA-Z])/))!==null?m[1]?!1:!0:!0;return!1}function checkRtlOfText(n){return hasPersian(n)?" class='direction-rtl'":""}function textToWrite(n){return n.split("\n").join("<br />\n")}function backToTop(){let n=$(".back-to-top").get(0);n&&$(".chat-pm ul").get(0).addEventListener("scroll",function(){$(".chat-pm ul").get(0).scrollHeight-$(".chat-pm ul").scrollTop()>$(window).height()*1.5?n.classList.add("active"):n.classList.remove("active")});$(".back-to-top,.fa-arrow-down").on("click",function(){$(".chat-pm ul").scrollTop($(".chat-pm ul").get(0).scrollHeight)})}function searchContent(){var n=$("#SearchModal input").val();n?($("#search-contents").html(""),$.post("/Home/GetSearchContent",{searchKey:n},function(n){var i,t;if(n.length==0){i=`<ul><li class="content new-search-content">
                        <div class="wrap">
                            <div class="meta">
                                <p class="name">Not Found</p>
                                <p class="preview">nothing!</p>
                            </div>
                        </div>
                    </li></ul>`;$("#search-contents").append(i);return}for(i="",t=0;t<n.length;t++)i+=`<div class="new-ch content col-12 m-2 " data-id="`+n[t].id+`">
                            <div class="row">
                                <div class="col-12 mx-3">
                                    <div class="float-start mx-3 ">`+(n[t].profilePic?'<img src="/ProfilePics/thumbnails/'+n[t].profilePic+'" class="img-pro" />':'<img src="/user-profile.png" class="img-pro" />')+`</div>
                                    <div class="float-start text-start d-contents px-2">
                                        <div class="pro">
                                            <label class="name">`+n[t].contactName+`</label>
                                            <label class="role">`+(n[t].body.length>30?n[t].body.substring(0,30):n[t].body)+`</label>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>`;$("#search-contents").append(i);$(".content").on("click",function(){var n=$(this).data("id");$(".loading").show();window.location.href="/?showInChat="+n})})):($(".new-search-mess").hide(),$(".def-mess").show())}function getDuraton(n){var t=Math.round(n),i="";return t>60&&(i=Math.floor(t/60)<10?"0"+Math.floor(t/60):Math.floor(t/60)),i+((i?":":"00:")+(Math.floor(t%60)<10?"0"+Math.floor(t%60):Math.floor(t%60)))}var faTrashClicked=!1,SelectLi=!1,minId="0",lmore=!1,visible,dt1,selectedImage,selectedFile,selectedVoice,fromNewChat;try{JSBridge.setUserId(myUserId)}catch{}visible=!0;$(".expand-button , #profile-img").on("click",showStatus);$($("#profile p")[0]).on("click",showStatus);$(document).on("click",function(){visible=!visible;visible&&($("#status-options").css("opacity","0"),$("#status-options").css("visibility","hidden"))});$("#status-options li").on("click",function(){var n=$(this).attr("id").split("-")[1];$("#profile-img").removeAttr("class");$("#profile-img").addClass(n);$.post("/Home/SetStatus",{status:n},function(){})});$("#search input").on("keydown",function(n){n.keyCode==13&&searchContact()});$("#showInChatBtn").on("click",function(){var n;$(".nav-link.active").attr("data-bs-target")=="#images-tab"?(n=$(".img-tag.selected").data("id"),window.location.href="/?showInChat="+n):$(".nav-link.active").attr("data-bs-target")=="#files-tab"?(n=$(".file-tag.selected").data("id"),window.location.href="/?showInChat="+n):$(".nav-link.active").attr("data-bs-target")=="#voices-tab"&&(n=$(".voice-tag.selected").data("id"),window.location.href="/?showInChat="+n)});var innerHtmlReply="",replyid="",editid="",beforeReplytext="",forwardid="",deleteid="";selectedImage=!1;selectedFile=!1;selectedVoice=!1;$("#btn-submit-delete").on("click",function(){var n="";$(".chat-pm li.selected").each((t,i)=>{n+=$(i).data("id")+","});n=n.substring(0,n.length-1);$.post("/Home/DelMess",{messid:n},function(t){if(t.length>0&&t[0].id>0){var i=$(".contact.active").data("id");sendBySignalRForDel(i,n+";;;"+userid);$.each(n.split(","),function(n,t){$(".chat-pm li[data-id="+t+"]").next(".chat-pm li").remove();$(".chat-pm li[data-id="+t+"]").remove()})}else alert("an error has occured!");$("#deleteModal").modal("hide");contact_must_be_selected();deleteid=""})});$("#btn-cancel-forward").on("click",function(){forwardid="";$("#forwardModal").modal("hide")});$("#btn-submit-forward").on("click",function(){$("#forward-body .mess.active").length>0&&SendMessageProcess(!0);forwardid="";$("#forwardModal").modal("hide");$(".chat-pm li.selected").removeClass("selected");contact_must_be_selected()});$("#forwardModal").on("hidden.bs.modal",function(){forwardid=""});$(".def-mess").on("click",function(){var t,n,i;if(faTrashClicked){faTrashClicked=!1;return}t=$(this).hasClass("grp");fromNewChat=!1;$(".loading").show();$(".contact").removeClass("active");$(this).addClass("active");n=$(this).data("id");i=$(this).data("id");$.post("/Home/GetContactMessage",{minId:"0",contactId:n,isGroup:t},function(t){$(".loading").hide();t==null||t.length==0?SetEmptyMessage():(SetResultOfMessage(t),$(".contact.active .text-bg-success").html("0"));wsconn.invoke("SeenMessege","all",n)})});$("#logout").on("click",function(){$("#logoutForm").submit()});$("#search-btn").on("click",function(){$("#searchContactModal").modal("show")});$("#searchContact").on("keydown",function(n){n.keyCode==13&&searchonmobile()});$(".search-contact").on("click",function(){searchonmobile()});$(".search-contact-reset").on("click",function(){$("#searchContact").val("")});$(".logout").on("click",function(){$("#logoutForm").submit()});$(".setting").on("click",function(){window.location.href="/Identity/Account/Manage/Index"});$(".chatpage").on("click",function(){window.location.href="/"});$(".chat-mess-new").on("click",function(){$.post("/Home/AllContact",{},function(n){for(var t,u,r="",i=0;i<n.length;i++)t=n[i],u=ul&&ul.find(n=>n.userId.toLowerCase()==t.id.toLowerCase()),r+=`<div class="new-ch contact col-12`+(u?" online":"")+`" data-id="`+t.id+`">
                            <div class="row">
                                <div class="col-12 mx-3 b-online">
                                    <div class="float-start mx-3 ">
                                        <img src="`+t.profilePic+`" class="img-pro" />
                                    </div>
                                    <div class="float-start text-start d-contents px-2">
                                        <div class="pro">
                                            <label class="name">`+(t.name?t.name:t.username)+(t.id==myUserId?"<span class='badge text-info'>(You)<\/span>":"")+`</label>
                                            <label class="company">`+t.companyName+`</label>
                                            <label class="role">`+t.position+`</label>
                                        </div>
                                    </div>
                                    <div class="on-bor" ></div>
                                </div>
                            </div>
                        </div>`;$(".selectContact").html(r);$("#selectContactModal").modal("show");$(".new-ch").on("click",function(){fromNewChat=!0;$("#selectContactModal").modal("hide");$(".contact").removeClass("active");$(this).addClass("active");var n=$(this).data("id"),t=$(this).data("id");$.post("/Home/GetContactMessage",{minId:"0",contactId:n},function(t){$(".loading").hide();t==null||t.length==0?SetEmptyMessage():(SetResultOfMessage(t),$(".contact.active .text-bg-success").html("0"));wsconn.invoke("SeenMessege","all",n)})})})});$(".sos").on("click",function(){fromNewChat=!0;$(".contact").removeClass("active");$(this).addClass("active");var n=$(this).data("id"),t=$(this).data("id");$.post("/Home/GetContactMessage",{minId:"0",contactId:n},function(t){$(".loading").hide();t==null||t.length==0?SetEmptyMessage():(SetResultOfMessage(t),$(".contact.active .text-bg-success").html("0"));wsconn.invoke("SeenMessege","all",n)})});$.fn.bsShow=function(){$(this).removeClass("d-none")};$.fn.bsHide=function(){$(this).addClass("d-none")};$("#forwardModal .close").on("click",function(){$("#forwardModal").modal("hide")});$("#deleteModal .close , #btn-cancel-delete").on("click",function(){$("#deleteModal").modal("hide")});$("#selectContactModal .close").on("click",function(){$("#selectContactModal").modal("hide")});$("#search-contact").on("keypress",function(n){var t=$(this).val()+n.key;searchContact(t)});$("#search-contact").on("keyup",function(n){if(n.keyCode==13){var t=$("#search-contact").val();searchContact(t)}(n.keyCode==8||n.keyCode==46)&&setTimeout(function(){var n=$("#search-contact").val();searchContact(n)},100)});$("#refresh-page-btn").on("click",function(){window.location.reload()});$("#localVideo , #remoteVideo").on("click",function(){$("#videoRemoteStyle").html().length==0?$("#videoRemoteStyle").html(`
            video#remoteVideo {
	            position: fixed;
	            top: 60vh;
	            left: 75vw;
	            width: 23vw;
	            height: 38vh;
                z-index:1;
            }
            video#localVideo {
	            position: fixed;
	            top: 0;
	            left: 0;
	            width: 100vw;
	            height: 100vh;
                z-index:0;
            }`):$("#videoRemoteStyle").html("")});$(".contact .fa-trash").on("click",function(){faTrashClicked=!0;var n=$(this).parent().parent().parent(),t=n.data("id");confirm("Are you share to delete this chat?")&&$.post("/Home/DeleteChat",{},function(){n.remove()})});$(".del-chat").on("click",function(){$(".contacts .fa-trash").each(function(n,t){$(t).parent().hasClass("d-none")?$(t).parent().removeClass("d-none"):$(t).parent().addClass("d-none")})});$(".fa-search").on("click",function(){$("#SearchModal input").val("");$("#SearchModal").modal("show")});$("#search-data").on("keydown",function(n){n.keyCode==13&&searchContent()});$("#SearchModal .fa-arrow-left").on("click",function(){$("#SearchModal").modal("hide")});$("#CreateGroupModal .fa-arrow-left").on("click",function(){$("#CreateGroupModal").modal("hide")});$("#calllog-tab").on("click",function(){$(".calls").html("");$.post("/home/getcall",null,function(n){for(var i="",t=0;t<n.length;t++)i+=`<div class="new-ch content col-12 m-2">
                            <div class="row">
                                <div class="col-12 mx-3">
                                    <div class="float-start mx-3 ">`+(n[t].profilePic?'<img src="/profilepics/thumbnails/'+n[t].profilePic+'" class="img-pro" />':'<img src="/user-profile.png" class="img-pro" />')+`</div>
                                    <div class="float-start text-start d-contents px-2">
                                        <div class="pro">
                                            <label class="name">`+n[t].contactName+`</label>
                                            <label class="role">`+(n[t].isVideo?"video call":"voice call")+"  Duration:"+getDuraton(n[t].duration)+`</label>
                                            <label class="role">`+getNiceDateTimeFormat(n[t].createdDate)+`</label>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>`;$(".calls").html(i)})});$(".newgroupCreate").on("click",function(){$.post("/Home/AllContact",{},function(n){for(var t,r="",u="",i=0;i<n.length;i++)t=n[i],u+=`<option value="`+t.id+`">`+(t.name?t.name:t.username)+"<\/option>";r=`<div class="content row">
                        <div class="col-lg-3 col-md-4 col-sm-6 px-3">
                            <label for="Title">Title</label>
                            <input id="Title" name="Title" class="form-control" />
                            <span asp-validation-for="Title" class="text-danger"></span>
                        </div>
                        <div class="col-lg-3 col-md-4 col-sm-6 px-3">
                            <label asp-for="GroupBIO">GroupBIO</label>
                            <input id="GroupBIO" name="GroupBIO" class="form-control" />
                            <span asp-validation-for="GroupBIO" class="text-danger"></span>
                        </div>
                        <div class="col-12 px-3">
                            <label asp-for="GroupUserIds">Users</label>
                            <select id="GroupUserIds" name="GroupUserIds" class="form-control select-search" multiple="">
                            `+u+`
                            </select>
                            <span asp-validation-for="GroupUserIds" class="text-danger"></span>
                        </div>
                        <div class="col-12 px-3">
                            <label >&nbsp;</label>
                            <button class="btn btn-primary" id="save-group">Save Group</button>
                        </div>
                    </div>
    <link href="/css/select2.min.css" rel="stylesheet" />
    <script src="/js/select2.min.js"></script>
    <script>
        $('.select-search').select2();
    </script>`;$("#group-contents").html(r);$("#CreateGroupModal").modal("show");$("#save-group").on("click",function(){var n=!1;($("#Title").val()||($('[asp-validation-for="Title"]').html("Title is required."),n=!0),$("#GroupBIO").val()||($('[asp-validation-for="GroupBIO"]').html("GroupBIO is required."),n=!0),$("#GroupUserIds").val()||($('[asp-validation-for="GroupUserIds"]').html("GroupUserIds is required."),n=!0),n)||$.post("/Home/CreateGroup",{Title:$("#Title").val(),GroupBIO:$("#GroupBIO").val(),GroupUserIds:$("#GroupUserIds").val()},function(){$(".loading").show();window.location.reload()})})})});