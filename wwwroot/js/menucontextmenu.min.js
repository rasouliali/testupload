function contact_must_be_selected(e){e&&e.hasClass("selected")?e.removeClass("selected"):e&&e.addClass("selected"),0==$(".chat-pm li.selected").length?(SelectLi=!1,$(".fa-video").parent().bsShow(),$(".fa-phone:not(.red)").parent().bsShow(),$(".pro-small").parent().bsShow(),$(".fa-share").parent().bsHide(),$(".fa-reply").parent().bsHide(),$(".fa-copy").parent().bsHide(),$(".fa-edit").parent().bsHide(),$(".fa-info-circle").parent().bsHide(),$(".modal-body .fa-trash").parent().bsHide(),$(".fa-remove").parent().bsHide(),$(".context-menu .close-context").bsHide(),$(".emjbtn").bsHide(),$(".context-menu").bsHide(),$(".attach-menu > .survey-btn").addClass("d-none"),$(".context-menu > .emj-report-result").remove(),$(".context-menu .survey-result").remove()):(1==$(".chat-pm li.selected").length?(SelectLi=!0,$(".fa-video").parent().bsHide(),$(".fa-phone:not(.red)").parent().bsHide(),$(".pro-small").parent().bsHide(),$(".fa-share").parent().bsShow(),$(".fa-reply").parent().bsShow(),$(".chat-pm li.selected").hasClass("from-me")?$(".fa-info-circle").parent().bsShow():$(".fa-info-circle").parent().bsHide(),$(".chat-pm li.selected").hasClass("from-me")?$(".fa-edit").parent().bsShow():$(".fa-edit").parent().bsHide(),$(".chat-pm li.selected").hasClass("from-me")?($(".modal-body .fa-trash").parent().bsShow(),$(".context-menu .delete-btn").bsShow()):($(".modal-body .fa-trash").parent().bsHide(),$(".context-menu .delete-btn").bsHide()),$(".fa-remove").parent().bsShow(),$(".emjbtn").bsShow(),$(".context-menu").bsShow(),$(".context-menu .reply-btn").bsShow(),$(".context-menu .close-context")):(SelectLi=!0,$(".fa-phone:not(.red)").parent().bsHide(),$(".fa-video").parent().bsHide(),$(".pro-small").parent().bsHide(),$(".fa-share").parent().bsShow(),$(".fa-reply").parent().bsHide(),$(".fa-copy").parent().bsHide(),$(".fa-info-circle").parent().bsHide(),$(".fa-edit").parent().bsHide(),canRemove()?($(".modal-body .fa-trash").parent().bsShow(),$(".context-menu .delete-btn").bsShow()):($(".modal-body .fa-trash").parent().bsHide(),$(".context-menu .delete-btn").bsHide()),$(".fa-remove").parent().bsShow(),$(".emjbtn").bsShow(),$(".context-menu .reply-btn").bsHide(),$(".context-menu .close-context").bsHide(),$(".context-menu"))).bsShow(),$(".context-menu .close-context").unbind("click"),$(".context-menu .close-context").on("click",function(){$(".fa-remove").trigger("click"),$(".context-menu .survey-result").remove(),$(".context-menu .origin").removeClass("d-none"),$(".context-menu").addClass("d-none"),$(".chat-pm li.survey").removeClass("selected"),$(".attach-menu > .survey-btn").addClass("d-none")})}function canRemove(){var n=!0;return $(".chat-pm li.selected").each(function(e,t){if(!$(t).hasClass("from-me"))return n=!1}),n}function image_must_be_selected(e){e&&e.hasClass("selected")?e.removeClass("selected"):e&&e.addClass("selected"),0==$(".img-tag.selected").length?$("#selectedItembtn").bsHide():($(".img-tag.selected").length,$("#selectedItembtn").bsShow())}function file_must_be_selected(e){e&&e.hasClass("selected")?e.removeClass("selected"):e&&e.addClass("selected"),0==$(".file-tag.selected").length?$("#selectedItembtn").bsHide():($(".file-tag.selected").length,$("#selectedItembtn").bsShow())}function voice_must_be_selected(e){e&&e.hasClass("selected")?e.removeClass("selected"):e&&e.addClass("selected"),0==$(".voice-tag.selected").length?$("#selectedItembtn").bsHide():($(".voice-tag.selected").length,$("#selectedItembtn").bsShow())}function loadForSelectLi(){var n=0;$(".chat-pm li").unbind("mousedown"),$(".chat-pm li").unbind("mouseup"),$(".chat-pm li").unbind("mouseleave"),$(".chat-pm li").unbind("mouseleave"),$(".chat-pm li").unbind("touchstart"),$(".chat-pm li").unbind("touchend"),$(".chat-pm li:not(.survey)").on("mousedown touchstart",function(e){var t=$(this);SelectLi&&"mousedown"==e.type&&contact_must_be_selected(t),n=setTimeout(function(){contact_must_be_selected(t)},1e3)}).on("mouseup mouseleave touchend",function(){clearTimeout(n)}),$(".chat-pm li:not(.survey)").on("touchmove mousemove",function(e){clearTimeout(n)})}var selectedImage=!1;function loadForSelectImage(){var t=0;$(".img-tag").unbind("mousedown"),$(".img-tag").unbind("mouseup"),$(".img-tag").unbind("mouseleave"),$(".img-tag").unbind("mouseleave"),$(".img-tag").unbind("touchstart"),$(".img-tag").unbind("touchend"),$(".img-tag").on("mousedown touchstart",function(){var e=$(this);selectedImage=!1,t=setTimeout(function(){image_must_be_selected(e),selectedImage=!0},1e3)}).on("mouseup mouseleave touchend",function(e){clearTimeout(t)}),$(".img-tag").on("touchmove mousemove",function(e){clearTimeout(t)})}var selectedFile=!1;function loadForSelectFile(){var t=0;$(".file-tag").unbind("mousedown"),$(".file-tag").unbind("mouseup"),$(".file-tag").unbind("mouseleave"),$(".file-tag").unbind("mouseleave"),$(".file-tag").unbind("touchstart"),$(".file-tag").unbind("touchend"),$(".file-tag").on("mousedown touchstart",function(){var e=$(this);selectedFile=!1,t=setTimeout(function(){file_must_be_selected(e),selectedFile=!0},1e3)}).on("mouseup mouseleave touchend",function(e){selectedFile&&e.preventDefault(),clearTimeout(t)}),$(".filea").on("click",function(e){selectedFile&&e.preventDefault()}),$(".file-tag").on("touchmove mousemove",function(e){clearTimeout(t)})}var selectedVoice=!1;function loadForSelectVoice(){var t=0;$(".voice-tag").unbind("mousedown"),$(".voice-tag").unbind("mouseup"),$(".voice-tag").unbind("mouseleave"),$(".voice-tag").unbind("mouseleave"),$(".voice-tag").unbind("touchstart"),$(".voice-tag").unbind("touchend"),$(".voice-tag").on("mousedown touchstart",function(){var e=$(this);selectedVoice=!1,t=setTimeout(function(){voice_must_be_selected(e),selectedVoice=!0},1e3)}).on("mouseup mouseleave touchend",function(e){clearTimeout(t)}),$(".voice-tag").on("touchmove mousemove",function(e){clearTimeout(t)})}function deselectBtnProcess(){$(".fa-remove").on("click",function(){$(".chat-pm li.selected").removeClass("selected"),contact_must_be_selected()}),$(".context-menu .close-context").unbind("click"),$(".context-menu .close-context").on("click",function(){$(".fa-remove").trigger("click"),$(".context-menu .survey-result").remove(),$(".context-menu .origin").removeClass("d-none"),$(".context-menu").addClass("d-none"),$(".chat-pm li.survey").removeClass("selected"),$(".attach-menu > .survey-btn").addClass("d-none")})}function copyBtnProcess(){$(".fa-copy").on("click",function(){var e=HTMLEncode($(".chat-pm li.selected label").eq(0).text()),e=($("#mycopytextarea").bsShow(),$("#mycopytextarea").html(e),document.getElementById("mycopytextarea"));e.select(),e.setSelectionRange(0,99999),$("#mycopytextarea").focus(),navigator.clipboard.writeText(e.value);try{JSBridge.copyToClipboard(e.value)}catch{}$(".chat-pm li.selected").removeClass("selected"),contact_must_be_selected(),$("#mycopytextarea").bsHide()})}function HTMLEncode(e){var t={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&apos;"},n=e;for(const a in t)0<=n.indexOf(a)&&(n=n.replaceAll(a,t[a]));return n}function replyBtnProcess(){$(".fa-reply").unbind("click"),$(".fa-reply").on("click",function(){$(".chat-pm-input .card-header a").trigger("click"),forwardid="",$(".chat-pm-input").eq(0).children().eq(0).addClass("d-none"),innerHtmlReply=$(".chat-pm-input").eq(0).html(),beforeReplytext=$(".chat-pm-input textarea").eq(0).val();var e=$(".chat-pm li.selected").eq(0);e&&(replyid=(replyid=e.data("id"))||e.parent().data("id"),e=HTMLEncode(20<e.find("label").get(0).innerText.length?e.find("label").get(0).innerText.substring(0,20):e.find("label").get(0).innerText),$(".chat-pm-input").html(`<div class="card" >
                  <div class="card-header reply" data-id="`+replyid+'">'+e+'<a class="float-end px-3">X</span></a></div>'+innerHtmlReply+"</div>"),textAreaKeyUp(),loadRecData(),showHideAttachBtnProcess(),locationBtnProcess(),$(".chat-pm-input textarea").val(beforeReplytext),$(".chat-pm-input textarea").focus(),$(".chat-pm-input .card-header a").on("click",function(){beforeReplytext=$(".chat-pm-input textarea").val(),$(".chat-pm-input").html(innerHtmlReply),replyid="",textAreaKeyUp(),showHideAttachBtnProcess(),locationBtnProcess(),$(".chat-pm textarea").val(beforeReplytext),loadRecData(),sendMessagebtn(),emojiContextMenuResetProcess(),emojiContextMenuProcess()}),sendMessagebtn(),$(".chat-pm li.selected").removeClass("selected"),contact_must_be_selected())}),$(".rep_").removeClass("rep_").addClass("rep")}function processReactionReport(e){0<$(".close-emj-report").length&&$(".close-emj-report").trigger("click"),$(".context-menu").removeClass("d-none"),$(".context-menu .origin").addClass("d-none"),$.post("/Home/ReactionReport",{messageAccessId:e},function(e){var n='<div class="emj-report-result"><div class="w-100">';$.each(e,function(e,t){n.indexOf(t.emjName)<0&&(n+='<div class="emj-rep '+t.emjName+'"><img src="/emj/'+t.emjName+'.svg" class="img-pro" /></div>')}),n+='<div class="emj-rep all selected">All</div><div class="emj-rep close-emj-report">&times;</div></div>',$.each(e,function(e,t){n+='<div class="person '+t.emjName+' w-100">'+t.fullName+" ("+t.createdDateShamsi+")</div>"}),n+="</div>",$(".context-menu").append(n),$(".context-menu .emj-rep").on("click",function(){$(".context-menu .emj-rep").removeClass("selected"),$(this).addClass("selected");var e=$(this).attr("class").replace("emj-rep ","").replace(" selected","");"all"!=e&&"close-emj-report"!=e?($(".context-menu .person").hide(),$(".context-menu .person."+e).show()):"all"==e?$(".context-menu .person").show():($(".context-menu .emj-report-result").remove(),$(".context-menu .origin").removeClass("d-none"),$(".context-menu").bsHide(),$(".chat-pm li.selected").removeClass("selected"),contact_must_be_selected())})})}function applyReactRepBtn(){$(".reac-rep-btn:not(.proc)").unbind("click"),$(".reac-rep-btn:not(.proc)").on("click",function(){processReactionReport(("DIV"==$(this).parent().parent().prop("tagName")?$(this).parent():$(this)).parent().parent().attr("data-id"))}),$(".reac-rep-btn:not(.proc)").addClass("proc")}function emojiContextMenuResetProcess(){$(".context-menu .emj").removeClass("proc"),$(".context-menu .reply-btn").removeClass("proc"),$(".context-menu .forward-btn").removeClass("proc"),$(".context-menu .delete-btn").removeClass("proc"),$(".context-menu .copy-btn").removeClass("proc")}function emojiContextMenuProcess(){$(".context-menu .emj:not(.emj-modal):not(.proc)").on("click",function(){SendNewEmojiProcess($(this).find("img").attr("src")),$(".context-menu").bsHide(),$(".chat-pm li.selected").removeClass("selected"),contact_must_be_selected()}),$(".context-menu .emj.emj-modal:not(.proc)").on("click",function(){$(".emjbtn").trigger("click")}),$(".context-menu .emj:not(.proc)").addClass("proc"),$(".context-menu .reply-btn:not(.proc)").unbind("click"),$(".context-menu .reply-btn:not(.proc)").on("click",function(){$(".fa-reply").trigger("click"),$(".context-menu").bsHide(),$(".chat-pm li.selected").removeClass("selected"),contact_must_be_selected(),$(".context-menu .reply-btn").addClass("proc")}),$(".context-menu .reply-btn").addClass("proc"),$(".context-menu .forward-btn:not(.proc)").on("click",function(){$(".fa-share").trigger("click"),$(".context-menu").bsHide(),$(".chat-pm li.selected").removeClass("selected"),contact_must_be_selected()}),$(".context-menu .forward-btn").addClass("proc"),$(".context-menu .delete-btn:not(.proc)").on("click",function(){$(".fa-trash").trigger("click"),$(".context-menu").bsHide(),$(".chat-pm li.selected").removeClass("selected"),contact_must_be_selected()}),$(".context-menu .delete-btn").addClass("proc"),$(".context-menu .copy-btn:not(.proc)").on("click",function(){$(".fa-copy").trigger("click"),$(".context-menu").bsHide(),$(".chat-pm li.selected").removeClass("selected"),contact_must_be_selected()}),$(".context-menu .copy-btn").addClass("proc")}function deleteBtnProcess(){$(".modal-body .fa-trash").on("click",function(){$("#deleteModal").modal("show")}),$(".del_").removeClass("del_").addClass("del")}function forwardBtnProcess(){$(".fa-share").on("click",function(){forwardid="",$(".chat-pm li.selected").each((e,t)=>{forwardid+=$(t).data("id")+","}),forwardid=forwardid.substring(0,forwardid.length-1);var e="";e+=$(".contacts").clone().html(),$("#forward-body").html(e),$("#forward-body").find(".chat-mess-new").eq(0).remove(),$("#forward-body .mess").on("click",function(){$("#forward-body .mess").removeClass("active"),$(this).addClass("active")}),$("#forwardModal").modal("show")}),$(".for_").removeClass("for_").addClass("for")}function editBtnProcess(){$(".fa-edit").on("click",function(){$(".chat-pm-input .card-header a").trigger("click"),forwardid="",$(".chat-pm-input").eq(0).children().eq(0).addClass("d-none");var e,t=$(".chat-pm-input").eq(0).html(),n=(beforeCopytext=$(".chat-pm-input textarea").eq(0).val(),$(".chat-pm li.selected").eq(0));n&&(editid=(editid=n.data("id"))||n.parent().data("id"),e=HTMLEncode(20<n.get(0).innerText.length?n.get(0).innerText.substring(0,20):n.get(0).innerText),$(".chat-pm-input").html(`<div class="card" >
                  <div class="card-header reply" data-id="`+replyid+'">'+e+'<a class="float-end px-3">X</span></a></div>'+t+"</div>"),$(".chat-pm-input textarea").val(n.find("label").text()),$(".chat-pm-input textarea").focus(),$(".chat-pm-input .card-header a").on("click",function(){beforeReplytext=$(".chat-pm-input textarea").val(),$(".chat-pm-input").html(t),editid="",editId="",$(".chat-pm textarea").val(beforeReplytext),loadRecData(),sendMessagebtn(),emojiContextMenuResetProcess(),emojiContextMenuProcess()}),sendMessagebtn(),$(".chat-pm li.selected").removeClass("selected"),contact_must_be_selected())}),$(".rep_").removeClass("rep_").addClass("rep")}function emojiBtnProcess(){$(".emjbtn:not(.proc)").on("click",function(){$("#EmojiModal").modal("show")}),$(".emj:not(.emj-modal):not(.proc)").on("click",function(){SendNewEmojiProcess($(this).find("img").attr("src")),$(".chat-pm li.selected").removeClass("selected"),contact_must_be_selected(),$("#EmojiModal").modal("hide")}),$(".emj:not(.emj-modal)").addClass("proc")}function SendNewEmojiProcess(e){var o="",s=e.replaceAll("/emj/","").replaceAll(".svg","");$(".chat-pm li.selected").each((e,t)=>{o+=$(t).data("id")+","}),o=o.substring(0,o.length-1),$.post("/Home/SendEmoji",{messid:o,emj:s},function(e){var t,n,a;e&&e.res?(t=$(".contact.active").data("id"),n="",(a=thisContactEmj.filter(e=>e.messageAccessId==parseInt(o.split(",")[0])&&e.userId==myUserId))&&0<a.length&&(n=a[0].emoji),mySignalRListener.sendEmojiBySignalR(o,e.res,s,t,n),a=e.res.split(","),strEmj='<img class="emj-16 '+s+'" src="/emj/'+s+'.svg" />',SetEmojiSenderResInChat(o,a,strEmj,s,n,myUserId),applyReactRepBtn()):alert("an error has occured!")})}function SetEmojiSenderResInChat(e,c,i,l,d,r){$.each(e.split(","),function(e,t){var n=thisContactEmj.filter(e=>e.messageAccessId==parseInt(t)&&e.userId==myUserId),a=1==c[e],o=2==c[e],s=3==c[e]&&0<n.length;a||3==c[e]&&0==n.length?addedEmjInChat(t,i,l,r,!1):o?removeEmjInChat(t,l,r):s&&ChangeEmjInChat(t,i,l,d,r)})}function addedEmjInChat(e,t,n,a,o){o||thisContactEmj.push({messageAccessId:parseInt(e),emoji:n,userId:a}),0==$('.chat-pm li[data-id="'+e+'"] .emjs').length?($('.chat-pm li[data-id="'+e+'"] label').append('<div class="emjs reac-rep-btn">'+t+"<sp></sp></div>"),$('.chat-pm li[data-id="'+e+'"] label').addClass("emj-div")):0==$('.chat-pm li[data-id="'+e+'"] .emjs .'+n).length?$('.chat-pm li[data-id="'+e+'"] .emjs').append(t+"<sp><sp>"):(o=null,(a=0)<(a=(n=$('.chat-pm li[data-id="'+e+'"] .emjs .'+n))&&0<n.length?(o=n.next("sp")).text().trim().split("\n").join("").split("\r").join(""):a)?o.html((parseInt(a)+1).toString()):null!=o?o.html("2"):$('.chat-pm li[data-id="'+e+'"] .emjs').append(t+"<sp></sp>"))}function removeEmjInChat(t,e,n){thisContactEmj=thisContactEmj.filter(e=>!(e.messageAccessId==parseInt(t)&&e.userId==n));var a=$('.chat-pm li[data-id="'+t+'"] .emjs .'+e).next("sp"),o=a.text().trim().split("\n").join("").split("\r").join("");o&&1<parseInt(o)?a.html((parseInt(o)-1).toString()):($('.chat-pm li[data-id="'+t+'"] .emjs .'+e).next("sp").remove(),$('.chat-pm li[data-id="'+t+'"] .emjs .'+e).remove())}function ChangeEmjInChat(e,t,n,a,o){removeEmjInChat(e,a,o),addedEmjInChat(e,t,n,o,!1)}function seenListBtnProcess(){$(".fa-info-circle").on("click",function(){$(".loading").show();var e=$(".chat-pm li.selected").eq(0).data("id");$.post("/Home/GetSeenListMess",{messId:e},function(e){$(".loading").hide();for(var t="",t=0==e.length?"<div>No one seen this messege.</div>":1==e.length?"<div>1 person seen this messege:</div>":"<div>"+e.length.toString()+" people seen this messege:</div>",n=0;n<e.length;n++)t+="<div>"+e[n].name+" - "+getNiceDateTimeFormat(e[n].createdDate)+"</div>";alertify.alert(t).set({title:"ZN Vostok"})})})}$("#btn-submit-delete").on("click",function(){var n="";$(".chat-pm li.selected").each((e,t)=>{n+=$(t).data("id")+","}),n=n.substring(0,n.length-1),$.post("/Home/DelMess",{messid:n},function(e){0<e.length&&0<e[0].id?(e=$(".contact.active").data("id"),mySignalRListener.sendBySignalRForDel(e,n+";;;"+userid),$.each(n.split(","),function(e,t){$(".chat-pm li[data-id="+t+"]").next(".chat-pm li").remove(),$(".chat-pm li[data-id="+t+"]").remove()})):alert("an error has occured!"),$("#deleteModal").modal("hide"),contact_must_be_selected(),deleteid=""})}),$("#btn-cancel-forward").on("click",function(){forwardid="",$("#forwardModal").modal("hide")}),$("#btn-submit-forward").on("click",function(){0<$("#forward-body .mess.active").length&&SendMessageProcess(!0),forwardid="",$("#forwardModal").modal("hide"),$(".chat-pm li.selected").removeClass("selected"),contact_must_be_selected()}),$("#forwardModal").on("hidden.bs.modal",function(){forwardid=""});