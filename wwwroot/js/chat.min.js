"use strict";function appendNewContactById(n){$.post("/Home/GetAccounts",{searchKey:n},function(n){var t,i,r;if(n.length!=0)for(t=0;t<n.length;t++){i="online";i=n[t].status==1?"away":n[t].status==2?"busy":n[t].status==3?"offline":i;r=`<li class="contact new-def-mess"  data-id="`+n[t].userId+`">
                        <div class="wrap">
                            <span class="contact-status `+i+`"></span>`+(n[t].profilePic?'<img src="/ProfilePics/'+n[t].profilePic+'" alt="" />':'<img src="/user-profile.png" alt="" />')+`<div class="meta">
                                <p class="name">`+n[t].userName+`<span>(1)</span></p>
                                <p class="preview"></p>
                            </div>
                        </div>
                    </li>`;$("#contacts ul").append(r);$(".new-def-mess").on("click",function(){$(".contact").removeClass("new-def-mess");$(".contact").removeClass("active");$(this).addClass("active");var n=$(this).data("id"),t=$(this).data("id");$.post("/Home/GetContactMessage",{page:"end",contactId:n},function(n){$(".loading").hide();n==null||n.length==0?SetEmptyMessage():SetResultOfMessage(n)})});$(".new-def-mess").addClass("def-mess").removeClass("new-def-mess")}})}function sendBySignalR(n,t){myDelayRetryIndex=0;connection.invoke("SendMessage",n,t).catch(function(n){return console.log(n.toString())})}function sendBySignalRForDel(n,t){myDelayRetryIndex=0;connection.invoke("SendMessage",n,"delmess;,;"+t).catch(function(n){return console.log(n.toString())})}var delayRetry=[10,2e3,1e4,15e3,17e3,2e4,3e4,6e4,3e5],myDelayRetryIndex=0,connection=(new signalR.HubConnectionBuilder).withUrl("/chatHub").withAutomaticReconnect({nextRetryDelayInMilliseconds:()=>(console.log("retry connect to websocket with "+delayRetry[myDelayRetryIndex].toString()+"ms delay"),myDelayRetryIndex>8&&(myDelayRetryIndex=8),delayRetry[myDelayRetryIndex++])}).build(),firstCall=!0;connection.on("Receive"+userid+"Message",function(n,t){var i,v,h,l,o,e,s,r;if(myDelayRetryIndex=0,i=t.split(";;;")[1],t.startsWith("delmess;,;")){$(".contact[data-id="+i+"]").hasClass("active")&&(v=t.replace("delmess;,;","").split(";;;")[0],$(".messages li[data-id="+v+"]").remove());return}if(t.startsWith("customNotif:")){try{var o=t.split(";;;")[3],y=t.split(";;;")[2],p=t.split(";;;")[4];JSBridge.setCustomNotification(y,p,o)}catch{}return}if(h=$(".contact[data-id="+i+"] .text-bg-success").html(),h==undefined){appendNewContactById(i);return}h?(l=parseInt(h.replace(" ","").replace("(","").replace(")","")),l++,$(".contact[data-id="+i+"] .text-bg-success").html(l)):$(".contact[data-id="+i+"] .text-bg-success").html("1");try{o=t.split(";;;")[3];JSBridge.setNotification("you have new message",o)}catch{}if($(".contact[data-id="+i+"]").hasClass("active")){var a=t.split(";;;")[0],u=t.split(";;;")[2],o=t.split(";;;")[3],c=t.split(";;;")[4],f="";if(a=="isfile")for(e=u.split(",;,")[0].split(";"),s="",u.split(",;,").length>1&&(s=u.split(",;,")[1]),r=0;r<e.length;r++)f+=`<li class="from-other" data-id="`+o+`" >`,s&&(f+=`<div class="card" data-id="`+(c?c:"")+`" >
                      <div class="card-header">`+s+`</div>`),f+=IsImage(e[r])?`<label><a href="/uploads/`+e[r]+`" target="_blank"><img  class="fupload" src="/uploads/thumbnails/`+e[r]+`" /></a></label>`:`<label><a href="/uploads/`+e[r]+`" target="_blank" ><div><img src="/img/file-icon.png" /></div><div>`+e[r]+`</div></a></label>`,s&&(f+=`</div>`),f+=`</li><li  class="from-other"><div class="date">`+getNiceDateTimeFormat(a)+`</div></li>`;else f+=`<li class="from-other"  data-id="`+o+`" >`+(u.indexOf(",;,")>=0?`<div class="card" data-id="`+(c?c:"")+`" >
                      <div class="card-header">`+u.split(",;,")[0]+`</div><label>`+u.split(",;,")[1]+`</label></div>`:`<label>`+u+`</label>`)+`</li><li  class="from-other"><div class="date">`+getNiceDateTimeFormat(a)+`</div></li>`;notifring.play();$("#lastchat").before(f);setTimeout(function(){$(".chat-pm ul").scrollTop($(".chat-pm ul")[0].scrollHeight)},500);$.post("/Home/SeenMessege",{contactId:i},function(){});allDropDownButtonProcess()}});connection.start().then(function(){myDelayRetryIndex=0;console.log("connection start ")}).catch(function(n){return console.log(n.toString())});