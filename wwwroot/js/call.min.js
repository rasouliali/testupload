$(".page1").hide(),$(".page2").hide(),$(".page3").hide(),$(".page4").hide();var conferenceCallCount=0;function CallingModal_Ringing_AcceptCall(){dt1=new Date,$.post("/Home/CallLogUpdate",{Status:2,ToUser:mySignalRListener.callingUser.userId},function(){}),0==isVideoCall?(initializeUserMediaVoice(),$(".two-img").removeClass("hideinmobile")):(initializeUserMediaVideo(),$(".two-img").addClass("hideinmobile")),mySignalRListener.AnswerCall(!0,mySignalRListener.callingUser),$("body").attr("data-mode","incall"),$(".page1").hide(),$(".page2").hide(),$(".page4").hide(),$(".page3").show(),$("#callstatus").text("In Call"),$("#CallingModal img.me").attr("src",myprofilepic),$("#CallingModal label.me").html(myname),0<$('.def-mess[data-id="'+mySignalRListener.callingUser.userId+'"]').length?($("#CallingModal img.other").attr("src",$('.def-mess[data-id="'+mySignalRListener.callingUser.userId+'"] img').attr("src")),$("#CallingModal h3.other").html($('.def-mess[data-id="'+mySignalRListener.callingUser.userId+'"] label.name').text()),$("#CallingModal .row.blur-img").css("background-image","url('"+$('.def-mess[data-id="'+mySignalRListener.callingUser.userId+'"] img').attr("src")+"')"),$("#CallingModal label.other").html($('.def-mess[data-id="'+mySignalRListener.callingUser.userId+'"] label.name').text())):($("#CallingModal img.other").attr("src",""),$("#CallingModal h3.other").html(""),$.post("/Home/GetUserPicAndName",{uid:mySignalRListener.callingUser.userId},function(l){$("#CallingModal img.other").attr("src",l.profilePic),$("#CallingModal h3.other").html(l.firstName+" "+l.lastName),$("#CallingModal label.other").html(l.firstName+" "+l.lastName),$("#CallingModal .row.blur-img").css("background-image","url('"+l.profilePic+"')")})),dt1=new Date,videoaudiotimer=setTimeout(timerDisplayFun,1e3)}function CallingModal_RejectCall(){try{JSBridge.InvokeSignalR("AnswerCall",!1,mySignalRListener.callingUser)}catch(l){}$(".hangup").trigger("click")}function CallingModal_Mute(){localStream&&(localStream.getAudioTracks()[0].enabled=!localStream.getAudioTracks()[0].enabled,$(".btn-mute").removeClass("active"),localStream.getAudioTracks()[0].enabled||$(".btn-mute").addClass("active"))}$("#CallingModal .switch-cam").on("click",async function(){await CallingModal_InCall_SwitchCam()}),$(".page1 .btn-accept-call").on("click",function(){CallingModal_Ringing_AcceptCall()}),$(".page1 .btn-reject-call , .page2 .btn-reject-call, .page3 .btn-reject-call , .page4 .end-group-call").on("click",function(){CallingModal_RejectCall()}),$(".btn-mute").on("click",function(){CallingModal_Mute()}),$(".btn-speaker").on("click",async function(){await CallingModal_Speaker()}),$("#CallingModal .btn-video").on("click",function(){CallingModal_InCall_ToggleVideo()}),$(".btn-conference-page").on("click",function(){CallingModal_InCall_ConferencePage()}),$(".btn-add-person").on("click",function(){CallingModal_InCall_AddMember()}),$(".btn-messages").on("click",function(){CallingModal_InCall_GoToChat()}),$("#GotoCall img").on("click",function(){CallingModal_InCall_GoToCall()}),$(".page4 .title").on("click",function(){$(".page3").show(),$(".page4").hide(),$("#CallingModal .video").addClass("active"),$("#CallingModal .video video").show()}),$(".call-buttons img").on("click",function(){var l=$(this).parent().attr("class");"btn-speaker"==l?$("."+l).toggleClass("active"):"btn-mute"!=l&&$(this).toggleClass("active")});var sinkId="";async function CallingModal_Speaker(){var a,l=await navigator.mediaDevices.enumerateDevices(),e=l.filter(l=>"audiooutput"===l.kind&&"default"!=l.deviceId);sinkId=(""==sinkId?(sinkId=""==sinkId?l.filter(l=>"audiooutput"===l.kind&&"default"==l.deviceId)[0].label:sinkId,a=e.filter(l=>0<=sinkId.indexOf(l.label))[0],e.filter(l=>a.label!=l.label)):e.filter(l=>sinkId!=l.deviceId))[0].deviceId,await localaudio.setSinkId(sinkId)}async function CallingModal_InCall_SwitchCam(){if(localStream&&localStream.getTracks().forEach(l=>l.stop()),$("#CallingModal .video").eq(0).find("video").show(),isVideoCall=!0,localStream=null,facingModeStr="user"==facingModeStr?"environment":"user",webrtcConstraints=getVideoConfig(),initializeUserMediaVideo(),e=$("body").attr("data-json"))for(var l,a,e=JSON.parse(e),i=0;i<e.length;i++)e[i].userid!=myUserId&&(l=e[i].userid,a=e[i].connectionId,e[i].beforecallid=e[i].callid,e[i].callid=uuidv4(),$("body").attr("data-json",JSON.stringify(e)),createOfferWhenLocalStreamIsReady({callid:e[i].callid,connectionId:a,userId:l}))}var videoSinkid="";function CallingModal_InCall_ToggleVideo(){if($(".two-img").addClass("hideinmobile"),$("#CallingModal .video").eq(0).hasClass("active")?$("#CallingModal .video").eq(0).removeClass("active"):$("#CallingModal .video").eq(0).addClass("active"),localStream&&localStream.getTracks().forEach(l=>l.stop()),localStream=null,($("#CallingModal .video").eq(0).hasClass("active")?($("#CallingModal .video").eq(0).find("video").show(),isVideoCall=!0,initializeUserMediaVideo):($("#CallingModal .video").eq(0).find("video").hide(),isVideoCall=!1,initializeUserMediaVoice))(),e=$("body").attr("data-json"))for(var l,a,e=JSON.parse(e),i=0;i<e.length;i++)e[i].userid!=myUserId&&(l=e[i].userid,a=e[i].connectionId,e[i].beforecallid=e[i].callid,e[i].callid=uuidv4(),$("body").attr("data-json",JSON.stringify(e)),createOfferWhenLocalStreamIsReady({callid:e[i].callid,connectionId:a,userId:l}))}function CallingModal_InCall_ConferencePage(){$("#CallingModal .video").removeClass("active"),$("#CallingModal .video video").hide(),$(".page4").show(),$(".page3").hide()}function CallingModal_InCall_AddMember(){$("#CallingModal").modal("hide"),openAllContact(function(l){fromNewChat=!0,$("#selectContactModal").modal("hide"),$(".contact").removeClass("active"),l.addClass("active");l.data("id");var a=l.data("id"),e=new Date,i=$("body").attr("data-json");n=i?(i=JSON.parse(i),{connectionId:ul.filter(l=>l.userId==a)[0].connectionId,st:e,userId:a,isCaller:!1}):(i=[],{connectionId:ul.filter(l=>l.userId==a)[0].connectionId,st:e,userId:a,isCaller:!1}),i.push(n),mySignalRListener.NewMemberAndCaller(!0,n),$("body").attr("data-json",JSON.stringify(i));var n=`
                    <div class="persons" startTime="`+e+`">
                        <div>
                            <img src="`+l.find("img").attr("src")+`" class="rounded-circle img other" />
                            <label class="other">"`+l.find("label").eq(0).text()+`"</label>
                        </div>
                        <div>
                            <label class="txt-timer other"></label>
                            <img src="/img/end-call.svg" class="no-border end-call" />
                        </div>
                    </div>`;$(".page4 .btn-add-person").before(n),$("#CallingModal").modal("show")})}function CallingModal_InCall_RecordCall(){}function CallingModal_InCall_GoToChat(){$("#CallingModal").modal("hide"),$("#GotoCall").toggleClass("active")}function CallingModal_InCall_GoToCall(){$("#CallingModal").modal("show"),$("#GotoCall").toggleClass("active")}!async function(){var l=(await navigator.mediaDevices.enumerateDevices()).filter(l=>"videoinput"===l.kind&&"default"!=l.deviceId);0!=l.length&&1!=l.length||$("#CallingModal .switch-cam").hide()}();