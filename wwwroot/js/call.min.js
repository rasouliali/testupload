function CallingModal_Ringing_AcceptCall(){dt1=new Date,$.post("/Home/CallLogUpdate",{Status:2,ToUser:mySignalRListener.callingUser.userId},function(){}),0==isVideoCall?(initializeUserMediaVoice(),$(".two-img").removeClass("hideinmobile")):(initializeUserMediaVideo(),$(".two-img").addClass("hideinmobile"));try{JSBridge.InvokeSignalR("AnswerCall",!0,JSON.stringify(mySignalRListener.callingUser))}catch(a){}mySignalRListener.AnswerCall(!0,mySignalRListener.callingUser),$("body").attr("data-mode","incall"),$(".page1").hide(),$(".page2").hide(),$(".page4").hide(),$(".page3").show(),$("#callstatus").text("In Call"),$("#CallingModal img.me").attr("src",myprofilepic),0<$('.def-mess[data-id="'+mySignalRListener.callingUser.userId+'"]').length?($("#CallingModal img.other").attr("src",$('.def-mess[data-id="'+mySignalRListener.callingUser.userId+'"] img').attr("src")),$("#CallingModal h3.other").html($('.def-mess[data-id="'+mySignalRListener.callingUser.userId+'"] label.name').text()),$("#CallingModal .row.blur-img").css("background-image","url('"+$('.def-mess[data-id="'+mySignalRListener.callingUser.userId+'"] img').attr("src")+"')")):($("#CallingModal img.other").attr("src",""),$("#CallingModal h3.other").html(""),$.post("/Home/GetUserPicAndName",{uid:mySignalRListener.callingUser.userId},function(a){$("#CallingModal img.other").attr("src",a.profilePic),$("#CallingModal h3.other").html(a.firstName+" "+a.lastName),$("#CallingModal .row.blur-img").css("background-image","url('"+a.profilePic+"')")})),dt1=new Date,videoaudiotimer=setTimeout(timerDisplayFun,1e3)}function CallingModal_RejectCall(){try{JSBridge.InvokeSignalR("AnswerCall",!1,mySignalRListener.callingUser)}catch(a){}$(".hangup").trigger("click")}function CallingModal_Mute(){localStream&&(localStream.getAudioTracks()[0].enabled=!localStream.getAudioTracks()[0].enabled,$(".btn-mute").removeClass("active"),localStream.getAudioTracks()[0].enabled||$(".btn-mute").addClass("active"))}$(".page1").hide(),$(".page2").hide(),$(".page3").hide(),$(".page4").hide(),$("#CallingModal video").on("playing play",function(){$(this).show(),$(this).parent().addClass("active")}),$("#CallingModal .switch-cam").on("click",async function(){await CallingModal_InCall_SwitchCam()}),$("#CallingModal video").on("mute",function(){$(this).hide(),$(this).parent().removeClass("active")}),$(".page1 .btn-accept-call").on("click",function(){CallingModal_Ringing_AcceptCall()}),$(".page1 .btn-reject-call , .page2 .btn-reject-call, .page3 .btn-reject-call , .page4 .end-group-call").on("click",function(){CallingModal_RejectCall()}),$(".btn-mute").on("click",function(){CallingModal_Mute()}),$(".btn-speaker").on("click",async function(){await CallingModal_Speaker()}),$("#CallingModal .btn-video").on("click",function(){CallingModal_InCall_ToggleVideo()}),$(".btn-add-person").on("click",function(){CallingModal_InCall_AddMember()}),$(".btn-messages").on("click",function(){CallingModal_InCall_GoToChat()}),$("#GotoCall img").on("click",function(){CallingModal_InCall_GoToCall()}),$(".page4 .title").on("click",function(){$(".page3").show(),$(".page4").hide(),$("#CallingModal .video").addClass("active"),$("#CallingModal .video video").show()}),$(".call-buttons img").on("click",function(){var a=$(this).parent().attr("class");"btn-speaker"==a?$("."+a).toggleClass("active"):"btn-mute"!=a&&$(this).toggleClass("active")});var sinkId="";async function CallingModal_Speaker(){var l,a=await navigator.mediaDevices.enumerateDevices(),e=a.filter(a=>"audiooutput"===a.kind&&"default"!=a.deviceId);sinkId=(""==sinkId?(sinkId=""==sinkId?a.filter(a=>"audiooutput"===a.kind&&"default"==a.deviceId)[0].label:sinkId,l=e.filter(a=>0<=sinkId.indexOf(a.label))[0],e.filter(a=>l.label!=a.label)):e.filter(a=>sinkId!=a.deviceId))[0].deviceId,await localaudio.setSinkId(sinkId)}async function CallingModal_InCall_SwitchCam(){localStream&&localStream.getTracks().forEach(a=>a.stop());var a=getConnection($("body").attr("data-call")).userId,l=($("body").attr("data-before-call",$("body").attr("data-call")),$("body").attr("data-call",uuidv4()),localStream=null,facingModeStr="user",webrtcConstraints=getVideoConfig(),a),a=ul.filter(a=>a.userId==l).sort(function(a,l){return new Date(a.lastUsed)-new Date(l.lastUsed)});0<a.length&&($("#CallingModal .video").eq(0).find("video").show(),isVideoCall=!0,initializeUserMediaVideo(),createOfferWhenLocalStreamIsReady({connectionId:a[a.length-1].connectionId,userId:l},localStream))}var videoSinkid="";function CallingModal_InCall_ToggleVideo(){$(".two-img").addClass("hideinmobile"),$("#CallingModal .video").eq(0).hasClass("active")?$("#CallingModal .video").eq(0).removeClass("active"):$("#CallingModal .video").eq(0).addClass("active"),localStream&&localStream.getTracks().forEach(a=>a.stop());var a=getConnection($("body").attr("data-call")).userId,l=($("body").attr("data-before-call",$("body").attr("data-call")),$("body").attr("data-call",uuidv4()),localStream=null,a),a=ul.filter(a=>a.userId==l).sort(function(a,l){return new Date(a.lastUsed)-new Date(l.lastUsed)});0<a.length&&(($("#CallingModal .video").eq(0).hasClass("active")?($("#CallingModal .video").eq(0).find("video").show(),isVideoCall=!0,initializeUserMediaVideo):($("#CallingModal .video").eq(0).find("video").hide(),isVideoCall=!1,initializeUserMediaVoice))(),createOfferWhenLocalStreamIsReady({connectionId:a[a.length-1].connectionId,userId:l},localStream))}function CallingModal_InCall_AddMember(){$("#CallingModal .video").removeClass("active"),$("#CallingModal .video video").hide(),$(".page4").show(),$(".page3").hide()}function CallingModal_InCall_RecordCall(){}function CallingModal_InCall_GoToChat(){$("#CallingModal").modal("hide"),$("#GotoCall").toggleClass("active")}function CallingModal_InCall_GoToCall(){$("#CallingModal").modal("show"),$("#GotoCall").toggleClass("active")}!async function(){var a=(await navigator.mediaDevices.enumerateDevices()).filter(a=>"videoinput"===a.kind&&"default"!=a.deviceId);0!=a.length&&1!=a.length||$("#CallingModal .switch-cam").hide()}(),setTimeout(async function(){alertify.error("SwitchCam be",2),await CallingModal_InCall_SwitchCam(),alertify.error("SwitchCam en",2)},2e4),setTimeout(async function(){alertify.error("SwitchCam be",2),await CallingModal_InCall_SwitchCam(),alertify.error("SwitchCam en",2)},3e4),setTimeout(async function(){alertify.error("SwitchCam be",2),await CallingModal_InCall_SwitchCam(),alertify.error("SwitchCam en",2)},4e4);