URL=window.URL||window.webkitURL;var gumStream,rec,input,audioContext,recordButton,stopButton,loader,AudioContext=window.AudioContext||window.webkitAudioContext;function loadRecData(){(recordButton=document.getElementById("microphone_btn"))&&(recordButton.addEventListener("click",startRecording),stopButton=document.getElementById("stopButton"),loader=document.getElementById("loader"),stopButton.style.display="none",stopButton.addEventListener("click",stopRecording))}function startRecording(){console.log("recordButton clicked");navigator.mediaDevices.getUserMedia({audio:!0,video:!1}).then(function(e){console.log("getUserMedia() success, stream created, initializing Recorder.js ..."),audioContext=new AudioContext,gumStream=e,input=audioContext.createMediaStreamSource(e),(rec=new Recorder(input,{numChannels:1})).record(),console.log("Recording started")}).catch(function(e){recordButton.style.display="flex",stopButton.style.display="none"}),recordButton.style.display="none",stopButton.style.display="flex"}function stopRecording(){console.log("stopButton clicked"),loader=document.getElementById("loader"),$(loader).show(),$(".loading").show(),stopButton.style.display="none",recordButton.style.display="flex",rec.stop(),gumStream.getAudioTracks()[0].stop(),rec.exportWAV(createDownloadLink)}function createDownloadLink(e){URL.createObjectURL(e),document.createElement("audio"),document.createElement("li");var t=(new Date).toISOString()+".wav",r=new XMLHttpRequest,o=(r.onload=function(e){if(4===this.readyState){var t=JSON.parse(r.response)[0].body.split(";"),o="",n=(n=$(".message-input .card-header").text())&&n.substring(0,n.length-1);$(".loading").hide();for(var a=0;a<t.length;a++)o+='<li class="from-me">',n&&(o+='<div class="card" data-id="'+(replyid||"")+`" >
                <div class="card-header">`+n+"</div>"),o+='<label><div><audio controls src="/Home/GetFile?fileName='+t[a]+'&fileType=up" ></audio></div><div> '+t[a]+"</div></label>",n&&(o+="<span>âœ“</span></div>"),o+="</li>";$(".loading").hide(),$(".chat-pm-input textarea").val(""),$("#lastchat").before(o),$(".img-tag").unbind("click"),$(".img-tag").on("click",function(){var e=$(this).data("url");loadImageModal(e)}),$("#Files").val(""),$("#pogressbarModal").modal("hide");var i=$(".contact.active").hasClass("grp"),d=$(".contact.active").data("id");i?mySignalRListener.sendBySignalRToGroup(d,"isfile;;;"+userid+";;;"+t[0]+",;,"+n+";;;;;;"+replyid):mySignalRListener.sendBySignalR(d,"isfile;;;"+userid+";;;"+t[0]+",;,"+n+";;;;;;"+replyid),setTimeout(function(){$(".chat-pm ul").scrollTop($(".chat-pm ul").get(0).scrollHeight)},500),replyid?($(".message-input .card-header span").trigger("click"),replyid=""):allDropDownButtonProcess(),loader.style="",loadForSelectLi()}},new FormData);o.append("audio_data",e,t),o.append("user",$(".contact.active").data("id")),r.open("POST","/Home/VoiceRecorder",!0),r.send(o)}