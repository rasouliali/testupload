URL=window.URL||window.webkitURL;var gumStream,rec,input,audioContext,recordButton,stopButton,stopButtonInRecorder,loader,startDate,startvoiceRecorderInterval,AudioContext=window.AudioContext||window.webkitAudioContext;function loadRecData(){(recordButton=document.getElementById("microphone_btn"))&&(recordButton.addEventListener("click",startRecording),stopButton=document.getElementById("stopButton"),(stopButtonInRecorder=$(".stopBtn")).unbind("click"),stopButtonInRecorder.on("click",function(){stopRecording()}),loader=document.getElementById("loader"),stopButton.style.display="none",stopButton.addEventListener("click",stopRecording))}function startRecording(){startDate=new Date,startvoiceRecorderInterval=setInterval(function(){var e=(new Date).getTime()-startDate.getTime(),t=Math.floor(e/1e3%60),e=Math.floor(e/1e3/60);$("#voiceRecorderTimer").html((e<10?"0":"")+e.toString()+":"+(t<10?"0":"")+t.toString())},1e3),console.log("recordButton clicked"),$("#VoiceRecorderModal").modal({backdrop:"static",keyboard:!1}),$("#VoiceRecorderModal").modal("show");navigator.mediaDevices.getUserMedia({audio:!0,video:!1}).then(function(e){console.log("getUserMedia() success, stream created, initializing Recorder.js ..."),audioContext=new AudioContext,gumStream=e,input=audioContext.createMediaStreamSource(e),(rec=new Recorder(input,{numChannels:1})).record(),console.log("Recording started")}).catch(function(e){recordButton.style.display="flex",stopButton.style.display="none"}),recordButton.style.display="none",stopButton.style.display="flex"}function stopRecording(){$("#VoiceRecorderModal").modal("hide"),clearInterval(startvoiceRecorderInterval),console.log("stopButton clicked"),loader=document.getElementById("loader"),$(loader).show(),$(".loading").show(),stopButton.style.display="none",recordButton.style.display="flex",rec.stop(),gumStream.getAudioTracks()[0].stop(),rec.exportWAV(createDownloadLink)}function createDownloadLink(e){URL.createObjectURL(e),document.createElement("audio"),document.createElement("li");var t=(new Date).toISOString()+".wav",d=new XMLHttpRequest,o=(d.onload=function(e){if(4===this.readyState){var t=JSON.parse(d.response)[0].body.split(";"),o="",a=(a=$(".message-input .card-header").text())&&a.substring(0,a.length-1);$(".loading").hide();for(var n=0;n<t.length;n++)o+='<li class="from-me">',a&&(o+='<div class="card" data-id="'+(replyid||"")+`" >
                <div class="card-header">`+a+"</div>"),o+='<label><div><audio controls src="/Home/GetFile?fileName='+t[n]+'&fileType=up" ></audio></div><div> '+t[n]+"</div></label>",a&&(o+="<span>âœ“</span></div>"),o+="</li>";$(".loading").hide(),$(".chat-pm-input textarea").val(""),$("#lastchat").before(o),$(".img-tag").unbind("click"),$(".img-tag").on("click",function(){var e=$(this).data("url");loadImageModal(e)}),$("#Files").val(""),$("#pogressbarModal").modal("hide");var r=$(".contact.active").hasClass("grp"),i=$(".contact.active").data("id");r?mySignalRListener.sendBySignalRToGroup(i,"isfile;;;"+userid+";;;"+t[0]+",;,"+a+";;;;;;"+replyid):mySignalRListener.sendBySignalR(i,"isfile;;;"+userid+";;;"+t[0]+",;,"+a+";;;;;;"+replyid),setTimeout(function(){$(".chat-pm ul").scrollTop($(".chat-pm ul").get(0).scrollHeight)},500),replyid?($(".message-input .card-header span").trigger("click"),replyid=""):allDropDownButtonProcess(),$(".loading").removeAttr("style"),loadForSelectLi()}},new FormData);o.append("audio_data",e,t),o.append("user",$(".contact.active").data("id")),d.open("POST","/Home/VoiceRecorder",!0),d.send(o)}