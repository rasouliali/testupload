URL=window.URL||window.webkitURL;var gumStream,rec,input,audioContext,recordButton,stopButton,stopButtonInRecorder,loader,startDate,startvoiceRecorderInterval,AudioContext=window.AudioContext||window.webkitAudioContext;function loadRecData(){(recordButton=$("#microphone_btn"))&&(recordButton.unbind("click"),recordButton.on("click",startRecording),(stopButton=$("#stopButton")).unbind("click"),(stopButtonInRecorder=$(".stopBtn")).unbind("click"),stopButtonInRecorder.on("click",function(){stopRecording()}),loader=document.getElementById("loader"),stopButton.on("click",stopRecording))}function startRecording(){startDate=new Date,stopButtonInRecorder.removeClass("d-none"),startvoiceRecorderInterval=setInterval(function(){var e=(new Date).getTime()-startDate.getTime(),t=Math.floor(e/1e3%60),e=Math.floor(e/1e3/60);$("#voiceRecorderTimer").html((e<10?"0":"")+e.toString()+":"+(t<10?"0":"")+t.toString())},1e3),console.log("recordButton clicked"),$("#VoiceRecorderModal").modal({backdrop:"static",keyboard:!1}),$("#VoiceRecorderModal").modal("show");navigator.mediaDevices.getUserMedia({audio:!0,video:!1}).then(function(e){console.log("getUserMedia() success, stream created, initializing Recorder.js ..."),audioContext=new AudioContext,gumStream=e,input=audioContext.createMediaStreamSource(e),(rec=new Recorder(input,{numChannels:1})).record(),console.log("Recording started")}).catch(function(e){recordButton.get(0).style.display="flex",stopButtonInRecorder.addClass("d-none")}),recordButton.get(0).style.display="none",stopButton.get(0).style.display="flex"}function stopRecording(){$("#VoiceRecorderModal").modal("hide"),clearInterval(startvoiceRecorderInterval),console.log("stopButton clicked"),stopButtonInRecorder.addClass("d-none"),loader=document.getElementById("loader"),$(loader).show(),$(".loading").show(),stopButtonInRecorder.addClass("d-none"),recordButton.get(0).style.display="flex",rec.stop(),gumStream.getAudioTracks()[0].stop(),rec.exportWAV(createDownloadLink)}function createDownloadLink(e){URL.createObjectURL(e),document.createElement("audio"),document.createElement("li");var t=(new Date).toISOString()+".wav",i=new XMLHttpRequest,o=(i.onload=function(e){if(4===this.readyState){var t=JSON.parse(i.response)[0].body.split(";"),o="",n=(n=$(".message-input .card-header").text())&&n.substring(0,n.length-1);$(".loading").hide();for(var a=0;a<t.length;a++)o+='<li class="from-me">',n&&(o+='<div class="card" data-id="'+(replyid||"")+`" >
                <div class="card-header">`+n+"</div>"),o+='<label><div><audio controls src="/Home/GetFile?fileName='+t[a]+'&fileType=up" ></audio></div><div> '+t[a]+"</div></label>",n&&(o+="<span>âœ“</span></div>"),o+="</li>";$(".loading").hide(),$(".chat-pm-input textarea").val(""),$("#lastchat").before(o),$(".img-tag").unbind("click"),$(".img-tag").on("click",function(){var e=$(this).data("url");loadImageModal(e)}),$("#Files").val(""),$("#pogressbarModal").modal("hide");var r=$(".contact.active").hasClass("grp"),d=$(".contact.active").data("id");r?mySignalRListener.sendBySignalRToGroup(d,"isfile;;;"+userid+";;;"+t[0]+",;,"+n+";;;;;;"+replyid):mySignalRListener.sendBySignalR(d,"isfile;;;"+userid+";;;"+t[0]+",;,"+n+";;;;;;"+replyid),setTimeout(function(){$(".chat-pm ul").scrollTop($(".chat-pm ul").get(0).scrollHeight)},500),replyid?($(".message-input .card-header span").trigger("click"),replyid=""):allDropDownButtonProcess(),$(".loading").removeAttr("style"),loadForSelectLi()}},new FormData);o.append("audio_data",e,t),o.append("user",$(".contact.active").data("id")),i.open("POST","/Home/VoiceRecorder",!0),i.send(o)}